(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();var Lr={value:()=>{}};function an(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new ht(n)}function ht(t){this._=t}function Pr(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}ht.prototype=an.prototype={constructor:ht,on:function(t,e){var n=this._,r=Pr(t+"",n),i,a=-1,s=r.length;if(arguments.length<2){for(;++a<s;)if((i=(t=r[a]).type)&&(i=Dr(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(i=(t=r[a]).type)n[i]=gn(n[i],t.name,e);else if(e==null)for(i in n)n[i]=gn(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new ht(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function Dr(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function gn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Lr,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Vt="http://www.w3.org/1999/xhtml";const _n={svg:"http://www.w3.org/2000/svg",xhtml:Vt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function It(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),_n.hasOwnProperty(e)?{space:_n[e],local:t}:t}function Br(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Vt&&e.documentElement.namespaceURI===Vt?e.createElement(t):e.createElementNS(n,t)}}function Zr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function tr(t){var e=It(t);return(e.local?Zr:Br)(e)}function Vr(){}function sn(t){return t==null?Vr:function(){return this.querySelector(t)}}function jr(t){typeof t!="function"&&(t=sn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],s=a.length,o=r[i]=new Array(s),l,c,d=0;d<s;++d)(l=a[d])&&(c=t.call(l,l.__data__,d,a))&&("__data__"in l&&(c.__data__=l.__data__),o[d]=c);return new X(r,this._parents)}function nr(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Fr(){return[]}function rr(t){return t==null?Fr:function(){return this.querySelectorAll(t)}}function Ur(t){return function(){return nr(t.apply(this,arguments))}}function Hr(t){typeof t=="function"?t=Ur(t):t=rr(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var s=e[a],o=s.length,l,c=0;c<o;++c)(l=s[c])&&(r.push(t.call(l,l.__data__,c,s)),i.push(l));return new X(r,i)}function ir(t){return function(){return this.matches(t)}}function ar(t){return function(e){return e.matches(t)}}var qr=Array.prototype.find;function Wr(t){return function(){return qr.call(this.children,t)}}function Yr(){return this.firstElementChild}function Gr(t){return this.select(t==null?Yr:Wr(typeof t=="function"?t:ar(t)))}var Jr=Array.prototype.filter;function Kr(){return Array.from(this.children)}function Xr(t){return function(){return Jr.call(this.children,t)}}function Qr(t){return this.selectAll(t==null?Kr:Xr(typeof t=="function"?t:ar(t)))}function ei(t){typeof t!="function"&&(t=ir(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],s=a.length,o=r[i]=[],l,c=0;c<s;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&o.push(l);return new X(r,this._parents)}function sr(t){return new Array(t.length)}function ti(){return new X(this._enter||this._groups.map(sr),this._parents)}function _t(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}_t.prototype={constructor:_t,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ni(t){return function(){return t}}function ri(t,e,n,r,i,a){for(var s=0,o,l=e.length,c=a.length;s<c;++s)(o=e[s])?(o.__data__=a[s],r[s]=o):n[s]=new _t(t,a[s]);for(;s<l;++s)(o=e[s])&&(i[s]=o)}function ii(t,e,n,r,i,a,s){var o,l,c=new Map,d=e.length,u=a.length,p=new Array(d),f;for(o=0;o<d;++o)(l=e[o])&&(p[o]=f=s.call(l,l.__data__,o,e)+"",c.has(f)?i[o]=l:c.set(f,l));for(o=0;o<u;++o)f=s.call(t,a[o],o,a)+"",(l=c.get(f))?(r[o]=l,l.__data__=a[o],c.delete(f)):n[o]=new _t(t,a[o]);for(o=0;o<d;++o)(l=e[o])&&c.get(p[o])===l&&(i[o]=l)}function ai(t){return t.__data__}function si(t,e){if(!arguments.length)return Array.from(this,ai);var n=e?ii:ri,r=this._parents,i=this._groups;typeof t!="function"&&(t=ni(t));for(var a=i.length,s=new Array(a),o=new Array(a),l=new Array(a),c=0;c<a;++c){var d=r[c],u=i[c],p=u.length,f=oi(t.call(d,d&&d.__data__,c,r)),_=f.length,h=o[c]=new Array(_),g=s[c]=new Array(_),y=l[c]=new Array(p);n(d,u,h,g,y,f,e);for(var I=0,N=0,v,k;I<_;++I)if(v=h[I]){for(I>=N&&(N=I+1);!(k=g[N])&&++N<_;);v._next=k||null}}return s=new X(s,r),s._enter=o,s._exit=l,s}function oi(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function li(){return new X(this._exit||this._groups.map(sr),this._parents)}function ci(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function di(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,s=Math.min(i,a),o=new Array(i),l=0;l<s;++l)for(var c=n[l],d=r[l],u=c.length,p=o[l]=new Array(u),f,_=0;_<u;++_)(f=c[_]||d[_])&&(p[_]=f);for(;l<i;++l)o[l]=n[l];return new X(o,this._parents)}function ui(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],s;--i>=0;)(s=r[i])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function fi(t){t||(t=hi);function e(u,p){return u&&p?t(u.__data__,p.__data__):!u-!p}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var s=n[a],o=s.length,l=i[a]=new Array(o),c,d=0;d<o;++d)(c=s[d])&&(l[d]=c);l.sort(e)}return new X(i,this._parents).order()}function hi(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function mi(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function pi(){return Array.from(this)}function gi(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var s=r[i];if(s)return s}return null}function _i(){let t=0;for(const e of this)++t;return t}function yi(){return!this.node()}function vi(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,s=i.length,o;a<s;++a)(o=i[a])&&t.call(o,o.__data__,a,i);return this}function bi(t){return function(){this.removeAttribute(t)}}function xi(t){return function(){this.removeAttributeNS(t.space,t.local)}}function wi(t,e){return function(){this.setAttribute(t,e)}}function ki(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ei(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Ni(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ti(t,e){var n=It(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?xi:bi:typeof e=="function"?n.local?Ni:Ei:n.local?ki:wi)(n,e))}function or(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Si(t){return function(){this.style.removeProperty(t)}}function Ci(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ii(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ai(t,e,n){return arguments.length>1?this.each((e==null?Si:typeof e=="function"?Ii:Ci)(t,e,n??"")):ze(this.node(),t)}function ze(t,e){return t.style.getPropertyValue(e)||or(t).getComputedStyle(t,null).getPropertyValue(e)}function Oi(t){return function(){delete this[t]}}function Ri(t,e){return function(){this[t]=e}}function Mi(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function $i(t,e){return arguments.length>1?this.each((e==null?Oi:typeof e=="function"?Mi:Ri)(t,e)):this.node()[t]}function lr(t){return t.trim().split(/^|\s+/)}function on(t){return t.classList||new cr(t)}function cr(t){this._node=t,this._names=lr(t.getAttribute("class")||"")}cr.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function dr(t,e){for(var n=on(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function ur(t,e){for(var n=on(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function zi(t){return function(){dr(this,t)}}function Li(t){return function(){ur(this,t)}}function Pi(t,e){return function(){(e.apply(this,arguments)?dr:ur)(this,t)}}function Di(t,e){var n=lr(t+"");if(arguments.length<2){for(var r=on(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Pi:e?zi:Li)(n,e))}function Bi(){this.textContent=""}function Zi(t){return function(){this.textContent=t}}function Vi(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ji(t){return arguments.length?this.each(t==null?Bi:(typeof t=="function"?Vi:Zi)(t)):this.node().textContent}function Fi(){this.innerHTML=""}function Ui(t){return function(){this.innerHTML=t}}function Hi(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function qi(t){return arguments.length?this.each(t==null?Fi:(typeof t=="function"?Hi:Ui)(t)):this.node().innerHTML}function Wi(){this.nextSibling&&this.parentNode.appendChild(this)}function Yi(){return this.each(Wi)}function Gi(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ji(){return this.each(Gi)}function Ki(t){var e=typeof t=="function"?t:tr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Xi(){return null}function Qi(t,e){var n=typeof t=="function"?t:tr(t),r=e==null?Xi:typeof e=="function"?e:sn(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ea(){var t=this.parentNode;t&&t.removeChild(this)}function ta(){return this.each(ea)}function na(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ra(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ia(t){return this.select(t?ra:na)}function aa(t){return arguments.length?this.property("__data__",t):this.node().__data__}function sa(t){return function(e){t.call(this,e,this.__data__)}}function oa(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function la(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function ca(t,e,n){return function(){var r=this.__on,i,a=sa(e);if(r){for(var s=0,o=r.length;s<o;++s)if((i=r[s]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function da(t,e,n){var r=oa(t+""),i,a=r.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,c=o.length,d;l<c;++l)for(i=0,d=o[l];i<a;++i)if((s=r[i]).type===d.type&&s.name===d.name)return d.value}return}for(o=e?ca:la,i=0;i<a;++i)this.each(o(r[i],e,n));return this}function fr(t,e,n){var r=or(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ua(t,e){return function(){return fr(this,t,e)}}function fa(t,e){return function(){return fr(this,t,e.apply(this,arguments))}}function ha(t,e){return this.each((typeof e=="function"?fa:ua)(t,e))}function*ma(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,s;i<a;++i)(s=r[i])&&(yield s)}var ln=[null];function X(t,e){this._groups=t,this._parents=e}function at(){return new X([[document.documentElement]],ln)}function pa(){return this}X.prototype=at.prototype={constructor:X,select:jr,selectAll:Hr,selectChild:Gr,selectChildren:Qr,filter:ei,data:si,enter:ti,exit:li,join:ci,merge:di,selection:pa,order:ui,sort:fi,call:mi,nodes:pi,node:gi,size:_i,empty:yi,each:vi,attr:Ti,style:Ai,property:$i,classed:Di,text:ji,html:qi,raise:Yi,lower:Ji,append:Ki,insert:Qi,remove:ta,clone:ia,datum:aa,on:da,dispatch:ha,[Symbol.iterator]:ma};function ue(t){return typeof t=="string"?new X([[document.querySelector(t)]],[document.documentElement]):new X([[t]],ln)}function ga(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Se(t,e){if(t=ga(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function hr(t){return typeof t=="string"?new X([document.querySelectorAll(t)],[document.documentElement]):new X([nr(t)],ln)}const jt={capture:!0,passive:!1};function Ft(t){t.preventDefault(),t.stopImmediatePropagation()}function _a(t){var e=t.document.documentElement,n=ue(t).on("dragstart.drag",Ft,jt);"onselectstart"in e?n.on("selectstart.drag",Ft,jt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ya(t,e){var n=t.document.documentElement,r=ue(t).on("dragstart.drag",null);e&&(r.on("click.drag",Ft,jt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function cn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function mr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function st(){}var Xe=.7,yt=1/Xe,Me="\\s*([+-]?\\d+)\\s*",Qe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",fe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",va=/^#([0-9a-f]{3,8})$/,ba=new RegExp(`^rgb\\(${Me},${Me},${Me}\\)$`),xa=new RegExp(`^rgb\\(${fe},${fe},${fe}\\)$`),wa=new RegExp(`^rgba\\(${Me},${Me},${Me},${Qe}\\)$`),ka=new RegExp(`^rgba\\(${fe},${fe},${fe},${Qe}\\)$`),Ea=new RegExp(`^hsl\\(${Qe},${fe},${fe}\\)$`),Na=new RegExp(`^hsla\\(${Qe},${fe},${fe},${Qe}\\)$`),yn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};cn(st,et,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:vn,formatHex:vn,formatHex8:Ta,formatHsl:Sa,formatRgb:bn,toString:bn});function vn(){return this.rgb().formatHex()}function Ta(){return this.rgb().formatHex8()}function Sa(){return pr(this).formatHsl()}function bn(){return this.rgb().formatRgb()}function et(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=va.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?xn(e):n===3?new ee(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ct(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ct(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ba.exec(t))?new ee(e[1],e[2],e[3],1):(e=xa.exec(t))?new ee(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=wa.exec(t))?ct(e[1],e[2],e[3],e[4]):(e=ka.exec(t))?ct(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ea.exec(t))?En(e[1],e[2]/100,e[3]/100,1):(e=Na.exec(t))?En(e[1],e[2]/100,e[3]/100,e[4]):yn.hasOwnProperty(t)?xn(yn[t]):t==="transparent"?new ee(NaN,NaN,NaN,0):null}function xn(t){return new ee(t>>16&255,t>>8&255,t&255,1)}function ct(t,e,n,r){return r<=0&&(t=e=n=NaN),new ee(t,e,n,r)}function Ca(t){return t instanceof st||(t=et(t)),t?(t=t.rgb(),new ee(t.r,t.g,t.b,t.opacity)):new ee}function Ut(t,e,n,r){return arguments.length===1?Ca(t):new ee(t,e,n,r??1)}function ee(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}cn(ee,Ut,mr(st,{brighter(t){return t=t==null?yt:Math.pow(yt,t),new ee(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Xe:Math.pow(Xe,t),new ee(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ee(Ie(this.r),Ie(this.g),Ie(this.b),vt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:wn,formatHex:wn,formatHex8:Ia,formatRgb:kn,toString:kn}));function wn(){return`#${Ce(this.r)}${Ce(this.g)}${Ce(this.b)}`}function Ia(){return`#${Ce(this.r)}${Ce(this.g)}${Ce(this.b)}${Ce((isNaN(this.opacity)?1:this.opacity)*255)}`}function kn(){const t=vt(this.opacity);return`${t===1?"rgb(":"rgba("}${Ie(this.r)}, ${Ie(this.g)}, ${Ie(this.b)}${t===1?")":`, ${t})`}`}function vt(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ie(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ce(t){return t=Ie(t),(t<16?"0":"")+t.toString(16)}function En(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new oe(t,e,n,r)}function pr(t){if(t instanceof oe)return new oe(t.h,t.s,t.l,t.opacity);if(t instanceof st||(t=et(t)),!t)return new oe;if(t instanceof oe)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),s=NaN,o=a-i,l=(a+i)/2;return o?(e===a?s=(n-r)/o+(n<r)*6:n===a?s=(r-e)/o+2:s=(e-n)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new oe(s,o,l,t.opacity)}function Aa(t,e,n,r){return arguments.length===1?pr(t):new oe(t,e,n,r??1)}function oe(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}cn(oe,Aa,mr(st,{brighter(t){return t=t==null?yt:Math.pow(yt,t),new oe(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Xe:Math.pow(Xe,t),new oe(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new ee(Mt(t>=240?t-240:t+120,i,r),Mt(t,i,r),Mt(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new oe(Nn(this.h),dt(this.s),dt(this.l),vt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=vt(this.opacity);return`${t===1?"hsl(":"hsla("}${Nn(this.h)}, ${dt(this.s)*100}%, ${dt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Nn(t){return t=(t||0)%360,t<0?t+360:t}function dt(t){return Math.max(0,Math.min(1,t||0))}function Mt(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const gr=t=>()=>t;function Oa(t,e){return function(n){return t+n*e}}function Ra(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Ma(t){return(t=+t)==1?_r:function(e,n){return n-e?Ra(e,n,t):gr(isNaN(e)?n:e)}}function _r(t,e){var n=e-t;return n?Oa(t,n):gr(isNaN(t)?e:t)}const Tn=(function t(e){var n=Ma(e);function r(i,a){var s=n((i=Ut(i)).r,(a=Ut(a)).r),o=n(i.g,a.g),l=n(i.b,a.b),c=_r(i.opacity,a.opacity);return function(d){return i.r=s(d),i.g=o(d),i.b=l(d),i.opacity=c(d),i+""}}return r.gamma=t,r})(1);function xe(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Ht=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,$t=new RegExp(Ht.source,"g");function $a(t){return function(){return t}}function za(t){return function(e){return t(e)+""}}function La(t,e){var n=Ht.lastIndex=$t.lastIndex=0,r,i,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(r=Ht.exec(t))&&(i=$t.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),o[s]?o[s]+=a:o[++s]=a),(r=r[0])===(i=i[0])?o[s]?o[s]+=i:o[++s]=i:(o[++s]=null,l.push({i:s,x:xe(r,i)})),n=$t.lastIndex;return n<e.length&&(a=e.slice(n),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?za(l[0].x):$a(e):(e=l.length,function(c){for(var d=0,u;d<e;++d)o[(u=l[d]).i]=u.x(c);return o.join("")})}var Sn=180/Math.PI,qt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function yr(t,e,n,r,i,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(o=Math.sqrt(n*n+r*r))&&(n/=o,r/=o,l/=o),t*r<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Sn,skewX:Math.atan(l)*Sn,scaleX:s,scaleY:o}}var ut;function Pa(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?qt:yr(e.a,e.b,e.c,e.d,e.e,e.f)}function Da(t){return t==null||(ut||(ut=document.createElementNS("http://www.w3.org/2000/svg","g")),ut.setAttribute("transform",t),!(t=ut.transform.baseVal.consolidate()))?qt:(t=t.matrix,yr(t.a,t.b,t.c,t.d,t.e,t.f))}function vr(t,e,n,r){function i(c){return c.length?c.pop()+" ":""}function a(c,d,u,p,f,_){if(c!==u||d!==p){var h=f.push("translate(",null,e,null,n);_.push({i:h-4,x:xe(c,u)},{i:h-2,x:xe(d,p)})}else(u||p)&&f.push("translate("+u+e+p+n)}function s(c,d,u,p){c!==d?(c-d>180?d+=360:d-c>180&&(c+=360),p.push({i:u.push(i(u)+"rotate(",null,r)-2,x:xe(c,d)})):d&&u.push(i(u)+"rotate("+d+r)}function o(c,d,u,p){c!==d?p.push({i:u.push(i(u)+"skewX(",null,r)-2,x:xe(c,d)}):d&&u.push(i(u)+"skewX("+d+r)}function l(c,d,u,p,f,_){if(c!==u||d!==p){var h=f.push(i(f)+"scale(",null,",",null,")");_.push({i:h-4,x:xe(c,u)},{i:h-2,x:xe(d,p)})}else(u!==1||p!==1)&&f.push(i(f)+"scale("+u+","+p+")")}return function(c,d){var u=[],p=[];return c=t(c),d=t(d),a(c.translateX,c.translateY,d.translateX,d.translateY,u,p),s(c.rotate,d.rotate,u,p),o(c.skewX,d.skewX,u,p),l(c.scaleX,c.scaleY,d.scaleX,d.scaleY,u,p),c=d=null,function(f){for(var _=-1,h=p.length,g;++_<h;)u[(g=p[_]).i]=g.x(f);return u.join("")}}}var Ba=vr(Pa,"px, ","px)","deg)"),Za=vr(Da,", ",")",")"),Va=1e-12;function Cn(t){return((t=Math.exp(t))+1/t)/2}function ja(t){return((t=Math.exp(t))-1/t)/2}function Fa(t){return((t=Math.exp(2*t))-1)/(t+1)}const Ua=(function t(e,n,r){function i(a,s){var o=a[0],l=a[1],c=a[2],d=s[0],u=s[1],p=s[2],f=d-o,_=u-l,h=f*f+_*_,g,y;if(h<Va)y=Math.log(p/c)/e,g=function(E){return[o+E*f,l+E*_,c*Math.exp(e*E*y)]};else{var I=Math.sqrt(h),N=(p*p-c*c+r*h)/(2*c*n*I),v=(p*p-c*c-r*h)/(2*p*n*I),k=Math.log(Math.sqrt(N*N+1)-N),A=Math.log(Math.sqrt(v*v+1)-v);y=(A-k)/e,g=function(E){var j=E*y,U=Cn(k),B=c/(n*I)*(U*Fa(e*j+k)-ja(k));return[o+B*f,l+B*_,c*U/Cn(e*j+k)]}}return g.duration=y*1e3*e/Math.SQRT2,g}return i.rho=function(a){var s=Math.max(.001,+a),o=s*s,l=o*o;return t(s,o,l)},i})(Math.SQRT2,2,4);var Le=0,We=0,Ue=0,br=1e3,bt,Ye,xt=0,Ae=0,At=0,tt=typeof performance=="object"&&performance.now?performance:Date,xr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function dn(){return Ae||(xr(Ha),Ae=tt.now()+At)}function Ha(){Ae=0}function wt(){this._call=this._time=this._next=null}wt.prototype=wr.prototype={constructor:wt,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?dn():+n)+(e==null?0:+e),!this._next&&Ye!==this&&(Ye?Ye._next=this:bt=this,Ye=this),this._call=t,this._time=n,Wt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Wt())}};function wr(t,e,n){var r=new wt;return r.restart(t,e,n),r}function qa(){dn(),++Le;for(var t=bt,e;t;)(e=Ae-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Le}function In(){Ae=(xt=tt.now())+At,Le=We=0;try{qa()}finally{Le=0,Ya(),Ae=0}}function Wa(){var t=tt.now(),e=t-xt;e>br&&(At-=e,xt=t)}function Ya(){for(var t,e=bt,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:bt=n);Ye=t,Wt(r)}function Wt(t){if(!Le){We&&(We=clearTimeout(We));var e=t-Ae;e>24?(t<1/0&&(We=setTimeout(In,t-tt.now()-At)),Ue&&(Ue=clearInterval(Ue))):(Ue||(xt=tt.now(),Ue=setInterval(Wa,br)),Le=1,xr(In))}}function An(t,e,n){var r=new wt;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Ga=an("start","end","cancel","interrupt"),Ja=[],kr=0,On=1,Yt=2,mt=3,Rn=4,Gt=5,pt=6;function Ot(t,e,n,r,i,a){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;Ka(t,n,{name:e,index:r,group:i,on:Ga,tween:Ja,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:kr})}function un(t,e){var n=le(t,e);if(n.state>kr)throw new Error("too late; already scheduled");return n}function me(t,e){var n=le(t,e);if(n.state>mt)throw new Error("too late; already running");return n}function le(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Ka(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=wr(a,0,n.time);function a(c){n.state=On,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)}function s(c){var d,u,p,f;if(n.state!==On)return l();for(d in r)if(f=r[d],f.name===n.name){if(f.state===mt)return An(s);f.state===Rn?(f.state=pt,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete r[d]):+d<e&&(f.state=pt,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete r[d])}if(An(function(){n.state===mt&&(n.state=Rn,n.timer.restart(o,n.delay,n.time),o(c))}),n.state=Yt,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Yt){for(n.state=mt,i=new Array(p=n.tween.length),d=0,u=-1;d<p;++d)(f=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(i[++u]=f);i.length=u+1}}function o(c){for(var d=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=Gt,1),u=-1,p=i.length;++u<p;)i[u].call(t,d);n.state===Gt&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=pt,n.timer.stop(),delete r[e];for(var c in r)return;delete t.__transition}}function gt(t,e){var n=t.__transition,r,i,a=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){a=!1;continue}i=r.state>Yt&&r.state<Gt,r.state=pt,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}a&&delete t.__transition}}function Xa(t){return this.each(function(){gt(this,t)})}function Qa(t,e){var n,r;return function(){var i=me(this,t),a=i.tween;if(a!==n){r=n=a;for(var s=0,o=r.length;s<o;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}i.tween=r}}function es(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=me(this,t),s=a.tween;if(s!==r){i=(r=s).slice();for(var o={name:e,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===e){i[l]=o;break}l===c&&i.push(o)}a.tween=i}}function ts(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=le(this.node(),n).tween,i=0,a=r.length,s;i<a;++i)if((s=r[i]).name===t)return s.value;return null}return this.each((e==null?Qa:es)(n,t,e))}function fn(t,e,n){var r=t._id;return t.each(function(){var i=me(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return le(i,r).value[e]}}function Er(t,e){var n;return(typeof e=="number"?xe:e instanceof et?Tn:(n=et(e))?(e=n,Tn):La)(t,e)}function ns(t){return function(){this.removeAttribute(t)}}function rs(t){return function(){this.removeAttributeNS(t.space,t.local)}}function is(t,e,n){var r,i=n+"",a;return function(){var s=this.getAttribute(t);return s===i?null:s===r?a:a=e(r=s,n)}}function as(t,e,n){var r,i=n+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===i?null:s===r?a:a=e(r=s,n)}}function ss(t,e,n){var r,i,a;return function(){var s,o=n(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===r&&l===i?a:(i=l,a=e(r=s,o)))}}function os(t,e,n){var r,i,a;return function(){var s,o=n(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===r&&l===i?a:(i=l,a=e(r=s,o)))}}function ls(t,e){var n=It(t),r=n==="transform"?Za:Er;return this.attrTween(t,typeof e=="function"?(n.local?os:ss)(n,r,fn(this,"attr."+t,e)):e==null?(n.local?rs:ns)(n):(n.local?as:is)(n,r,e))}function cs(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function ds(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function us(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&ds(t,a)),n}return i._value=e,i}function fs(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&cs(t,a)),n}return i._value=e,i}function hs(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=It(t);return this.tween(n,(r.local?us:fs)(r,e))}function ms(t,e){return function(){un(this,t).delay=+e.apply(this,arguments)}}function ps(t,e){return e=+e,function(){un(this,t).delay=e}}function gs(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ms:ps)(e,t)):le(this.node(),e).delay}function _s(t,e){return function(){me(this,t).duration=+e.apply(this,arguments)}}function ys(t,e){return e=+e,function(){me(this,t).duration=e}}function vs(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?_s:ys)(e,t)):le(this.node(),e).duration}function bs(t,e){if(typeof e!="function")throw new Error;return function(){me(this,t).ease=e}}function xs(t){var e=this._id;return arguments.length?this.each(bs(e,t)):le(this.node(),e).ease}function ws(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;me(this,t).ease=n}}function ks(t){if(typeof t!="function")throw new Error;return this.each(ws(this._id,t))}function Es(t){typeof t!="function"&&(t=ir(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],s=a.length,o=r[i]=[],l,c=0;c<s;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&o.push(l);return new ve(r,this._parents,this._name,this._id)}function Ns(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),s=new Array(r),o=0;o<a;++o)for(var l=e[o],c=n[o],d=l.length,u=s[o]=new Array(d),p,f=0;f<d;++f)(p=l[f]||c[f])&&(u[f]=p);for(;o<r;++o)s[o]=e[o];return new ve(s,this._parents,this._name,this._id)}function Ts(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Ss(t,e,n){var r,i,a=Ts(e)?un:me;return function(){var s=a(this,t),o=s.on;o!==r&&(i=(r=o).copy()).on(e,n),s.on=i}}function Cs(t,e){var n=this._id;return arguments.length<2?le(this.node(),n).on.on(t):this.each(Ss(n,t,e))}function Is(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function As(){return this.on("end.remove",Is(this._id))}function Os(t){var e=this._name,n=this._id;typeof t!="function"&&(t=sn(t));for(var r=this._groups,i=r.length,a=new Array(i),s=0;s<i;++s)for(var o=r[s],l=o.length,c=a[s]=new Array(l),d,u,p=0;p<l;++p)(d=o[p])&&(u=t.call(d,d.__data__,p,o))&&("__data__"in d&&(u.__data__=d.__data__),c[p]=u,Ot(c[p],e,n,p,c,le(d,n)));return new ve(a,this._parents,e,n)}function Rs(t){var e=this._name,n=this._id;typeof t!="function"&&(t=rr(t));for(var r=this._groups,i=r.length,a=[],s=[],o=0;o<i;++o)for(var l=r[o],c=l.length,d,u=0;u<c;++u)if(d=l[u]){for(var p=t.call(d,d.__data__,u,l),f,_=le(d,n),h=0,g=p.length;h<g;++h)(f=p[h])&&Ot(f,e,n,h,p,_);a.push(p),s.push(d)}return new ve(a,s,e,n)}var Ms=at.prototype.constructor;function $s(){return new Ms(this._groups,this._parents)}function zs(t,e){var n,r,i;return function(){var a=ze(this,t),s=(this.style.removeProperty(t),ze(this,t));return a===s?null:a===n&&s===r?i:i=e(n=a,r=s)}}function Nr(t){return function(){this.style.removeProperty(t)}}function Ls(t,e,n){var r,i=n+"",a;return function(){var s=ze(this,t);return s===i?null:s===r?a:a=e(r=s,n)}}function Ps(t,e,n){var r,i,a;return function(){var s=ze(this,t),o=n(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),ze(this,t))),s===l?null:s===r&&l===i?a:(i=l,a=e(r=s,o))}}function Ds(t,e){var n,r,i,a="style."+e,s="end."+a,o;return function(){var l=me(this,t),c=l.on,d=l.value[a]==null?o||(o=Nr(e)):void 0;(c!==n||i!==d)&&(r=(n=c).copy()).on(s,i=d),l.on=r}}function Bs(t,e,n){var r=(t+="")=="transform"?Ba:Er;return e==null?this.styleTween(t,zs(t,r)).on("end.style."+t,Nr(t)):typeof e=="function"?this.styleTween(t,Ps(t,r,fn(this,"style."+t,e))).each(Ds(this._id,t)):this.styleTween(t,Ls(t,r,e),n).on("end.style."+t,null)}function Zs(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Vs(t,e,n){var r,i;function a(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&Zs(t,s,n)),r}return a._value=e,a}function js(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Vs(t,e,n??""))}function Fs(t){return function(){this.textContent=t}}function Us(t){return function(){var e=t(this);this.textContent=e??""}}function Hs(t){return this.tween("text",typeof t=="function"?Us(fn(this,"text",t)):Fs(t==null?"":t+""))}function qs(t){return function(e){this.textContent=t.call(this,e)}}function Ws(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&qs(i)),e}return r._value=t,r}function Ys(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Ws(t))}function Gs(){for(var t=this._name,e=this._id,n=Tr(),r=this._groups,i=r.length,a=0;a<i;++a)for(var s=r[a],o=s.length,l,c=0;c<o;++c)if(l=s[c]){var d=le(l,e);Ot(l,t,n,c,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new ve(r,this._parents,t,n)}function Js(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--i===0&&a()}};n.each(function(){var c=me(this,r),d=c.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),c.on=e}),i===0&&a()})}var Ks=0;function ve(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Tr(){return++Ks}var _e=at.prototype;ve.prototype={constructor:ve,select:Os,selectAll:Rs,selectChild:_e.selectChild,selectChildren:_e.selectChildren,filter:Es,merge:Ns,selection:$s,transition:Gs,call:_e.call,nodes:_e.nodes,node:_e.node,size:_e.size,empty:_e.empty,each:_e.each,on:Cs,attr:ls,attrTween:hs,style:Bs,styleTween:js,text:Hs,textTween:Ys,remove:As,tween:ts,delay:gs,duration:vs,ease:xs,easeVarying:ks,end:Js,[Symbol.iterator]:_e[Symbol.iterator]};function Xs(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Qs={time:null,delay:0,duration:250,ease:Xs};function eo(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function to(t){var e,n;t instanceof ve?(e=t._id,t=t._name):(e=Tr(),(n=Qs).time=dn(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var s=r[a],o=s.length,l,c=0;c<o;++c)(l=s[c])&&Ot(l,t,e,c,s,n||eo(l,e));return new ve(r,this._parents,t,e)}at.prototype.interrupt=Xa;at.prototype.transition=to;var Mn={},zt={},Lt=34,He=10,Pt=13;function Sr(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function no(t,e){var n=Sr(t);return function(r,i){return e(n(r),i,t)}}function $n(t){var e=Object.create(null),n=[];return t.forEach(function(r){for(var i in r)i in e||n.push(e[i]=i)}),n}function Q(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function ro(t){return t<0?"-"+Q(-t,6):t>9999?"+"+Q(t,6):Q(t,4)}function io(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":ro(t.getUTCFullYear())+"-"+Q(t.getUTCMonth()+1,2)+"-"+Q(t.getUTCDate(),2)+(i?"T"+Q(e,2)+":"+Q(n,2)+":"+Q(r,2)+"."+Q(i,3)+"Z":r?"T"+Q(e,2)+":"+Q(n,2)+":"+Q(r,2)+"Z":n||e?"T"+Q(e,2)+":"+Q(n,2)+"Z":"")}function ao(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function r(u,p){var f,_,h=i(u,function(g,y){if(f)return f(g,y-1);_=g,f=p?no(g,p):Sr(g)});return h.columns=_||[],h}function i(u,p){var f=[],_=u.length,h=0,g=0,y,I=_<=0,N=!1;u.charCodeAt(_-1)===He&&--_,u.charCodeAt(_-1)===Pt&&--_;function v(){if(I)return zt;if(N)return N=!1,Mn;var A,E=h,j;if(u.charCodeAt(E)===Lt){for(;h++<_&&u.charCodeAt(h)!==Lt||u.charCodeAt(++h)===Lt;);return(A=h)>=_?I=!0:(j=u.charCodeAt(h++))===He?N=!0:j===Pt&&(N=!0,u.charCodeAt(h)===He&&++h),u.slice(E+1,A-1).replace(/""/g,'"')}for(;h<_;){if((j=u.charCodeAt(A=h++))===He)N=!0;else if(j===Pt)N=!0,u.charCodeAt(h)===He&&++h;else if(j!==n)continue;return u.slice(E,A)}return I=!0,u.slice(E,_)}for(;(y=v())!==zt;){for(var k=[];y!==Mn&&y!==zt;)k.push(y),y=v();p&&(k=p(k,g++))==null||f.push(k)}return f}function a(u,p){return u.map(function(f){return p.map(function(_){return d(f[_])}).join(t)})}function s(u,p){return p==null&&(p=$n(u)),[p.map(d).join(t)].concat(a(u,p)).join(`
`)}function o(u,p){return p==null&&(p=$n(u)),a(u,p).join(`
`)}function l(u){return u.map(c).join(`
`)}function c(u){return u.map(d).join(t)}function d(u){return u==null?"":u instanceof Date?io(u):e.test(u+="")?'"'+u.replace(/"/g,'""')+'"':u}return{parse:r,parseRows:i,format:s,formatBody:o,formatRows:l,formatRow:c,formatValue:d}}var so=ao(","),oo=so.parseRows;function lo(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function co(t,e){return fetch(t,e).then(lo)}const ft=t=>()=>t;function uo(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function ye(t,e,n){this.k=t,this.x=e,this.y=n}ye.prototype={constructor:ye,scale:function(t){return t===1?this:new ye(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ye(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var $e=new ye(1,0,0);Je.prototype=ye.prototype;function Je(t){for(;!t.__zoom;)if(!(t=t.parentNode))return $e;return t.__zoom}function Dt(t){t.stopImmediatePropagation()}function qe(t){t.preventDefault(),t.stopImmediatePropagation()}function fo(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function ho(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function zn(){return this.__zoom||$e}function mo(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function po(){return navigator.maxTouchPoints||"ontouchstart"in this}function go(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>a?(a+s)/2:Math.min(0,a)||Math.max(0,s))}function _o(){var t=fo,e=ho,n=go,r=mo,i=po,a=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],o=250,l=Ua,c=an("start","zoom","end"),d,u,p,f=500,_=150,h=0,g=10;function y(m){m.property("__zoom",zn).on("wheel.zoom",j,{passive:!1}).on("mousedown.zoom",U).on("dblclick.zoom",B).filter(i).on("touchstart.zoom",F).on("touchmove.zoom",P).on("touchend.zoom touchcancel.zoom",W).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(m,T,b,O){var $=m.selection?m.selection():m;$.property("__zoom",zn),m!==$?k(m,T,b,O):$.interrupt().each(function(){A(this,arguments).event(O).start().zoom(null,typeof T=="function"?T.apply(this,arguments):T).end()})},y.scaleBy=function(m,T,b,O){y.scaleTo(m,function(){var $=this.__zoom.k,z=typeof T=="function"?T.apply(this,arguments):T;return $*z},b,O)},y.scaleTo=function(m,T,b,O){y.transform(m,function(){var $=e.apply(this,arguments),z=this.__zoom,D=b==null?v($):typeof b=="function"?b.apply(this,arguments):b,Y=z.invert(D),G=typeof T=="function"?T.apply(this,arguments):T;return n(N(I(z,G),D,Y),$,s)},b,O)},y.translateBy=function(m,T,b,O){y.transform(m,function(){return n(this.__zoom.translate(typeof T=="function"?T.apply(this,arguments):T,typeof b=="function"?b.apply(this,arguments):b),e.apply(this,arguments),s)},null,O)},y.translateTo=function(m,T,b,O,$){y.transform(m,function(){var z=e.apply(this,arguments),D=this.__zoom,Y=O==null?v(z):typeof O=="function"?O.apply(this,arguments):O;return n($e.translate(Y[0],Y[1]).scale(D.k).translate(typeof T=="function"?-T.apply(this,arguments):-T,typeof b=="function"?-b.apply(this,arguments):-b),z,s)},O,$)};function I(m,T){return T=Math.max(a[0],Math.min(a[1],T)),T===m.k?m:new ye(T,m.x,m.y)}function N(m,T,b){var O=T[0]-b[0]*m.k,$=T[1]-b[1]*m.k;return O===m.x&&$===m.y?m:new ye(m.k,O,$)}function v(m){return[(+m[0][0]+ +m[1][0])/2,(+m[0][1]+ +m[1][1])/2]}function k(m,T,b,O){m.on("start.zoom",function(){A(this,arguments).event(O).start()}).on("interrupt.zoom end.zoom",function(){A(this,arguments).event(O).end()}).tween("zoom",function(){var $=this,z=arguments,D=A($,z).event(O),Y=e.apply($,z),G=b==null?v(Y):typeof b=="function"?b.apply($,z):b,ce=Math.max(Y[1][0]-Y[0][0],Y[1][1]-Y[0][1]),K=$.__zoom,ae=typeof T=="function"?T.apply($,z):T,pe=l(K.invert(G).concat(ce/K.k),ae.invert(G).concat(ce/ae.k));return function(se){if(se===1)se=ae;else{var ge=pe(se),Rt=ce/ge[2];se=new ye(Rt,G[0]-ge[0]*Rt,G[1]-ge[1]*Rt)}D.zoom(null,se)}})}function A(m,T,b){return!b&&m.__zooming||new E(m,T)}function E(m,T){this.that=m,this.args=T,this.active=0,this.sourceEvent=null,this.extent=e.apply(m,T),this.taps=0}E.prototype={event:function(m){return m&&(this.sourceEvent=m),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(m,T){return this.mouse&&m!=="mouse"&&(this.mouse[1]=T.invert(this.mouse[0])),this.touch0&&m!=="touch"&&(this.touch0[1]=T.invert(this.touch0[0])),this.touch1&&m!=="touch"&&(this.touch1[1]=T.invert(this.touch1[0])),this.that.__zoom=T,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(m){var T=ue(this.that).datum();c.call(m,this.that,new uo(m,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:c}),T)}};function j(m,...T){if(!t.apply(this,arguments))return;var b=A(this,T).event(m),O=this.__zoom,$=Math.max(a[0],Math.min(a[1],O.k*Math.pow(2,r.apply(this,arguments)))),z=Se(m);if(b.wheel)(b.mouse[0][0]!==z[0]||b.mouse[0][1]!==z[1])&&(b.mouse[1]=O.invert(b.mouse[0]=z)),clearTimeout(b.wheel);else{if(O.k===$)return;b.mouse=[z,O.invert(z)],gt(this),b.start()}qe(m),b.wheel=setTimeout(D,_),b.zoom("mouse",n(N(I(O,$),b.mouse[0],b.mouse[1]),b.extent,s));function D(){b.wheel=null,b.end()}}function U(m,...T){if(p||!t.apply(this,arguments))return;var b=m.currentTarget,O=A(this,T,!0).event(m),$=ue(m.view).on("mousemove.zoom",G,!0).on("mouseup.zoom",ce,!0),z=Se(m,b),D=m.clientX,Y=m.clientY;_a(m.view),Dt(m),O.mouse=[z,this.__zoom.invert(z)],gt(this),O.start();function G(K){if(qe(K),!O.moved){var ae=K.clientX-D,pe=K.clientY-Y;O.moved=ae*ae+pe*pe>h}O.event(K).zoom("mouse",n(N(O.that.__zoom,O.mouse[0]=Se(K,b),O.mouse[1]),O.extent,s))}function ce(K){$.on("mousemove.zoom mouseup.zoom",null),ya(K.view,O.moved),qe(K),O.event(K).end()}}function B(m,...T){if(t.apply(this,arguments)){var b=this.__zoom,O=Se(m.changedTouches?m.changedTouches[0]:m,this),$=b.invert(O),z=b.k*(m.shiftKey?.5:2),D=n(N(I(b,z),O,$),e.apply(this,T),s);qe(m),o>0?ue(this).transition().duration(o).call(k,D,O,m):ue(this).call(y.transform,D,O,m)}}function F(m,...T){if(t.apply(this,arguments)){var b=m.touches,O=b.length,$=A(this,T,m.changedTouches.length===O).event(m),z,D,Y,G;for(Dt(m),D=0;D<O;++D)Y=b[D],G=Se(Y,this),G=[G,this.__zoom.invert(G),Y.identifier],$.touch0?!$.touch1&&$.touch0[2]!==G[2]&&($.touch1=G,$.taps=0):($.touch0=G,z=!0,$.taps=1+!!d);d&&(d=clearTimeout(d)),z&&($.taps<2&&(u=G[0],d=setTimeout(function(){d=null},f)),gt(this),$.start())}}function P(m,...T){if(this.__zooming){var b=A(this,T).event(m),O=m.changedTouches,$=O.length,z,D,Y,G;for(qe(m),z=0;z<$;++z)D=O[z],Y=Se(D,this),b.touch0&&b.touch0[2]===D.identifier?b.touch0[0]=Y:b.touch1&&b.touch1[2]===D.identifier&&(b.touch1[0]=Y);if(D=b.that.__zoom,b.touch1){var ce=b.touch0[0],K=b.touch0[1],ae=b.touch1[0],pe=b.touch1[1],se=(se=ae[0]-ce[0])*se+(se=ae[1]-ce[1])*se,ge=(ge=pe[0]-K[0])*ge+(ge=pe[1]-K[1])*ge;D=I(D,Math.sqrt(se/ge)),Y=[(ce[0]+ae[0])/2,(ce[1]+ae[1])/2],G=[(K[0]+pe[0])/2,(K[1]+pe[1])/2]}else if(b.touch0)Y=b.touch0[0],G=b.touch0[1];else return;b.zoom("touch",n(N(D,Y,G),b.extent,s))}}function W(m,...T){if(this.__zooming){var b=A(this,T).event(m),O=m.changedTouches,$=O.length,z,D;for(Dt(m),p&&clearTimeout(p),p=setTimeout(function(){p=null},f),z=0;z<$;++z)D=O[z],b.touch0&&b.touch0[2]===D.identifier?delete b.touch0:b.touch1&&b.touch1[2]===D.identifier&&delete b.touch1;if(b.touch1&&!b.touch0&&(b.touch0=b.touch1,delete b.touch1),b.touch0)b.touch0[1]=this.__zoom.invert(b.touch0[0]);else if(b.end(),b.taps===2&&(D=Se(D,this),Math.hypot(u[0]-D[0],u[1]-D[1])<g)){var Y=ue(this).on("dblclick.zoom");Y&&Y.apply(this,arguments)}}}return y.wheelDelta=function(m){return arguments.length?(r=typeof m=="function"?m:ft(+m),y):r},y.filter=function(m){return arguments.length?(t=typeof m=="function"?m:ft(!!m),y):t},y.touchable=function(m){return arguments.length?(i=typeof m=="function"?m:ft(!!m),y):i},y.extent=function(m){return arguments.length?(e=typeof m=="function"?m:ft([[+m[0][0],+m[0][1]],[+m[1][0],+m[1][1]]]),y):e},y.scaleExtent=function(m){return arguments.length?(a[0]=+m[0],a[1]=+m[1],y):[a[0],a[1]]},y.translateExtent=function(m){return arguments.length?(s[0][0]=+m[0][0],s[1][0]=+m[1][0],s[0][1]=+m[0][1],s[1][1]=+m[1][1],y):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},y.constrain=function(m){return arguments.length?(n=m,y):n},y.duration=function(m){return arguments.length?(o=+m,y):o},y.interpolate=function(m){return arguments.length?(l=m,y):l},y.on=function(){var m=c.on.apply(c,arguments);return m===c?y:m},y.clickDistance=function(m){return arguments.length?(h=(m=+m)*m,y):Math.sqrt(h)},y.tapDistance=function(m){return arguments.length?(g=+m,y):g},y}var V;(function(t){t.assertEqual=i=>{};function e(i){}t.assertIs=e;function n(i){throw new Error}t.assertNever=n,t.arrayToEnum=i=>{const a={};for(const s of i)a[s]=s;return a},t.getValidEnumValues=i=>{const a=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(const o of a)s[o]=i[o];return t.objectValues(s)},t.objectValues=i=>t.objectKeys(i).map(function(a){return i[a]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},t.find=(i,a)=>{for(const s of i)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=r,t.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(V||(V={}));var Ln;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Ln||(Ln={}));const S=V.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),we=t=>{switch(typeof t){case"undefined":return S.undefined;case"string":return S.string;case"number":return Number.isNaN(t)?S.nan:S.number;case"boolean":return S.boolean;case"function":return S.function;case"bigint":return S.bigint;case"symbol":return S.symbol;case"object":return Array.isArray(t)?S.array:t===null?S.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?S.promise:typeof Map<"u"&&t instanceof Map?S.map:typeof Set<"u"&&t instanceof Set?S.set:typeof Date<"u"&&t instanceof Date?S.date:S.object;default:return S.unknown}},x=V.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class be extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},r={_errors:[]},i=a=>{for(const s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)r._errors.push(n(s));else{let o=r,l=0;for(;l<s.path.length;){const c=s.path[l];l===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(n(s))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return i(this),r}static assert(e){if(!(e instanceof be))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,V.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const i of this.issues)if(i.path.length>0){const a=i.path[0];n[a]=n[a]||[],n[a].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}be.create=t=>new be(t);const Jt=(t,e)=>{let n;switch(t.code){case x.invalid_type:t.received===S.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case x.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,V.jsonStringifyReplacer)}`;break;case x.unrecognized_keys:n=`Unrecognized key(s) in object: ${V.joinValues(t.keys,", ")}`;break;case x.invalid_union:n="Invalid input";break;case x.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${V.joinValues(t.options)}`;break;case x.invalid_enum_value:n=`Invalid enum value. Expected ${V.joinValues(t.options)}, received '${t.received}'`;break;case x.invalid_arguments:n="Invalid function arguments";break;case x.invalid_return_type:n="Invalid function return type";break;case x.invalid_date:n="Invalid date";break;case x.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:V.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case x.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case x.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case x.custom:n="Invalid input";break;case x.invalid_intersection_types:n="Intersection results could not be merged";break;case x.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case x.not_finite:n="Number must be finite";break;default:n=e.defaultError,V.assertNever(t)}return{message:n}};let yo=Jt;function vo(){return yo}const bo=t=>{const{data:e,path:n,errorMaps:r,issueData:i}=t,a=[...n,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="";const l=r.filter(c=>!!c).slice().reverse();for(const c of l)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}};function w(t,e){const n=vo(),r=bo({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Jt?void 0:Jt].filter(i=>!!i)});t.common.issues.push(r)}class re{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const i of n){if(i.status==="aborted")return R;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const i of n){const a=await i.key,s=await i.value;r.push({key:a,value:s})}return re.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const i of n){const{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}}const R=Object.freeze({status:"aborted"}),Ge=t=>({status:"dirty",value:t}),ie=t=>({status:"valid",value:t}),Pn=t=>t.status==="aborted",Dn=t=>t.status==="dirty",Pe=t=>t.status==="valid",kt=t=>typeof Promise<"u"&&t instanceof Promise;var C;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(C||(C={}));class Ne{constructor(e,n,r,i){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Bn=(t,e)=>{if(Pe(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new be(t.common.issues);return this._error=n,this._error}}};function L(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:i}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{const{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??r??o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:l??n??o.defaultError}},description:i}}class Z{get description(){return this._def.description}_getType(e){return we(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:we(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new re,ctx:{common:e.parent.common,data:e.data,parsedType:we(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(kt(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){const r={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)},i=this._parseSync({data:e,path:r.path,parent:r});return Bn(r,i)}"~validate"(e){const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:n});return Pe(r)?{value:r.value}:{issues:n.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(r=>Pe(r)?{value:r.value}:{issues:n.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)},i=this._parse({data:e,path:r.path,parent:r}),a=await(kt(i)?i:Promise.resolve(i));return Bn(r,a)}refine(e,n){const r=i=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(i):n;return this._refinement((i,a)=>{const s=e(i),o=()=>a.addIssue({code:x.custom,...r(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(l=>l?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof n=="function"?n(r,i):n),!1))}_refinement(e){return new Ze({schema:this,typeName:M.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Ee.create(this,this._def)}nullable(){return Ve.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return he.create(this)}promise(){return St.create(this,this._def)}or(e){return Nt.create([this,e],this._def)}and(e){return Tt.create(this,e,this._def)}transform(e){return new Ze({...L(this._def),schema:this,typeName:M.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new Qt({...L(this._def),innerType:this,defaultValue:n,typeName:M.ZodDefault})}brand(){return new Fo({typeName:M.ZodBranded,type:this,...L(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new en({...L(this._def),innerType:this,catchValue:n,typeName:M.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return hn.create(this,e)}readonly(){return tn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const xo=/^c[^\s-]{8,}$/i,wo=/^[0-9a-z]+$/,ko=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Eo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,No=/^[a-z0-9_-]{21}$/i,To=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,So=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Co=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Io="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Bt;const Ao=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Oo=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ro=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Mo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,$o=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,zo=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Cr="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Lo=new RegExp(`^${Cr}$`);function Ir(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function Po(t){return new RegExp(`^${Ir(t)}$`)}function Do(t){let e=`${Cr}T${Ir(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function Bo(t,e){return!!((e==="v4"||!e)&&Ao.test(t)||(e==="v6"||!e)&&Ro.test(t))}function Zo(t,e){if(!To.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&i?.typ!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function Vo(t,e){return!!((e==="v4"||!e)&&Oo.test(t)||(e==="v6"||!e)&&Mo.test(t))}class ke extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==S.string){const a=this._getOrReturnCtx(e);return w(a,{code:x.invalid_type,expected:S.string,received:a.parsedType}),R}const r=new re;let i;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),w(i,{code:x.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),w(i,{code:x.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?w(i,{code:x.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&w(i,{code:x.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")Co.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"email",code:x.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")Bt||(Bt=new RegExp(Io,"u")),Bt.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"emoji",code:x.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")Eo.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"uuid",code:x.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")No.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"nanoid",code:x.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")xo.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"cuid",code:x.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")wo.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"cuid2",code:x.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")ko.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"ulid",code:x.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),w(i,{validation:"url",code:x.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"regex",code:x.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),w(i,{code:x.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),w(i,{code:x.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),w(i,{code:x.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?Do(a).test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{code:x.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?Lo.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{code:x.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?Po(a).test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{code:x.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?So.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"duration",code:x.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?Bo(e.data,a.version)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"ip",code:x.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?Zo(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"jwt",code:x.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?Vo(e.data,a.version)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"cidr",code:x.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?$o.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"base64",code:x.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?zo.test(e.data)||(i=this._getOrReturnCtx(e,i),w(i,{validation:"base64url",code:x.invalid_string,message:a.message}),r.dirty()):V.assertNever(a);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(i=>e.test(i),{validation:n,code:x.invalid_string,...C.errToObj(r)})}_addCheck(e){return new ke({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...C.errToObj(e)})}url(e){return this._addCheck({kind:"url",...C.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...C.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...C.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...C.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...C.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...C.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...C.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...C.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...C.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...C.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...C.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...C.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...C.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...C.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...C.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...C.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...C.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...C.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...C.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...C.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...C.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...C.errToObj(n)})}nonempty(e){return this.min(1,C.errToObj(e))}trim(){return new ke({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ke({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ke({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}ke.create=t=>new ke({checks:[],typeName:M.ZodString,coerce:t?.coerce??!1,...L(t)});function jo(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=n>r?n:r,a=Number.parseInt(t.toFixed(i).replace(".","")),s=Number.parseInt(e.toFixed(i).replace(".",""));return a%s/10**i}class De extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==S.number){const a=this._getOrReturnCtx(e);return w(a,{code:x.invalid_type,expected:S.number,received:a.parsedType}),R}let r;const i=new re;for(const a of this._def.checks)a.kind==="int"?V.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:x.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),w(r,{code:x.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),w(r,{code:x.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?jo(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),w(r,{code:x.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:x.not_finite,message:a.message}),i.dirty()):V.assertNever(a);return{status:i.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,C.toString(n))}gt(e,n){return this.setLimit("min",e,!1,C.toString(n))}lte(e,n){return this.setLimit("max",e,!0,C.toString(n))}lt(e,n){return this.setLimit("max",e,!1,C.toString(n))}setLimit(e,n,r,i){return new De({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:C.toString(i)}]})}_addCheck(e){return new De({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:C.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:C.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:C.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:C.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&V.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}}De.create=t=>new De({checks:[],typeName:M.ZodNumber,coerce:t?.coerce||!1,...L(t)});class nt extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==S.bigint)return this._getInvalidInput(e);let r;const i=new re;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),w(r,{code:x.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),w(r,{code:x.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),w(r,{code:x.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):V.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return w(n,{code:x.invalid_type,expected:S.bigint,received:n.parsedType}),R}gte(e,n){return this.setLimit("min",e,!0,C.toString(n))}gt(e,n){return this.setLimit("min",e,!1,C.toString(n))}lte(e,n){return this.setLimit("max",e,!0,C.toString(n))}lt(e,n){return this.setLimit("max",e,!1,C.toString(n))}setLimit(e,n,r,i){return new nt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:C.toString(i)}]})}_addCheck(e){return new nt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}nt.create=t=>new nt({checks:[],typeName:M.ZodBigInt,coerce:t?.coerce??!1,...L(t)});class Kt extends Z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==S.boolean){const r=this._getOrReturnCtx(e);return w(r,{code:x.invalid_type,expected:S.boolean,received:r.parsedType}),R}return ie(e.data)}}Kt.create=t=>new Kt({typeName:M.ZodBoolean,coerce:t?.coerce||!1,...L(t)});class Et extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==S.date){const a=this._getOrReturnCtx(e);return w(a,{code:x.invalid_type,expected:S.date,received:a.parsedType}),R}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return w(a,{code:x.invalid_date}),R}const r=new re;let i;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),w(i,{code:x.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),w(i,{code:x.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):V.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Et({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:C.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:C.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Et.create=t=>new Et({checks:[],coerce:t?.coerce||!1,typeName:M.ZodDate,...L(t)});class Zn extends Z{_parse(e){if(this._getType(e)!==S.symbol){const r=this._getOrReturnCtx(e);return w(r,{code:x.invalid_type,expected:S.symbol,received:r.parsedType}),R}return ie(e.data)}}Zn.create=t=>new Zn({typeName:M.ZodSymbol,...L(t)});class Vn extends Z{_parse(e){if(this._getType(e)!==S.undefined){const r=this._getOrReturnCtx(e);return w(r,{code:x.invalid_type,expected:S.undefined,received:r.parsedType}),R}return ie(e.data)}}Vn.create=t=>new Vn({typeName:M.ZodUndefined,...L(t)});class jn extends Z{_parse(e){if(this._getType(e)!==S.null){const r=this._getOrReturnCtx(e);return w(r,{code:x.invalid_type,expected:S.null,received:r.parsedType}),R}return ie(e.data)}}jn.create=t=>new jn({typeName:M.ZodNull,...L(t)});class Fn extends Z{constructor(){super(...arguments),this._any=!0}_parse(e){return ie(e.data)}}Fn.create=t=>new Fn({typeName:M.ZodAny,...L(t)});class Un extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ie(e.data)}}Un.create=t=>new Un({typeName:M.ZodUnknown,...L(t)});class Te extends Z{_parse(e){const n=this._getOrReturnCtx(e);return w(n,{code:x.invalid_type,expected:S.never,received:n.parsedType}),R}}Te.create=t=>new Te({typeName:M.ZodNever,...L(t)});class Hn extends Z{_parse(e){if(this._getType(e)!==S.undefined){const r=this._getOrReturnCtx(e);return w(r,{code:x.invalid_type,expected:S.void,received:r.parsedType}),R}return ie(e.data)}}Hn.create=t=>new Hn({typeName:M.ZodVoid,...L(t)});class he extends Z{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),i=this._def;if(n.parsedType!==S.array)return w(n,{code:x.invalid_type,expected:S.array,received:n.parsedType}),R;if(i.exactLength!==null){const s=n.data.length>i.exactLength.value,o=n.data.length<i.exactLength.value;(s||o)&&(w(n,{code:s?x.too_big:x.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&n.data.length<i.minLength.value&&(w(n,{code:x.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&n.data.length>i.maxLength.value&&(w(n,{code:x.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((s,o)=>i.type._parseAsync(new Ne(n,s,n.path,o)))).then(s=>re.mergeArray(r,s));const a=[...n.data].map((s,o)=>i.type._parseSync(new Ne(n,s,n.path,o)));return re.mergeArray(r,a)}get element(){return this._def.type}min(e,n){return new he({...this._def,minLength:{value:e,message:C.toString(n)}})}max(e,n){return new he({...this._def,maxLength:{value:e,message:C.toString(n)}})}length(e,n){return new he({...this._def,exactLength:{value:e,message:C.toString(n)}})}nonempty(e){return this.min(1,e)}}he.create=(t,e)=>new he({type:t,minLength:null,maxLength:null,exactLength:null,typeName:M.ZodArray,...L(e)});function Re(t){if(t instanceof J){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=Ee.create(Re(r))}return new J({...t._def,shape:()=>e})}else return t instanceof he?new he({...t._def,type:Re(t.element)}):t instanceof Ee?Ee.create(Re(t.unwrap())):t instanceof Ve?Ve.create(Re(t.unwrap())):t instanceof Oe?Oe.create(t.items.map(e=>Re(e))):t}class J extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=V.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==S.object){const c=this._getOrReturnCtx(e);return w(c,{code:x.invalid_type,expected:S.object,received:c.parsedType}),R}const{status:r,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof Te&&this._def.unknownKeys==="strip"))for(const c in i.data)s.includes(c)||o.push(c);const l=[];for(const c of s){const d=a[c],u=i.data[c];l.push({key:{status:"valid",value:c},value:d._parse(new Ne(i,u,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Te){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of o)l.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(c==="strict")o.length>0&&(w(i,{code:x.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of o){const u=i.data[d];l.push({key:{status:"valid",value:d},value:c._parse(new Ne(i,u,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of l){const u=await d.key,p=await d.value;c.push({key:u,value:p,alwaysSet:d.alwaysSet})}return c}).then(c=>re.mergeObjectSync(r,c)):re.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return C.errToObj,new J({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{const i=this._def.errorMap?.(n,r).message??r.defaultError;return n.code==="unrecognized_keys"?{message:C.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new J({...this._def,unknownKeys:"strip"})}passthrough(){return new J({...this._def,unknownKeys:"passthrough"})}extend(e){return new J({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new J({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:M.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new J({...this._def,catchall:e})}pick(e){const n={};for(const r of V.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new J({...this._def,shape:()=>n})}omit(e){const n={};for(const r of V.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new J({...this._def,shape:()=>n})}deepPartial(){return Re(this)}partial(e){const n={};for(const r of V.objectKeys(this.shape)){const i=this.shape[r];e&&!e[r]?n[r]=i:n[r]=i.optional()}return new J({...this._def,shape:()=>n})}required(e){const n={};for(const r of V.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof Ee;)a=a._def.innerType;n[r]=a}return new J({...this._def,shape:()=>n})}keyof(){return Ar(V.objectKeys(this.shape))}}J.create=(t,e)=>new J({shape:()=>t,unknownKeys:"strip",catchall:Te.create(),typeName:M.ZodObject,...L(e)});J.strictCreate=(t,e)=>new J({shape:()=>t,unknownKeys:"strict",catchall:Te.create(),typeName:M.ZodObject,...L(e)});J.lazycreate=(t,e)=>new J({shape:t,unknownKeys:"strip",catchall:Te.create(),typeName:M.ZodObject,...L(e)});class Nt extends Z{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function i(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const s=a.map(o=>new be(o.ctx.common.issues));return w(n,{code:x.invalid_union,unionErrors:s}),R}if(n.common.async)return Promise.all(r.map(async a=>{const s={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:s}),ctx:s}})).then(i);{let a;const s=[];for(const l of r){const c={...n,common:{...n.common,issues:[]},parent:null},d=l._parseSync({data:n.data,path:n.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!a&&(a={result:d,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(l=>new be(l));return w(n,{code:x.invalid_union,unionErrors:o}),R}}get options(){return this._def.options}}Nt.create=(t,e)=>new Nt({options:t,typeName:M.ZodUnion,...L(e)});function Xt(t,e){const n=we(t),r=we(e);if(t===e)return{valid:!0,data:t};if(n===S.object&&r===S.object){const i=V.objectKeys(e),a=V.objectKeys(t).filter(o=>i.indexOf(o)!==-1),s={...t,...e};for(const o of a){const l=Xt(t[o],e[o]);if(!l.valid)return{valid:!1};s[o]=l.data}return{valid:!0,data:s}}else if(n===S.array&&r===S.array){if(t.length!==e.length)return{valid:!1};const i=[];for(let a=0;a<t.length;a++){const s=t[a],o=e[a],l=Xt(s,o);if(!l.valid)return{valid:!1};i.push(l.data)}return{valid:!0,data:i}}else return n===S.date&&r===S.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Tt extends Z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=(a,s)=>{if(Pn(a)||Pn(s))return R;const o=Xt(a.value,s.value);return o.valid?((Dn(a)||Dn(s))&&n.dirty(),{status:n.value,value:o.data}):(w(r,{code:x.invalid_intersection_types}),R)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Tt.create=(t,e,n)=>new Tt({left:t,right:e,typeName:M.ZodIntersection,...L(n)});class Oe extends Z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==S.array)return w(r,{code:x.invalid_type,expected:S.array,received:r.parsedType}),R;if(r.data.length<this._def.items.length)return w(r,{code:x.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),R;!this._def.rest&&r.data.length>this._def.items.length&&(w(r,{code:x.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...r.data].map((s,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Ne(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(a).then(s=>re.mergeArray(n,s)):re.mergeArray(n,a)}get items(){return this._def.items}rest(e){return new Oe({...this._def,rest:e})}}Oe.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Oe({items:t,typeName:M.ZodTuple,rest:null,...L(e)})};class qn extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==S.map)return w(r,{code:x.invalid_type,expected:S.map,received:r.parsedType}),R;const i=this._def.keyType,a=this._def.valueType,s=[...r.data.entries()].map(([o,l],c)=>({key:i._parse(new Ne(r,o,r.path,[c,"key"])),value:a._parse(new Ne(r,l,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of s){const c=await l.key,d=await l.value;if(c.status==="aborted"||d.status==="aborted")return R;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),o.set(c.value,d.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const l of s){const c=l.key,d=l.value;if(c.status==="aborted"||d.status==="aborted")return R;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),o.set(c.value,d.value)}return{status:n.value,value:o}}}}qn.create=(t,e,n)=>new qn({valueType:e,keyType:t,typeName:M.ZodMap,...L(n)});class rt extends Z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==S.set)return w(r,{code:x.invalid_type,expected:S.set,received:r.parsedType}),R;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(w(r,{code:x.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),n.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(w(r,{code:x.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),n.dirty());const a=this._def.valueType;function s(l){const c=new Set;for(const d of l){if(d.status==="aborted")return R;d.status==="dirty"&&n.dirty(),c.add(d.value)}return{status:n.value,value:c}}const o=[...r.data.values()].map((l,c)=>a._parse(new Ne(r,l,r.path,c)));return r.common.async?Promise.all(o).then(l=>s(l)):s(o)}min(e,n){return new rt({...this._def,minSize:{value:e,message:C.toString(n)}})}max(e,n){return new rt({...this._def,maxSize:{value:e,message:C.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}rt.create=(t,e)=>new rt({valueType:t,minSize:null,maxSize:null,typeName:M.ZodSet,...L(e)});class Wn extends Z{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Wn.create=(t,e)=>new Wn({getter:t,typeName:M.ZodLazy,...L(e)});class Yn extends Z{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return w(n,{received:n.data,code:x.invalid_literal,expected:this._def.value}),R}return{status:"valid",value:e.data}}get value(){return this._def.value}}Yn.create=(t,e)=>new Yn({value:t,typeName:M.ZodLiteral,...L(e)});function Ar(t,e){return new Be({values:t,typeName:M.ZodEnum,...L(e)})}class Be extends Z{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return w(n,{expected:V.joinValues(r),received:n.parsedType,code:x.invalid_type}),R}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return w(n,{received:n.data,code:x.invalid_enum_value,options:r}),R}return ie(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return Be.create(e,{...this._def,...n})}exclude(e,n=this._def){return Be.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}}Be.create=Ar;class Gn extends Z{_parse(e){const n=V.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==S.string&&r.parsedType!==S.number){const i=V.objectValues(n);return w(r,{expected:V.joinValues(i),received:r.parsedType,code:x.invalid_type}),R}if(this._cache||(this._cache=new Set(V.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=V.objectValues(n);return w(r,{received:r.data,code:x.invalid_enum_value,options:i}),R}return ie(e.data)}get enum(){return this._def.values}}Gn.create=(t,e)=>new Gn({values:t,typeName:M.ZodNativeEnum,...L(e)});class St extends Z{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==S.promise&&n.common.async===!1)return w(n,{code:x.invalid_type,expected:S.promise,received:n.parsedType}),R;const r=n.parsedType===S.promise?n.data:Promise.resolve(n.data);return ie(r.then(i=>this._def.type.parseAsync(i,{path:n.path,errorMap:n.common.contextualErrorMap})))}}St.create=(t,e)=>new St({type:t,typeName:M.ZodPromise,...L(e)});class Ze extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===M.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{w(r,s),s.fatal?n.abort():n.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){const s=i.transform(r.data,a);if(r.common.async)return Promise.resolve(s).then(async o=>{if(n.value==="aborted")return R;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?R:l.status==="dirty"||n.value==="dirty"?Ge(l.value):l});{if(n.value==="aborted")return R;const o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?R:o.status==="dirty"||n.value==="dirty"?Ge(o.value):o}}if(i.type==="refinement"){const s=o=>{const l=i.refinement(o,a);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?R:(o.status==="dirty"&&n.dirty(),s(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?R:(o.status==="dirty"&&n.dirty(),s(o.value).then(()=>({status:n.value,value:o.value}))))}if(i.type==="transform")if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Pe(s))return R;const o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>Pe(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:n.value,value:o})):R);V.assertNever(i)}}Ze.create=(t,e,n)=>new Ze({schema:t,typeName:M.ZodEffects,effect:e,...L(n)});Ze.createWithPreprocess=(t,e,n)=>new Ze({schema:e,effect:{type:"preprocess",transform:t},typeName:M.ZodEffects,...L(n)});class Ee extends Z{_parse(e){return this._getType(e)===S.undefined?ie(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ee.create=(t,e)=>new Ee({innerType:t,typeName:M.ZodOptional,...L(e)});class Ve extends Z{_parse(e){return this._getType(e)===S.null?ie(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ve.create=(t,e)=>new Ve({innerType:t,typeName:M.ZodNullable,...L(e)});class Qt extends Z{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===S.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}Qt.create=(t,e)=>new Qt({innerType:t,typeName:M.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...L(e)});class en extends Z{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return kt(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new be(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new be(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}en.create=(t,e)=>new en({innerType:t,typeName:M.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...L(e)});class Jn extends Z{_parse(e){if(this._getType(e)!==S.nan){const r=this._getOrReturnCtx(e);return w(r,{code:x.invalid_type,expected:S.nan,received:r.parsedType}),R}return{status:"valid",value:e.data}}}Jn.create=t=>new Jn({typeName:M.ZodNaN,...L(t)});class Fo extends Z{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class hn extends Z{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?R:a.status==="dirty"?(n.dirty(),Ge(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?R:i.status==="dirty"?(n.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,n){return new hn({in:e,out:n,typeName:M.ZodPipeline})}}class tn extends Z{_parse(e){const n=this._def.innerType._parse(e),r=i=>(Pe(i)&&(i.value=Object.freeze(i.value)),i);return kt(n)?n.then(i=>r(i)):r(n)}unwrap(){return this._def.innerType}}tn.create=(t,e)=>new tn({innerType:t,typeName:M.ZodReadonly,...L(e)});var M;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(M||(M={}));const de=ke.create,Uo=De.create,Ho=Kt.create;Te.create;he.create;const qo=J.create;Nt.create;Tt.create;Oe.create;const Wo=Be.create;St.create;Ee.create;Ve.create;const Yo=Wo(["E","K","U"]).default("U"),Go=qo({id:de(),name:de(),first_name:de(),last_name:de().optional(),birth_date:de().optional(),birthplace:de().optional(),death_date:de().optional(),image_path:de().optional(),marriage:de().optional(),note:de().optional(),gender:Yo,gen:Uo().optional(),is_spouse:Ho()}),Kn=0,Jo=1,Ko=2,Xo=3,Qo=4,el=5,tl=6,nl=7,rl=8,il=9,al=10,sl=11;function te(t){return(t||"").toString().trim()}function ol(t){const e=te(t).toUpperCase();if(e==="E")return"E";const n=parseInt(e,10);return isNaN(n)?null:n}function ll(t){if(!t)return"";let e=/drive\.google\.com\/file\/d\/([-_\w]+)/,n=t.match(e);return n&&n[1]||(e=/drive\.google\.com\/open\?id=([-_\w]+)/,n=t.match(e),n&&n[1])?"https://lh3.googleusercontent.com/d/"+n[1]+"=w1000":t}function cl(t){console.log("Processing "+t.length+" data rows with Zod validation.");const e={},n=[],r={};let i=null,a=0;const s={},o={},l={},c=new Set;function d(_,h){const g=[_,h||"unknown"].sort().join("_");if(!r[g]){const y="u_"+g;r[g]=y,e[_]&&n.push([_,y]),h&&e[h]&&n.push([h,y])}return r[g]}function u(_){return _=_.toUpperCase(),_.startsWith("E")||_==="M"?"E":_.startsWith("K")||_==="F"||_==="W"?"K":"U"}function p(_,h,g,y){const I=A=>A.toLowerCase().replace(//g,"g").replace(//g,"u").replace(//g,"s").replace(//g,"i").replace(//g,"o").replace(//g,"c").replace(/[^a-z0-9]/g,"");let N=`${I(_)}_${I(h)}`;g&&(N+=`_${I(g)}`),N==="_"&&(N=`row_${y}`);let v=N,k=1;for(;c.has(v);)v=`${N}_${k}`,k++;return c.add(v),v}return t.forEach((_,h)=>{if(_.length===0||te(_[Kn])==="")return;const g=_[Kn],y=ol(g);if(y===null&&g==="")return;const I=te(_[Jo]),N=te(_[Ko]),v=te(_[el]),k=p(I,N,v,h);let A=I;N&&(A+=" "+N),A||(A="Unknown");const E=ll(te(_[rl]).replace(/\\/g,"/")),j={id:k,name:A,first_name:I,last_name:N||void 0,birth_date:v||void 0,birthplace:te(_[tl])||void 0,death_date:te(_[nl])||void 0,image_path:E||void 0,marriage:te(_[il])||void 0,note:te(_[sl])||void 0,gender:u(te(_[al])),gen:void 0,is_spouse:y==="E",row_index:h+2},U=Go.safeParse(j);U.success||console.warn(`Row ${h+2}: Validation failed`,U.error.format()),e[k]=j;const B=te(_[Xo]),F=te(_[Qo]);if(y==="E"){if(!i){console.warn("Row "+(h+2)+": Spouse 'E' found but no partner exists above.");return}const P=i,W=a;e[k].gen=W,o[W]=k,l[W]||(l[W]={}),l[W][I]=k,d(P,k)}else{const P=y;if(e[k].gen=P,i=k,a=P,s[P]=k,o[P]=null,l[P]={},P>1){const W=s[P-1];let m=null;if(B&&l[P-1]?.[B]?m=l[P-1][B]:F&&l[P-1]?.[F]?m=l[P-1][F]:m=o[P-1],W){const T=d(W,m);n.push([T,k])}}}}),{start:Object.keys(e)[0],members:e,links:n}}async function dl(t){try{const e=await co(t),n=oo(e);if(!n||n.length<=1)throw new Error("No data rows found.");const r=n.slice(1),i=cl(r);return console.log("Graph built:",i),i}catch(e){throw console.error("Error loading sheet:",e),alert("Error loading data. Check console."),e}}class ul{data;constructor(e){this.data={node_ids:[],id_map:new Map,nodes:[],links:[]},this.data.node_ids=[...new Set(e.flat())],this.data.node_ids.sort(),this.data.nodes=new Array(this.data.node_ids.length);for(let[n,r]of this.data.node_ids.entries()){const i={};i.data=r,i.relations={},i.relations.children=[],i.children=function(){return this.relations.children},this.data.nodes[n]=i,this.data.id_map.set(r,n)}this.data.links=new Array(e.length);for(let[n,r]of e.entries()){const i={};let a=this.find_node(r[0]),s=this.find_node(r[1]);i.source=a,i.target=s,this.data.links[n]=i,a.relations.children.push(s)}}find_node(e){if(!this.data.id_map.has(e))throw"Node "+e+" not found";let n=this.data.id_map.get(e);return this.data.nodes[n]}links(){return this.data.links}nodes(){return this.data.nodes}}class fl extends ul{exist_parents=!1;exist_first_level_adjacencies=!1;exist_second_level_adjacencies=!1;constructor(e){if(super(e),e.length<=0)throw"Cannot handle a dataset without links"}parents(e){return this.add_parents(),e.added_relations.parents}first_level_adjacency(e){return this.add_first_level_adjacencies(),e.added_relations.first_level_adjacency}second_level_adjacency(e){return this.add_second_level_adjacencies(),e.added_relations.second_level_adjacency}add_parents(){if(!this.exist_parents){this.exist_parents=!0;for(let e of this.nodes())e.added_relations||(e.added_relations={}),e.added_relations.parents=[];for(let e of this.links())e.target.added_relations.parents.push(e.source)}}add_first_level_adjacencies(){if(!this.exist_first_level_adjacencies){this.exist_first_level_adjacencies=!0;for(let e of this.nodes())e.added_relations||(e.added_relations={}),e.added_relations.first_level_adjacency=new Set;for(let e of this.links())e.source.added_relations.first_level_adjacency.add(e.target),e.target.added_relations.first_level_adjacency.add(e.source)}}add_second_level_adjacencies(){if(this.exist_second_level_adjacencies)return;this.exist_second_level_adjacencies=!0;const e=(n,r)=>{for(let i of this.first_level_adjacency(n))r.added_relations.second_level_adjacency.add(i)};for(let n of this.nodes())n.added_relations||(n.added_relations={}),n.added_relations.second_level_adjacency=new Set;for(let n of this.links())e(n.source,n.source),e(n.target,n.target),e(n.source,n.target),e(n.target,n.source)}}function hl(t){let e=new Set;for(let n of t.nodes())if(t.parents(n).length<=0){e.add(n);continue}return e}class ml extends fl{constructor(e,n={}){super(e);for(let r of this.nodes())r.added_data={is_visible:!1,is_highlighted:!1},r.data in n&&(r.added_data.input=n[r.data])}get_data_and_xy(e){El(e,this)}}function Zt(t,e={}){return new ml(t,e)}function mn(t){if(!t.added_data.input)return"?";const e=t.added_data.input;for(let n of["Name","name"])if(e.hasOwnProperty(n)&&e[n]!="")return e[n];return"?"}function pl(t){if(!t.added_data.input)return"";const e=t.added_data.input;for(let n of["Zweitnamen","second_names"])if(e.hasOwnProperty(n)&&e[n]!="")return e[n];return""}function gl(t){for(let e of["Geburtstag","birth_date"])if(t.hasOwnProperty(e)&&t[e]!="")return t[e];return"?"}function Or(t){return t.added_data.input?gl(t.added_data.input):"?"}function nn(t){if(!t.added_data.input)return"";const e=t.added_data.input;for(let n of["Todestag","death_date"])if(e.hasOwnProperty(n))return e[n];return""}function _l(t){if(!t.added_data.input)return"?";const e=t.added_data.input;for(let n of["Geburtsort","birth_place"])if(e.hasOwnProperty(n)&&e[n]!="")return e[n];return""}function yl(t){if(!t.added_data.input)return"";const e=t.added_data.input;for(let n of["Todesort","death_place"])if(e.hasOwnProperty(n))return e[n];return""}function vl(t){if(!t.added_data.input)return"";const e=t.added_data.input;for(let n of["Hochzeit","marriage"])if(e.hasOwnProperty(n))return e[n];return""}function bl(t){if(!t.added_data.input)return"";const e=t.added_data.input;for(let n of["Beruf","occupation"])if(e.hasOwnProperty(n))return e[n];return""}function xl(t){if(!t.added_data.input)return"";const e=t.added_data.input;for(let n of["Notiz","note"])if(e.hasOwnProperty(n))return e[n];return""}function wl(t,e){if(t=="?")return e;let n=String(t).match(/\d+/gi);if(!n)return e;const r=n.filter(i=>Number(i)>31);return r.length<=0?e:Number(r[0])}function kl(t){const e=Or(t);return wl(e,1980)}function Rr(t){if(!t.added_data.input)return"";const e=t.added_data.input;for(let n of["image_path"])if(e.hasOwnProperty(n))return e[n];return""}function El(t,e){if(!t||!e)return;const n=new Map;for(let r of t.nodes())n.set(r.data,r);for(let r of e.nodes()){let i=n.get(r.data);i&&(r.x=i.ux!==void 0?i.ux:i.x,r.y=i.uy!==void 0?i.uy:i.y,r.added_data=i.added_data)}}function ne(t){return t.added_data.input!=null}class Nl{dag;node_size;constructor(e,n){this.dag=e,this.node_size=n}run(e){let n=10*e.length;for(let r=0;r<n;r++)for(let[i,a]of e.entries()){let s=.1/n,o=0;i<e.length-1&&(o+=this.get_pressure(e[i+1],a,this.node_size[0])),i>0&&(o+=this.get_pressure(e[i-1],a,this.node_size[0]));for(let l of this.dag.parents(a))o+=s*this.get_gravity(l,a);for(let l of a.children())o+=s*this.get_gravity(l,a);a.x+=o}this.enforce_placement(e)}enforce_placement(e){let n=Number.NEGATIVE_INFINITY;for(let r of e)n+=this.node_size[0],r.x<n?r.x=n:n=r.x}get_gravity(e,n){return e.x-n.x}get_pressure(e,n,r){let i=n.x-e.x,a=Math.abs(i),s=r-a;if(s<0)return 0;let o=i<0?-1:1;return s*o}}class Tl{dag;generations;groupings;node_size;constructor(e,n){this.dag=e,this.generations=new Map,this.groupings={partners:[],siblings:[]},this.node_size=n}run(){this.add_object_to_nodes("added_relations.layout"),this.assign_generation(),this.assign_grouping(),this.assign_ages(),this.align_all()}assign_generation(){let e=(n,r,i)=>{let a=n.added_relations.layout,s=this.add_to_object(a,"generation_id",r);if(s){this.add_to_map(this.generations,r,new Array);let o=this.generations.get(r);if(i){let l=n.children()[0];if(l!==void 0){let c=this.dag.parents(l),d=c[+(c[0]==n)];o.splice(o.indexOf(d)+1,0,n)}else o.push(n)}else o.push(n)}return s};for(let n of hl(this.dag)){e(n,0,!1);let r=[n];for(;r.length>0;){let i=[];for(let a of r){let s=a.added_relations.layout.generation_id;for(let o of this.dag.parents(a)){let l=this.dag.parents(o);e(o,s-1,l.length===0)&&i.push(o)}for(let o of a.children())e(o,s+1,!1)&&i.push(o)}r=i}}}assign_grouping(){let e=r=>{let i={};return i.added_data={},i.nodes=[],i.id=this.groupings[r].length,this.groupings[r].push(i),i},n=(r,i)=>{let a=i.added_relations.layout;a[r]=a[r+"_ids"].reduce((s,o)=>{let l=this.groupings[r][o].nodes;return s.concat(l)},[])};for(let r of this.dag.nodes()){let i=r.added_relations.layout;this.add_to_object(i,"partners_ids",[]),this.add_to_object(i,"siblings_ids",[])}for(let r of this.dag.nodes()){if(ne(r))continue;let i=e("partners");for(let s of this.dag.parents(r))s.added_relations.layout.partners_ids.push(i.id),i.nodes.push(s);let a=e("siblings");for(let s of r.children())s.added_relations.layout.siblings_ids.push(a.id),a.nodes.push(s)}for(let r of this.dag.nodes())n("partners",r),n("siblings",r);this.dag.get_partners=function(r){return r.added_relations.layout.partners},this.dag.get_number_of_siblings=function(r){return r.added_relations.layout.siblings.length}}assign_ages(){for(let e of this.dag.nodes())e.added_data.age=kl(e);for(let e of this.dag.nodes()){if(ne(e))continue;let n=this.get_oldest_age(this.dag.parents(e));if(n!==void 0){e.added_data.age=n;continue}let r=this.get_average_age(e.children());r!==void 0&&(e.added_data.age=r)}this.dag.get_age=function(e){return e.added_data.age}}align_all(){let e=Array.from(this.generations).sort((i,a)=>i[0]>a[0]?1:-1),n=0;for(let[i,a]of e){this.align_generation(i,a);let s=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let c of a)s[0]=Math.min(s[0],c.x),s[1]=Math.max(s[1],c.x);let o=(s[0]+s[1])/2,l=n-o;for(let c of a)c.x+=l;n=o+l}let r=new Nl(this.dag,this.node_size);for(let i of[1,2,3,4,5,6,7,8])for(let[a,s]of e)r.run(s)}align_generation(e,n){for(let r of[1,2,3]){n.sort((a,s)=>{if(a.x!=null&&s.x!=null){if(a.x>s.x)return 1;if(a.x<s.x)return-1}let l=[a,s].map(this.dag.get_age);return l[0]!==l[1]?l[0]>l[1]?1:-1:a.data>s.data?1:-1});let i={x:0,y:e*this.node_size[1]};for(let a of n)a.x=i.x,a.y=i.y,i.x+=this.node_size[0];if(r==1)for(let a of n){let s=this.dag.parents(a);this.align_to_parents(a,s)}if(r==2)for(let a of n)ne(a)&&this.align_partners(this.dag.get_partners(a))}}add_to_map(e,n,r){let i=!1;return e.has(n)||(e.set(n,r),i=!0),i}add_to_object(e,n,r){let i=!1;return e.hasOwnProperty(n)||(e[n]=r,i=!0),i}add_object_to_nodes(e){let n=!1,r=e.split(".");for(let i of this.dag.nodes()){let a=i;for(let s of r)a.hasOwnProperty(s)||(a[s]={},n=!0),a=a[s]}return n}align_partners(e){if(e.length<2)return;e.sort((i,a)=>{let s=[i,a],o=s.map(this.dag.get_number_of_siblings);return o[0]!=o[1]?o[0]<o[1]?1:-1:(o=s.map(this.dag.get_age),o[0]>o[1]?1:-1)});let n=e[0],r=e.filter(i=>i!=n);for(let i of r)i.x=n.x+1}align_to_parents(e,n){n.length<1||(e.x=this.get_average_x(n))}get_average_x(e){if(!(e.length<=0))return e.reduce((n,r)=>n+r.x,0)/e.length}get_average_age(e){if(!(e.length<=0))return e.reduce((n,r)=>n+r.added_data.age,0)/e.length}get_oldest_age(e){if(!(e.length<=0))return e.reduce((n,r)=>Math.min(n,r.added_data.age),Number.POSITIVE_INFINITY)}is_member(e){return ne(e)}}function it(){return 28}function Xn(t){if(!ne(t))return"family";let e="member";return t.added_data.is_highlighted?e+=" highlighted":e+=" non-highlighted",nn(t)&&(e+=" deceased"),e}function Sl(t){function e(r){return"clip_to_circle_"+r.data}t.append("defs").append("clipPath").attr("id",r=>e(r)).append("circle").attr("r",it()-1);let n=2*it();t.append("image").attr("x",-n/2).attr("y",-n/2).attr("width",n).attr("height",n).attr("href",r=>Rr(r)).attr("referrerpolicy","no-referrer").attr("clip-path",r=>"url(#"+e(r)+")").attr("cursor","pointer")}function Cl(t,e,n=!0){function r(h){let g=h.match(/[^\s]+/gi);return g||[]}function i(h){for(let g of["Heilige","Freiherr","Graf","der","von","zu","bei","Dr.","med.","Dr","med","St.","St"])if(h==g)return!0;for(let g of[".","/","-","(",")"])if(h.includes(g))return!0;return!1}function a(h){let g=r(mn(h)),y=r(pl(h)),I=y.length<2,N=g[0];for(let v=0;v<y.length;v++)y[v]!=""&&(I||i(y[v])?N+=" "+y[v]:N+=" "+y[v][0]+".");for(let v=1;v<g.length;v++)N+=" "+g[v];return nn(h)&&(N+=" "),N}function s(h){let g=Or(h),y=nn(h);return g+(y!=""?" - "+y:"")}function o(h){return bl(h)}function l(h){return xl(h)}function c(h){let g=_l(h),y=yl(h),I=vl(h),N="";g==y&&(N=g,g="",y="");let v="";return N!=""&&(v+=(v!=""?" ":"")+"* "+N),g!=""&&(v+=(v!=""?" ":"")+"* "+g),y!=""&&(v+=(v!=""?" ":"")+" "+y),I!=""&&(v+=(v!=""?" ":"")+" "+I),v}function d(h,g){if(!ne(h))return[];let y=a(h),I=s(h),N=o(h),v=c(h),k=l(h),A=[y];return I!=""&&A.push(I),N!=""&&g&&A.push(N),v!=""&&g&&A.push(v),k!=""&&g&&A.push(k),A}t.selectAll("text.node-label").remove();let u=d(e,n);if(u.length<1)return;let p=t.append("text").attr("class","node-label").attr("dominant-baseline","central"),f=14,_=-f*(u.length-1)/2;for(let h=0;h<u.length;h++){let g=u[h],y=40;g.length>y&&(g=g.substring(0,y-3)+"...");let I=p.append("tspan").text(g).attr("dy",h==0?_:f).attr("x",it()+8);h>=2&&I.attr("fill-opacity",.5).attr("font-size","75%")}}class Il{g;transition_milliseconds=500;onNodeClick;onNodeDblClick;onEditClick;constructor(e,n,r,i){this.g=e,this.onNodeClick=n,this.onNodeDblClick=r,this.onEditClick=i}draw_nodes(e,n){let r=Array.from(e);r.sort((d,u)=>{let f=[d,u].map(ne);return f[0]>f[1]?1:f[0]<f[1]?-1:d.data>u.data?1:-1});let i=this.g.selectAll("g.node").data(r,d=>d.data),a=i.enter().append("g").attr("class","node").attr("transform",d=>"translate("+n.added_data.y0+","+n.added_data.x0+")").attr("visible","true");a.each(function(d){Cl(ue(this),d,!0)});const s=this;let o=a.append("g").attr("cursor","pointer").on("click",function(d,u){d.defaultPrevented||s.onNodeClick(u,d)}).on("dblclick",function(d,u){d.defaultPrevented||(d.stopPropagation(),s.onNodeDblClick(u))});o.append("circle").attr("class",Xn).attr("r",d=>it()/(ne(d)?1:4)),Sl(o),a.append("g").attr("cursor","pointer").on("click",(d,u)=>s.onEditClick(u)).append("text").attr("cursor","pointer").attr("class","plus-label").attr("font-size","50%").append("tspan").attr("text-anchor","middle").attr("y",d=>-28/(ne(d)?1.1:3)).attr("x",d=>it()/(ne(d)?1.1:3)).text("");let l=a.merge(i);l.transition().duration(this.transition_milliseconds).attr("transform",d=>"translate("+d.y+","+d.x+")"),l.select("circle").attr("class",Xn);let c=i.exit().transition().duration(this.transition_milliseconds/5).attr("visible","false").remove();c.select("text").style("fill-opacity",1e-6),c.select("circle").style("fill-opacity",1e-6).style("stroke-opacity",1e-6)}draw_links(e,n){function r(o,l){return`M ${o.y} ${o.x} C ${(o.y+l.y)/2} ${o.x}, 
				${(o.y+l.y)/2} ${l.x}, 
				${l.y} ${l.x}`}let i=this.g.selectAll("path.link").data(e,o=>o.source.data+"_"+o.target.data);i.enter().insert("path","g").attr("class","link").attr("d",function(){let o={x:n.added_data.x0,y:n.added_data.y0};return r(o,o)}).merge(i).transition().duration(this.transition_milliseconds).attr("d",o=>r(o.source,o.target)),i.exit().transition().duration(this.transition_milliseconds/5).style("stroke-opacity",1e-6).remove()}}class Al{data;svg;g;zoom;info;transition_milliseconds;dag_all;dag;layout;editing_div;renderer;onViewChange;create_editing_form;create_info_form;constructor(e,n,r){this.data=e,this.svg=n,this.onViewChange=r,this.g=this.svg.append("g"),this.zoom=_o().on("zoom",i=>{this.g.attr("transform",i.transform),this.onViewChange&&this.onViewChange()}),this.svg.call(this.zoom),this.zoom.wheelDelta(i=>-i.deltaY*(i.deltaMode===1?.05:5e-4)),this.info=this.add_info_text(n),this.transition_milliseconds=500,this.renderer=new Il(this.g,(i,a)=>this.handleNodeClick(i,a),i=>this.handleNodeDblClick(i),i=>this.handleEditClick(i)),this.reset_dags()}reset_dags(){if(!this.data.links)throw"No links in input";if(!this.data.members)throw"No members in input";if(!this.data.start)throw"No starting node ID in input";this.dag_all=Zt(this.data.links,this.data.members),this.dag=void 0;let e=this.dag_all.find_node(this.data.start),n=parseFloat(this.svg.attr("height")),r=parseFloat(this.svg.attr("width"));isNaN(n)&&(n=window.innerHeight||800),isNaN(r)&&(r=window.innerWidth||1e3),e.added_data.x0=n/2,e.added_data.y0=r/2,e.added_data.is_visible=!0;const i=e.children?e.children():[];if(i)for(let a of i){a.added_data.is_visible=!0;const s=this.dag_all.parents?this.dag_all.parents(a):[];if(s)for(let l of s)l.added_data.is_visible=!0;const o=a.children?a.children():[];if(o)for(let l of o)l.added_data.is_visible=!0}}updateData(e,n){let r=n;if(!r&&(r=new Set,this.dag_all))for(let l of this.dag_all.nodes())l.added_data?.is_visible&&r.add(l.data);if(this.data=e,!this.data.links)throw"No links in input";if(!this.data.members)throw"No members in input";if(!this.data.start)throw"No starting node ID in input";this.dag_all=Zt(this.data.links,this.data.members),this.dag=void 0;let i=this.dag_all.find_node(this.data.start);if(!i){console.error("Start node not found in new data:",this.data.start);return}let a=parseFloat(this.svg.attr("height")),s=parseFloat(this.svg.attr("width"));isNaN(a)&&(a=window.innerHeight||800),isNaN(s)&&(s=window.innerWidth||1e3),i.added_data.x0=a/2,i.added_data.y0=s/2;let o=0;for(let l of this.dag_all.nodes())r.has(l.data)&&(l.added_data.is_visible=!0,o++);if(i.added_data.is_visible=!0,r.size<=1||o<=1){const l=i.children?i.children():[];if(l)for(let c of l){c.added_data.is_visible=!0;const d=this.dag_all.parents?this.dag_all.parents(c):[];if(d)for(let p of d)p.added_data.is_visible=!0;const u=c.children?c.children():[];if(u)for(let p of u)p.added_data.is_visible=!0}}this.draw(!1)}handleNodeClick(e,n){const r=document.getElementById("family-sidebar");if(r&&r.classList.contains("active")){this.handleEditClick(e);return}if(n.shiftKey){this.handleEditClick(e);return}this.click(e.data),this.draw(!1,e.data)}handleEditClick(e){if(typeof this.create_editing_form=="function"){let n=e,r=this.dag_all.find_node(e.data);this.create_editing_form(n,r)}}handleNodeDblClick(e){let n=this.dag_all.find_node(e.data);for(let r of this.dag_all.parents(n)){r.added_data.is_visible=!1;for(let i of this.dag_all.parents(r))i.added_data.is_visible=!1}this.draw(!1,e.data)}click(e){let n=this.dag.find_node(e),r=this.dag_all.find_node(e);if(n.added_data.is_highlighted){let i=this.get_relationship_in_dag_all(r);for(let a of i)a.added_data.is_visible=!0}else{let i=r.children();if(i)for(let a of i){a.added_data.is_visible=!1;let s=a.children();if(s)for(let o of s)o.added_data.is_visible=!1}}}draw(e=!0,n=this.data.start){let r=[];for(let a of this.dag_all.links())a.source.added_data.is_visible&&a.target.added_data.is_visible&&r.push([a.source.data,a.target.data]);if(r.length===0){console.warn("No visible links found. Resetting to default view.");for(let o of this.dag_all.nodes())o.added_data.is_visible=!1;const a=this.dag_all.find_node(n);a.added_data.is_visible=!0;const s=a.children?a.children():[];for(let o of s){o.added_data.is_visible=!0;const l=this.dag_all.parents(o);for(let d of l)d.added_data.is_visible=!0;const c=o.children?o.children():[];for(let d of c)d.added_data.is_visible=!0}r=[];for(let o of this.dag_all.links())o.source.added_data.is_visible&&o.target.added_data.is_visible&&r.push([o.source.data,o.target.data])}this.dag_all.get_data_and_xy(this.dag),this.dag=Zt(r),this.dag.get_data_and_xy(this.dag_all);for(let a of this.dag.nodes()){let s=this.dag_all.find_node(a.data);a.added_data.is_highlighted=this.is_expandable_in_dag_all(s)}this.layout=new Tl(this.dag,[80,140]),this.layout.run();let i;try{i=this.dag.find_node(this.data.start=n)}catch{console.warn(`Node ${n} not found in filtered DAG. Falling back to first available node.`);const s=this.dag.nodes();if(s.length>0)i=s[0],this.data.start=i.data;else{console.warn("Filtered DAG is empty.");return}}try{localStorage.setItem("soyagaci_last_node",i.data)}catch{}if(this.renderer.draw_nodes(this.dag.nodes(),i),this.renderer.draw_links(this.dag.links(),i),e){const a=i.added_data.y0-i.y,s=i.added_data.x0-i.x;!isNaN(a)&&!isNaN(s)&&this.svg.transition().duration(this.transition_milliseconds).call(this.zoom.transform,Je(this.g.node()).translate(a,s))}for(let a of this.dag.nodes())a.added_data.x0=a.x,a.added_data.y0=a.y;this.onViewChange&&this.onViewChange()}get_relationship_in_dag_all(e){return ne(e)?this.dag_all.second_level_adjacency(e):this.dag_all.first_level_adjacency(e)}is_expandable_in_dag_all(e){return Array.from(this.get_relationship_in_dag_all(e)).some(r=>!r.added_data.is_visible)}add_info_text(e){return e.append("text").on("click",n=>{this.create_info_form&&this.create_info_form()}).attr("cursor","pointer").attr("class","info-text").attr("x",parseFloat(e.attr("width"))-16).attr("y","24pt").text("")}}const Ol="modulepreload",Rl=function(t){return"/aile/"+t},Qn={},Ml=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};var s=c;document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");i=c(n.map(d=>{if(d=Rl(d),d in Qn)return;Qn[d]=!0;const u=d.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":Ol,u||(f.as="script"),f.crossOrigin="",f.href=d,l&&f.setAttribute("nonce",l),document.head.appendChild(f),u)return new Promise((_,h)=>{f.addEventListener("load",_),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})},ot="https://script.google.com/macros/s/AKfycbz98JrPFb1xW84pirJKMHlsvDJ5c2msxsVDTYvwKpm498twobAOhVuEfNrvWtzUI3LV/exec",q={gen_col:1,first_name:2,last_name:3,father:4,mother:5,birth_date:6,birthplace:7,death_date:8,image_path:9,marriage:10,note:12,gender:11};function $l(t){return new Promise((e,n)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(r.result.split(",")[1]),r.onerror=i=>n(i)})}async function pn(t,e){const n=document.getElementById("save-status"),r=document.getElementById("sidebar-image");n&&(n.innerText="Ykleniyor...",n.style.color="orange");try{if(!e)throw new Error("Ltfen fotoraf yklemek iin bir kii sein.");const i=e.added_data.input;let a;if(i&&i.row_index)a=i.row_index;else if(e.data.startsWith("mem_"))a=parseInt(e.data.split("_")[1])+2;else throw new Error("Kii verisi veya satr numaras bulunamad.");const s=await $l(t),o={fileName:t.name,mimeType:t.type,fileData:s,row:a,colIndex:q.image_path||9};await fetch(ot,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(o)});const l=URL.createObjectURL(t);r&&(r.src=l,r.style.display="inline-block"),e.added_data.input&&(e.added_data.input.image_path=l),hr("g.node").filter(c=>c.data===e.data).select("image").attr("href",l),n&&(n.innerText="Yklendi! (Kalc olmas 5-10 dk srebilir)",n.style.color="green",setTimeout(()=>{n.innerText=""},5e3))}catch(i){console.error("Fotoraf yklenirken hata olutu:",i),n?(n.innerText=`Hata: ${i.message}`,n.style.color="red"):alert(`Hata: ${i.message}`)}finally{const i=document.getElementById("image-upload-input");i&&(i.value="")}}function zl(t){let e=null;const n=document.getElementById("image-upload-input"),r=document.getElementById("crop-modal"),i=document.getElementById("image-to-crop"),a=document.getElementById("btn-cancel-crop"),s=document.getElementById("btn-confirm-crop");if(!r||!i)return;const o=()=>{r.style.display="none",e&&(e.destroy(),e=null),n&&(n.value="")};n&&n.addEventListener("change",l=>{if(l.target.files.length>0){const c=l.target.files[0],d=new FileReader;d.onload=u=>{i.src=u.target.result,r.style.display="flex",e&&e.destroy(),e=new Cropper(i,{aspectRatio:1,viewMode:1,autoCropArea:.8})},d.readAsDataURL(c)}}),a&&a.addEventListener("click",o),s&&s.addEventListener("click",()=>{e&&e.getCroppedCanvas({width:400,height:400}).toBlob(l=>{if(!l)return;const c=new File([l],"cropped_image.jpg",{type:"image/jpeg"});t(c),o()},"image/jpeg",.9)})}let lt=null;function Mr(t){lt=t}let je=null;function Fe(t){je=t}const Ll=Object.freeze(Object.defineProperty({__proto__:null,get currentEditedNode(){return lt},get pendingChildPhoto(){return je},setCurrentEditedNode:Mr,setPendingChildPhoto:Fe},Symbol.toStringTag,{value:"Module"}));class Pl{state;listeners;debounceTimer;constructor(){this.listeners=new Set,this.state={familyData:null,fullFamilyData:null,visibleNodes:new Set,highlightedNodes:new Set,selectedNodeId:null,transform:null,isPatrilineal:!1,isSidebarOpen:!1,isDarkMode:!1},this.state.isPatrilineal=localStorage.getItem("soyagaci_patrilineal_mode")==="true"}getState(){return this.state}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state)),this.persistState()}persistState(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.state.familyData&&(localStorage.setItem("soyagaci_patrilineal_mode",String(this.state.isPatrilineal)),this.state.selectedNodeId&&localStorage.setItem("soyagaci_last_node",this.state.selectedNodeId))},500)}setData(e){this.state.familyData=e,this.state.fullFamilyData=JSON.parse(JSON.stringify(e)),this.notify()}setPatrilineal(e){this.state.isPatrilineal=e,this.notify()}setSelectedNode(e){this.state.selectedNodeId=e,this.notify()}setSidebarOpen(e){this.state.isSidebarOpen=e,this.notify()}setVisibleNodes(e){this.state.visibleNodes=e,this.notify()}setTransform(e){this.state.transform=e}}const H=new Pl;async function $r(t,e){const n=document.getElementById("save-status");n&&(n.innerText="Kaydediliyor...",n.style.color="orange");try{const a={row:parseInt(t.data.split("_")[1])+2,updates:e};await fetch(ot,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(a)}),t.added_data.input||(t.added_data.input={});for(const[s,o]of Object.entries(e)){const l=Object.keys(q).find(c=>q[c]==parseInt(s));l&&(t.added_data.input[l]=o)}if(e[q.first_name]!==void 0||e[q.last_name]!==void 0){const s=t.added_data.input.first_name||"",o=t.added_data.input.last_name||"";t.added_data.input.name=(s+" "+o).trim();const l=document.getElementById("sidebar-title");l&&(l.innerText=t.added_data.input.name)}e[q.image_path]===""&&hr("g.node").filter(s=>s.data===t.data).select("image").attr("href","https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png"),n&&(n.innerText="Kaydedildi! (Kalc olmas 5-10 dk srebilir)",n.style.color="green",setTimeout(()=>n.innerText="",5e3))}catch(r){console.error(r),n&&(n.innerText="Hata: "+r.message,n.style.color="red")}}async function Dl(t){const e=document.getElementById("add-status");if(!e)return;const n=parseInt(t.data.split("_")[1]),r=document.querySelectorAll("#sidebar-details input.sidebar-input"),i={};let a=!1;if(r.forEach(g=>{const y=g.getAttribute("data-key"),I=g.value;if(I&&y){y==="first_name"&&(a=!0);const N=q[y];N&&(i[N]=I)}}),!a){alert("Ltfen en azndan bir isim (Ad) girin.");return}let s=n;const o=t.added_data.input.is_spouse,l=H.getState().familyData;if(o&&l&&l.members){let g=n;for(;g>=0;){const y=l.members["mem_"+g];if(!y)break;if(!y.is_spouse){s=g;break}g--}}const c=l?.members["mem_"+s];if(!c){alert("Hata: Ebeveyn bulunamad.");return}const d=c.gen;if(d===void 0){alert("Hata: Ebeveyn jenerasyonu bilinmiyor.");return}let u=s,p=s+1;if(l&&l.members)for(;;){const g=l.members["mem_"+p];if(!g)break;if(g.is_spouse){u=p,p++;continue}if(g.gen!==void 0&&d!==void 0&&g.gen>d){u=p,p++;continue}break}const f=u+2,_=d+1;i[q.gen_col]=_;const h=c.gender||"E";o?h==="E"?(i[q.father]=c.first_name,i[q.mother]=t.added_data.input.first_name):(i[q.father]=t.added_data.input.first_name,i[q.mother]=c.first_name):h==="E"?i[q.father]=c.first_name:i[q.mother]=c.first_name,e.innerText="Ekleniyor...",e.style.color="orange";try{if(await fetch(ot,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addChild",row:f,updates:i})}),e.innerText="ocuk eklendi!",e.style.color="green",je){e.innerText="ocuk eklendi! Fotoraf ykleniyor...",e.style.color="orange";try{const k={data:"mem_"+(f+1-2),added_data:{input:{}}};await pn(je,k),e.innerText="Baarl! Fotoraf yklendi. Sayfay yenileyin.",e.style.color="green",alert("ocuk ve fotoraf eklendi. Ltfen sayfay yenileyin.")}catch(N){console.error("Photo upload error:",N),e.innerText="ocuk eklendi ama fotoraf yklenemedi. Sayfay yenileyip tekrar deneyin.",e.style.color="orange",alert("ocuk eklendi ama fotoraf yklenemedi. Ltfen sayfay yenileyip fotoraf tekrar ekleyin.")}Fe(null);const I=document.getElementById("sidebar-image");I&&(I.dataset.addChildMode="false")}else e.innerText="Baarl! Sayfay yenileyin.",e.style.color="green",alert("ocuk eklendi. Ltfen sayfay yenileyin.");const y=document.getElementById("sidebar-image");y&&(y.dataset.addChildMode="false"),setTimeout(()=>{const I=document.getElementById("family-sidebar");I&&I.classList.remove("active")},1e3)}catch(g){console.error(g),e.innerText="Hata: "+g.message,e.style.color="red"}}async function Bl(t){const e=document.getElementById("add-status");if(!e)return;const n=parseInt(t.data.split("_")[1]),r=document.querySelectorAll("#sidebar-details input.sidebar-input, #sidebar-details select.sidebar-input"),i={};let a=!1;if(r.forEach(d=>{const u=d.getAttribute("data-key"),p=d.value;if(p&&u){u==="first_name"&&(a=!0);const f=q[u];f&&(i[f]=p)}}),!a){alert("Ltfen en azndan bir isim (Ad) girin.");return}let s=n,o=n+1;const l=H.getState().familyData;if(l&&l.members)for(;;){const d=l.members["mem_"+o];if(!d)break;if(d.is_spouse){s=o,o++;continue}break}const c=s+2;i[q.gen_col]="E",i[q.father]="",i[q.mother]="",i[q.note]=(i[q.note]?i[q.note]+", ":"")+"is_spouse:true",e.innerText="Ekleniyor...",e.style.color="orange";try{await fetch(ot,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addSpouse",row:c,updates:i})}),e.innerText="E eklendi!",e.style.color="green";const u=document.getElementById("sidebar-image");if(u&&u.dataset.addSpouseMode==="true"&&je){e.innerText="E eklendi! Fotoraf ykleniyor...",e.style.color="orange";try{const _={data:"mem_"+(c-2),added_data:{input:{}}};await pn(je,_),e.innerText="Baarl! Fotoraf yklendi. Sayfay yenileyin.",e.style.color="green",alert("E ve fotoraf eklendi. Ltfen sayfay yenileyin.")}catch(f){console.error("Photo upload error:",f),e.innerText="E eklendi ama fotoraf yklenemedi. Sayfay yenileyip tekrar deneyin.",e.style.color="orange",alert("E eklendi ama fotoraf yklenemedi. Ltfen sayfay yenileyip fotoraf tekrar ekleyin.")}Fe(null),u&&(u.dataset.addSpouseMode="false")}else e.innerText="Baarl! Sayfay yenileyin.",e.style.color="green",alert("E eklendi. Ltfen sayfay yenileyin.");u&&(u.dataset.addSpouseMode="false"),setTimeout(()=>{const f=document.getElementById("family-sidebar");f&&f.classList.remove("active")},1e3)}catch(d){console.error(d),e.innerText="Hata: "+d.message,e.style.color="red"}}async function Zl(t){const e=mn(t)||"Bu kii";if(confirm(`${e} isimli kiiyi silmek istediinizden emin misiniz? Bu ilem geri alnamaz!`))try{const i=parseInt(t.data.split("_")[1])+2,a=document.getElementById("save-status");a&&(a.innerText="Siliniyor...",a.style.color="orange"),await fetch(ot,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"deleteRow",row:i})}),a&&(a.innerText="Silindi! Sayfay yenileyin.",a.style.color="green"),alert("Kii silindi. Ltfen sayfay yenileyin."),setTimeout(()=>{const o=document.getElementById("family-sidebar");o&&o.classList.remove("active")},1e3)}catch(r){console.error(r);const i=document.getElementById("save-status");i&&(i.innerText="Hata: "+r.message,i.style.color="red")}}async function Vl(t,e,n){const r=document.getElementById("move-status");r&&(r.innerText="Tanyor...",r.style.color="orange");const a=H.getState().familyData?.members[e];if(!a){alert("Seilen ebeveyn bulunamad.");return}const s={};a.gender==="K"?(s[q.mother]=a.first_name,s[q.father]=n||""):(s[q.father]=a.first_name,s[q.mother]=n||"");try{await $r(t,s),r&&(r.innerText="Baaryla tand! Sayfay yenileyin.",r.style.color="green"),alert("Kii tand. Ltfen sayfay yenileyin."),setTimeout(()=>{const o=document.getElementById("family-sidebar");o&&o.classList.remove("active")},1e3)}catch(o){console.error(o),r&&(r.innerText="Hata: "+o.message,r.style.color="red")}}function zr(t,e){const n=[{key:"first_name",label:"Ad",type:"text"},{key:"last_name",label:"Soyad",type:"text"},{key:"gender",label:"Cinsiyet",type:"select",options:[{value:"E",label:"Erkek"},{value:"K",label:"Kadn"},{value:"U",label:"Belirsiz"}]},{key:"birth_date",label:"Doum Tarihi",type:"text"},{key:"birthplace",label:"Doum Yeri",type:"text"},{key:"death_date",label:"lm Tarihi",type:"text"},{key:"marriage",label:"Evlilik Tarihi",type:"text"},{key:"note",label:"Not",type:"text"}];let r='<div class="edit-form">';n.forEach(i=>{const a=e[i.key]||"";r+='<div class="info-row">',i.type==="select"?(r+=`<select class="sidebar-input" data-key="${i.key}">
                        <option value="" disabled ${a===""?"selected":""}>${i.label}</option>`,i.options.forEach(s=>{const o=a===s.value?"selected":"";r+=`<option value="${s.value}" ${o}>${s.label}</option>`}),r+="</select>"):r+=`<input type="text" class="sidebar-input" data-key="${i.key}" value="${a}" placeholder="${i.label}">`,r+=`
            </div>
         `}),r+="</div>",t.innerHTML=r}function jl(t){const e=document.getElementById("sidebar-title"),n=document.getElementById("sidebar-details"),r=document.getElementById("sidebar-image");if(!n||!r||!e)return;const i="https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";r.src=i,r.style.display="inline-block",r.style.cursor="pointer",r.title="Fotoraf eklemek iin tklayn",Fe(null);const a=document.getElementById("save-status");a&&(a.innerText="");const s=document.getElementById("delete-photo-btn");s&&(s.style.display="none"),r.dataset.addChildMode="true",r.dataset.deletePhoto="false",r.onclick=()=>{const f=document.getElementById("image-upload-input");f&&f.click()},e.innerText="Yeni ocuk Ekle";const l={last_name:t.added_data.input.last_name||""};zr(n,l);const c=document.createElement("div");c.style.marginTop="15px",c.style.display="flex",c.style.justifyContent="space-between";const d=document.createElement("button");d.className="action-btn btn-secondary",d.innerText="ptal",d.onclick=()=>{if(typeof lt<"u"){const f=document.getElementById("family-sidebar");f&&f.classList.remove("active")}};const u=document.createElement("button");u.className="action-btn btn-success",u.innerText=" ocuu Ekle",u.onclick=()=>Dl(t),c.appendChild(d),c.appendChild(u),n.appendChild(c);const p=document.createElement("div");p.id="add-status",p.style.marginTop="10px",p.style.textAlign="center",p.style.fontSize="0.9em",n.appendChild(p)}function Fl(t){const e=document.getElementById("sidebar-title"),n=document.getElementById("sidebar-details"),r=document.getElementById("sidebar-image");if(!n||!r||!e)return;const i="https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";r.src=i,r.style.display="inline-block",r.style.cursor="pointer",r.title="Fotoraf eklemek iin tklayn",Fe(null);const a=document.getElementById("save-status");a&&(a.innerText="");const s=document.getElementById("delete-photo-btn");s&&(s.style.display="none"),r.dataset.addSpouseMode="true",r.dataset.deletePhoto="false",r.onclick=()=>{const f=document.getElementById("image-upload-input");f&&f.click()},e.innerText="Yeni E Ekle";const l={last_name:t.added_data.input.last_name||""};zr(n,l);const c=document.createElement("div");c.style.marginTop="15px",c.style.display="flex",c.style.justifyContent="space-between";const d=document.createElement("button");d.className="action-btn btn-secondary",d.innerText="ptal",d.onclick=()=>{if(typeof lt<"u"){const f=document.getElementById("family-sidebar");f&&f.classList.remove("active")}};const u=document.createElement("button");u.className="action-btn btn-success",u.innerText=" Ei Ekle",u.onclick=()=>Bl(t),c.appendChild(d),c.appendChild(u),n.appendChild(c);const p=document.createElement("div");p.id="add-status",p.style.marginTop="10px",p.style.textAlign="center",p.style.fontSize="0.9em",n.appendChild(p)}function Ul(t){const e=document.getElementById("sidebar-title"),n=document.getElementById("sidebar-details"),r=document.getElementById("sidebar-image");if(!n||!r||!e)return;e.innerText="Ebeveyn Deitir",n.innerHTML="";const i=H.getState().familyData,a=[];i&&i.members&&Object.values(i.members).forEach(h=>{h.id!==t.data&&!h.is_spouse&&a.push(h)}),a.sort((h,g)=>(h.first_name+" "+h.last_name).localeCompare(g.first_name+" "+g.last_name));const s=document.createElement("div");s.className="edit-form";const o=document.createElement("div");o.className="info-row",o.innerHTML='<label style="display:block; margin-bottom:5px; font-weight:bold;">Yeni Ebeveyn (Baba/Ba):</label>';const l=document.createElement("select");l.className="sidebar-input",l.innerHTML='<option value="" disabled selected>Seiniz...</option>',a.forEach(h=>{const g=document.createElement("option");g.value=h.id,g.innerText=`${h.first_name} ${h.last_name} (${h.birth_date||"?"})`,l.appendChild(g)}),o.appendChild(l),s.appendChild(o);const c=document.createElement("div");c.className="info-row",c.style.marginTop="15px",c.innerHTML='<label style="display:block; margin-bottom:5px; font-weight:bold;">E (Anne):</label>';const d=document.createElement("select");d.className="sidebar-input",d.disabled=!0,d.innerHTML='<option value="" selected>nce Ebeveyn Sein</option>',c.appendChild(d),s.appendChild(c),l.onchange=()=>{d.innerHTML='<option value="">(Yok / Bilinmiyor)</option>',d.disabled=!1,i&&i.members&&Object.values(i.members).forEach(h=>{if(h.is_spouse){const g=document.createElement("option");g.value=h.first_name,g.innerText=`${h.first_name} ${h.last_name}`,d.appendChild(g)}})},n.appendChild(s);const u=document.createElement("div");u.style.marginTop="15px",u.style.display="flex",u.style.justifyContent="space-between";const p=document.createElement("button");p.className="action-btn btn-secondary",p.innerText="ptal",p.onclick=()=>{if(typeof lt<"u"){const h=document.getElementById("family-sidebar");h&&h.classList.remove("active")}};const f=document.createElement("button");f.className="action-btn btn-success",f.innerText=" Ta",f.onclick=()=>{const h=l.value,g=d.value;if(!h){alert("Ltfen bir ebeveyn sein.");return}Vl(t,h,g)},u.appendChild(p),u.appendChild(f),n.appendChild(u);const _=document.createElement("div");_.id="move-status",_.style.marginTop="10px",_.style.textAlign="center",n.appendChild(_)}function Hl(t){zl(e=>{const n=document.getElementById("sidebar-image");if(!n)return;const r=n.dataset.addChildMode==="true",i=n.dataset.addSpouseMode==="true";if(r||i){Fe(e);const a=URL.createObjectURL(e);n.src=a;const s=document.getElementById("add-status");s&&(s.innerText=`Fotoraf hazr (${r?"ocuk":"e"} eklendikten sonra yklenecek)`,s.style.color="blue")}else Ml(async()=>{const{currentEditedNode:a}=await Promise.resolve().then(()=>Ll);return{currentEditedNode:a}},void 0).then(({currentEditedNode:a})=>{a&&pn(e,a)})}),t.create_editing_form=function(e,n){Mr(e);for(let E of this.get_relationship_in_dag_all(n))E.added_data.is_visible=!0;this.draw(!0,n.data);let r=mn(e)||"simsiz";const i=e.added_data.input.is_spouse,a=document.getElementById("family-sidebar"),s=document.getElementById("sidebar-title"),o=document.getElementById("sidebar-details"),l=document.getElementById("sidebar-image"),c=document.getElementById("btn-parents"),d=document.getElementById("btn-children");if(!a||!s||!o||!l)return;s.innerText=r;const u=Rr(e),p="https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";l.src=u&&u!==""?u:p,l.style.display="inline-block",l.style.cursor="pointer",l.title="Fotoraf deitirmek iin tklayn",l.dataset.addChildMode="false",l.dataset.addSpouseMode="false",l.dataset.deletePhoto="false";const f=document.getElementById("delete-photo-btn");f&&(u&&u!==""?(f.style.display="block",f.onclick=E=>{E.stopPropagation(),l.dataset.deletePhoto="true",l.src=p,f.style.display="none";const j=document.getElementById("save-status");j&&(j.innerText="Fotoraf silinecek (kaydet butonuna basn)",j.style.color="orange")}):f.style.display="none"),l.onclick=()=>{const E=document.getElementById("image-upload-input");E&&E.click()};const _={first_name:"Ad",last_name:"Soyad",gender:"Cinsiyet",birth_date:"Doum Tarihi",death_date:"lm Tarihi",birthplace:"Doum Yeri",occupation:"Meslek",note:"Not",marriage:"Evlilik Tarihi"};let h="";const g=[{key:"first_name",type:"text"},{key:"last_name",type:"text"},{key:"gender",type:"select",options:[{value:"E",label:"Erkek"},{value:"K",label:"Kadn"},{value:"U",label:"Belirsiz"}]},{key:"birth_date",type:"text"},{key:"birthplace",type:"text"},{key:"death_date",type:"text"},{key:"marriage",type:"text"},{key:"note",type:"text"}];if(ne(e)){const E=e.added_data.input;h+='<div class="edit-form">',g.forEach(F=>{const P=_[F.key]||F.key,W=E[F.key]||"";h+='<div class="info-row">',F.type==="select"?(h+=`<select class="sidebar-input" data-key="${F.key}">
                                <option value="" disabled ${W===""?"selected":""}>${P}</option>`,F.options.forEach(m=>{const T=W===m.value?"selected":"";h+=`<option value="${m.value}" ${T}>${m.label}</option>`}),h+="</select>"):h+=`<input type="text" class="sidebar-input" data-key="${F.key}" value="${W}" placeholder="${P}">`,h+="</div>"});const j=Array.from(n.children()).length===0;let U="";i?U='<button id="btn-add-child" class="action-btn btn-primary"> ocuk Ekle</button>':U='<button id="btn-add-spouse" class="action-btn btn-secondary"> E Ekle</button>';let B="";j&&(B='<button id="btn-delete-child" class="action-btn btn-danger"> Sil</button>'),h+=`
            <div class="button-row" style="margin-top:15px; display:flex; flex-direction:column; gap:10px;">
                <div style="display:flex; gap:8px; width:100%;">
                    ${U}
                    ${B}
                </div>
                <div style="display:flex; gap:8px; width:100%; align-items:center;">
                    <button id="btn-save-changes" class="action-btn btn-success" style="flex:1;"> Kaydet</button>
                </div>
                <div id="save-status" style="text-align:center; font-size:0.85rem; min-height:1.2em;"></div>
            </div>
        </div>`}else h="<em>Aile Balants (Dzenlenemez)</em>";o.innerHTML=h;const y=document.getElementById("btn-save-changes"),I=document.getElementById("btn-add-child"),N=document.getElementById("btn-add-spouse"),v=document.getElementById("btn-delete-child");y&&(y.onclick=()=>{const E={};if(o.querySelectorAll("input.sidebar-input, select.sidebar-input").forEach(U=>{const B=U.getAttribute("data-key"),F=U.value,P=e.added_data.input[B]||"";if(F!==P){const W=q[B];W&&(E[W]=F)}}),l.dataset.deletePhoto==="true"&&(E[q.image_path]=""),Object.keys(E).length>0){$r(e,E),l.dataset.deletePhoto="false";const U=document.getElementById("delete-photo-btn");U&&(U.style.display="none")}else{const U=document.getElementById("save-status");U&&(U.innerText="Deiiklik yok.")}}),I&&(I.onclick=()=>{jl(e)}),N&&(N.onclick=()=>{Fl(e)}),v&&(v.onclick=()=>{Zl(e)}),c&&(c.onclick=()=>{let E=Array.from(this.dag_all.parents(n));for(;E.length>0;){let j=E.pop();j.added_data.is_visible=!0,E=E.concat(this.dag_all.parents(j))}this.draw(!1)}),d&&(d.onclick=()=>{let E=Array.from(n.children());for(;E.length>0;){let j=E.pop();j.added_data.is_visible=!0,E=E.concat(Array.from(j.children()))}this.draw(!1)});const k=document.createElement("button");if(k.className="action-btn btn-warning",k.innerText=" Ebeveyn Deitir",k.style.marginTop="10px",k.onclick=()=>Ul(e),ne(e)&&!e.added_data.input.is_spouse){const E=o.querySelector(".button-row");E&&E.appendChild(k)}const A=document.getElementById("btn-open-sheet");if(A)if(e.data.startsWith("mem_")){const j=parseInt(e.data.split("_")[1])+2,U=`https://docs.google.com/spreadsheets/d/12kZlANYbq0w3k8TpDxssVSlWVfbs-qZQ9bAjERci0SM/edit#gid=790197592&range=A${j}`;A.onclick=()=>window.open(U,"_blank"),A.innerText=` Bu Satr Dzenle (Satr ${j})`}else A.onclick=()=>window.open("https://docs.google.com/spreadsheets/d/12kZlANYbq0w3k8TpDxssVSlWVfbs-qZQ9bAjERci0SM/edit?gid=790197592","_blank"),A.innerText="Google Tablosunu A";a.classList.add("active")},t.create_info_form=function(){window.open("https://docs.google.com/spreadsheets/d/12kZlANYbq0w3k8TpDxssVSlWVfbs-qZQ9bAjERci0SM/edit?gid=790197592","_blank")}}function ql(){Array.from(document.querySelectorAll("style")).forEach(t=>{t.textContent?.includes("-webkit-filter: hue-rotate(180deg) invert(100%) !important;")&&t.parentNode?.removeChild(t)})}function Wl(t){console.log("Starting patrilineal filter, total members:",Object.keys(t.members).length),console.log("Displayed root:",t.start,t.members[t.start]?.name);const e={start:"",members:{},links:[]},n={},r={};for(const f of t.links){const[_,h]=f;_.startsWith("u_")?r[h]=_:h.startsWith("u_")&&(n[h]||(n[h]=[]),n[h].push(_))}const i=new Set,a=new Set;let s=t.start,o=1/0;for(const f in t.members){const _=t.members[f],h=_.gen;!_.is_spouse&&typeof h=="number"&&h<o&&(o=h,s=f)}console.log("Actual tree root:",s,t.members[s]?.name,"gen:",o);function l(f){const _=r[f];if(!_)return null;const h=n[_]||[];let g=null,y=null;for(const I of h){const N=t.members[I];N&&(N.gender==="E"?g=I:y=I)}return g||y}function c(f){if(a.has(f))return i.has(f);a.add(f);const _=t.members[f];if(!_)return!1;if(f===s)return i.add(f),!0;if(_.is_spouse)return!1;const h=l(f);if(!h)return!1;const g=t.members[h];return _.gender==="E"&&g.gender==="E"&&c(h)?(i.add(f),!0):!1}for(const f in t.members)c(f);console.log("Male lineage members:",i.size);const d=i.has(t.start)?t.start:s;console.log("Using display root:",d,t.members[d]?.name);const u=new Set;for(const f in t.members){const _=t.members[f];if(i.has(f))u.add(f);else if(!_.is_spouse){const h=l(f);h&&i.has(h)&&u.add(f)}}for(const f in t.members)if(t.members[f].is_spouse){const h=r[f];if(h){const g=n[h]||[];for(const y of g)if(u.has(y)){u.add(f);break}}else for(const g of t.links){const[y,I]=g;if(y===f&&I.startsWith("u_")){const N=n[I]||[];for(const v of N)if(v!==f&&u.has(v)){u.add(f);break}}}}for(const f of u)e.members[f]=t.members[f];for(const f of t.links){const[_,h]=f;if(h.startsWith("u_")||_.startsWith("u_")){const g=_.startsWith("u_")||e.members[_],y=h.startsWith("u_")||e.members[h];g&&y&&e.links.push(f)}else e.members[_]&&e.members[h]&&e.links.push(f)}if(console.log("Filtered members count:",Object.keys(e.members).length),console.log("Filtered links count:",e.links.length),e.members[d]||(console.warn("Display root",d,"was missing from filtered members! Adding it forcibly."),e.members[d]=t.members[d]),!e.links.some(f=>f[0]===d||f[1]===d)){console.warn("Display root",d,"is NOT in any filtered link! This will cause 'Node not found' error.");const f=t.links.filter(_=>_[0]===d||_[1]===d);console.log("Original links for root:",f)}return e.start=d,e}const Ke=new Map,Ct=new Map;function Yl(t){if(t.persistentId)return t.persistentId;const e=(t.first_name||"unk").toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,3),n=(t.last_name||"unk").toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,3);let r="00";if(t.birth_date){const i=t.birth_date.match(/\d{4}/);i&&(r=i[0].slice(-2))}return t.persistentId=`${e}_${n}_${r}`,t.persistentId}function Gl(t){Ke.clear(),Ct.clear();const e=new Map,n=Object.keys(t.members).sort();for(const r of n){const i=t.members[r];if(!i.is_spouse||i.first_name){let a=Yl(i);const s=a;let o=e.get(s)||0;o>0&&(a=`${s}_${o}`),e.set(s,o+1),i.persistentId=a,Ke.set(a,r),Ct.set(r,a)}}}function Jl(t,e,n,r){const i={n:t&&Ct.get(t)||null,t:e?{k:e.k,x:Math.round(e.x),y:Math.round(e.y)}:null,p:n?1:0,v:r?Array.from(r).map(a=>Ct.get(a)).filter(Boolean):[]};try{const a=JSON.stringify(i);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(a){return console.error("Error encoding state:",a),null}}function er(){try{const t=window.location.hash.slice(1);if(!t)return null;const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4,r=e+"=".repeat(n),i=atob(r),a=JSON.parse(i);if(!a||typeof a!="object")return console.warn("Invalid URL state: not an object"),null;const s={currentNode:null,transform:null,patrilineal:!1,visibleNodes:new Set};if(a.n&&Ke.has(a.n)&&(s.currentNode=Ke.get(a.n)||null),a.t&&typeof a.t.k=="number"&&typeof a.t.x=="number"&&typeof a.t.y=="number"&&(s.transform=a.t),s.patrilineal=a.p===1,Array.isArray(a.v))for(const o of a.v){const l=Ke.get(o);l&&s.visibleNodes.add(l)}return console.log("Decoded URL state:",{currentNode:s.currentNode,transform:s.transform,patrilineal:s.patrilineal,visibleCount:s.visibleNodes.size}),s}catch(t){return console.warn("Error decoding state from URL, falling back to localStorage:",t),window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search),null}}function rn(t){if(!t)return;const e=t.transform,n=t.visibleNodes,r=t.selectedNodeId||(t.familyData?t.familyData.start:null),i=t.isPatrilineal,a=Jl(r,e,i,n);a&&history.replaceState(null,"","#"+a)}async function Kl(t){const e=document.getElementById("share-btn");if(!e)return;const n=e.innerHTML;try{rn(t);const r=window.location.href;e.innerHTML='<span style="font-size: 1.2em;"></span><span>Ksaltlyor...</span>',e.disabled=!0;const i=`https://tinyurl.com/api-create.php?url=${encodeURIComponent(r)}`,a=await fetch(i);if(!a.ok)throw new Error("TinyURL failed");const s=await a.text();await navigator.clipboard.writeText(s),e.innerHTML='<span style="font-size: 1.2em;"></span><span>Kopyaland!</span>',setTimeout(()=>{e.innerHTML=n,e.disabled=!1},2e3)}catch(r){console.warn("TinyURL failed, copying full URL:",r);try{await navigator.clipboard.writeText(window.location.href),e.innerHTML='<span style="font-size: 1.2em;"></span><span>Kopyaland!</span>',setTimeout(()=>{e.innerHTML=n,e.disabled=!1},2e3)}catch{e.innerHTML='<span style="font-size: 1.2em;"></span><span>Hata!</span>',setTimeout(()=>{e.innerHTML=n,e.disabled=!1},2e3)}}}const Xl="https://docs.google.com/spreadsheets/d/e/2PACX-1vTzo66Bb8-z3QdqtNGZ9uhQJZJxePifl6nJwvtlot-3JtKp4YKYQdqJNFDY89lqHoMRdlKZmjWzh2OA/pub?output=csv";ql();async function Ql(){let t=null;try{t=await dl(Xl),localStorage.setItem("soyagaci_cached_data",JSON.stringify(t))}catch(v){console.warn("Network failed, trying cache...",v);const k=localStorage.getItem("soyagaci_cached_data");k&&(t=JSON.parse(k))}if(!t){alert("Could not load data.");return}H.setData(t),Gl(t);let e=er(),n=H.getState().isPatrilineal,r=null,i=null,a=null;if(e)console.log("Loading state from URL"),n=e.patrilineal,H.setPatrilineal(n),r=e.currentNode,i=e.visibleNodes,a=e.transform;else{console.log("Loading state from localStorage"),r=localStorage.getItem("soyagaci_last_node");const v=localStorage.getItem("soyagaci_visible_nodes");if(v)try{i=new Set(JSON.parse(v))}catch(A){console.warn("Failed to restore visible nodes",A)}const k=localStorage.getItem("soyagaci_view_transform");if(k)try{a=JSON.parse(k)}catch(A){console.warn("Failed to restore transform",A)}}i&&H.setVisibleNodes(i),a&&H.setTransform(a),r&&t.members[r]&&(t.start=r);const s=document.getElementById("patrilineal-global-toggle"),o=document.getElementById("toggle-icon"),l=document.getElementById("toggle-text"),c=ue("#tree-container").append("svg").attr("id","tree-svg"),d=()=>{const v=window.innerWidth,k=window.innerHeight;c.attr("width",v).attr("height",k)};window.addEventListener("resize",d),d();let u,p=null;function f(){const v=H.getState().fullFamilyData;let k=v;H.getState().isPatrilineal?(k=Wl(v),s&&o&&l&&(s.style.background="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",o.textContent="",l.textContent="Tm Soy Aac")):s&&o&&l&&(s.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",o.textContent="",l.textContent="Sadece Erkek Soyu"),_(k)}function _(v){if(u){if(i&&i.size>0?(u.updateData(v,i),i=null):u.updateData(v),a){try{const B=$e.translate(a.x,a.y).scale(a.k);u.svg.call(u.zoom.transform,B)}catch(B){console.warn("Failed to restore transform",B)}a=null}return}const k=ue("#tree-svg");k.selectAll("*").remove(),u=new Al(v,k);const A=()=>{if(u&&u.dag_all){const F=new Set;for(let P of u.dag_all.nodes())P.added_data.is_visible&&F.add(P.data);H.setVisibleNodes(F)}if(u&&u.g){const F=Je(u.g.node());H.setTransform({k:F.k,x:F.x,y:F.y})}const B=H.getState();rn(B)};Hl(u);const E=H.getState();if(i&&i.size>3&&u.dag_all){let B=0;const F=new Set;for(let P of u.dag_all.nodes())F.add(P.data),i.has(P.data)&&B++;if(B>0){console.log(`Restoring visibility: ${B}/${i.size} nodes exist in current DAG`);for(let W of u.dag_all.nodes())i.has(W.data)?W.added_data.is_visible=!0:W.added_data.is_visible=!1;const P=u.dag_all.find_node(v.start);P&&(P.added_data.is_visible=!0);for(let W of u.dag_all.nodes()){if(!W.added_data.is_visible)continue;const m=W.children?W.children():[];for(let b of m)(b.children?b.children():[]).some(z=>z.added_data.is_visible)&&(b.added_data.is_visible=!0);const T=u.dag_all.parents?u.dag_all.parents(W):[];for(let b of T)(u.dag_all.parents?u.dag_all.parents(b):[]).some(z=>z.added_data.is_visible)&&(b.added_data.is_visible=!0)}}else{console.warn(`Skipping visibility restoration: only ${B}/${i.size} nodes exist. Using default view.`);try{localStorage.removeItem("soyagaci_visible_nodes"),localStorage.removeItem("soyagaci_view_transform")}catch{}}}let U=!E.transform;if(E.transform){let B=0,F=0;if(u.dag_all)for(let P of u.dag_all.nodes())P.added_data.is_visible&&(B++,E.visibleNodes.has(P.data)&&F++);if(B<=1&&(console.warn("Saved transform exists but only 1 node is visible. Discarding transform."),U=!0),E.visibleNodes.size>5&&B<E.visibleNodes.size*.5&&(console.warn(`Visibility restoration mismatch (Count). Expected ${E.visibleNodes.size}, got ${B}. Discarding transform.`),U=!0),E.visibleNodes.size>0){const P=F/E.visibleNodes.size;P<.5&&(console.warn(`Visibility restoration mismatch (Intersection). Match rate ${P.toFixed(2)}. Discarding transform.`),U=!0)}else console.warn("Saved transform exists but no visible nodes were restored from URL. Discarding transform."),U=!0}if(u.draw(U),E.transform&&!U){const B=E.transform,F=$e.translate(B.x,B.y).scale(B.k);u.svg.call(u.zoom.transform,F)}u.onViewChange=A}setTimeout(()=>{f()},50);const h=document.querySelector(".controls")||document.body,g=document.createElement("button");g.textContent="",g.title="Grnm Sfrla",g.className="control-btn",g.style.marginLeft="10px",g.onclick=()=>{if(u){H.setTransform({k:1,x:0,y:0}),H.setVisibleNodes(new Set);const v=H.getState().selectedNodeId||u.data.start;u.draw(!0,v),rn(H.getState())}},l&&l.parentNode?l.parentNode.appendChild(g):h.appendChild(g),s&&s.addEventListener("click",()=>{const v=!H.getState().isPatrilineal;if(u&&u.g){const k=Je(u.g.node());a={k:k.k,x:k.x,y:k.y};const A=new Set(H.getState().visibleNodes);if(v)p=new Set(A),i=A;else if(p){for(let E of A)p.add(E);i=p}else i=A}H.setPatrilineal(v),f()});const y=document.getElementById("share-btn");y&&y.addEventListener("click",()=>Kl(H.getState()));const I=document.getElementById("btn-open-sheet");I&&I.addEventListener("click",()=>{window.open("https://docs.google.com/spreadsheets/d/12kZlANYbq0w3k8TpDxssVSlWVfbs-qZQ9bAjERci0SM/edit?gid=790197592","_blank")});const N=document.querySelector(".close-btn");N&&N.addEventListener("click",()=>{const v=document.getElementById("family-sidebar");v&&v.classList.remove("active")}),window.addEventListener("popstate",()=>{const v=er();if(v&&(v.patrilineal!==H.getState().isPatrilineal&&H.setPatrilineal(v.patrilineal),u&&u.dag_all)){if(v.visibleNodes){const A=v.visibleNodes;H.setVisibleNodes(A);for(let E of u.dag_all.nodes())E.added_data.is_visible=A.has(E.data);if(v.currentNode){const E=u.dag_all.find_node(v.currentNode);E&&(E.added_data.is_visible=!0)}}if(v.transform&&(H.setTransform(v.transform),u.svg&&u.zoom)){const A=v.transform,E=$e.translate(A.x,A.y).scale(A.k);u.svg.call(u.zoom.transform,E)}const k=!v.transform;v.currentNode&&u.data.members[v.currentNode]?u.draw(k,v.currentNode):u.draw(!1)}}),window.addEventListener("beforeunload",()=>{if(u&&u.g){const v=Je(u.g.node());if(localStorage.setItem("soyagaci_view_transform",JSON.stringify({k:v.k,x:v.x,y:v.y})),u.dag_all){const k=[];for(let A of u.dag_all.nodes())A.added_data?.is_visible&&k.push(A.data);localStorage.setItem("soyagaci_visible_nodes",JSON.stringify(k))}}}),document.addEventListener("keydown",v=>{v.key==="Shift"&&document.body.classList.add("show-plus")}),document.addEventListener("keyup",v=>{v.key==="Shift"&&document.body.classList.remove("show-plus")})}Ql();
