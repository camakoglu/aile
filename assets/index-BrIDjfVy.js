(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var ji={value:()=>{}};function un(){for(var t=0,e=arguments.length,n={},i;t<e;++t){if(!(i=arguments[t]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new xt(n)}function xt(t){this._=t}function Ui(t,e){return t.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}xt.prototype=un.prototype={constructor:xt,on:function(t,e){var n=this._,i=Ui(t+"",n),r,a=-1,s=i.length;if(arguments.length<2){for(;++a<s;)if((r=(t=i[a]).type)&&(r=Hi(n[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(r=(t=i[a]).type)n[r]=wn(n[r],t.name,e);else if(e==null)for(r in n)n[r]=wn(n[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new xt(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,a;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],i=0,r=a.length;i<r;++i)a[i].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)}};function Hi(t,e){for(var n=0,i=t.length,r;n<i;++n)if((r=t[n]).name===e)return r.value}function wn(t,e,n){for(var i=0,r=t.length;i<r;++i)if(t[i].name===e){t[i]=ji,t=t.slice(0,i).concat(t.slice(i+1));break}return n!=null&&t.push({name:e,value:n}),t}var Wt="http://www.w3.org/1999/xhtml";const kn={svg:"http://www.w3.org/2000/svg",xhtml:Wt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Pt(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),kn.hasOwnProperty(e)?{space:kn[e],local:t}:t}function qi(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Wt&&e.documentElement.namespaceURI===Wt?e.createElement(t):e.createElementNS(n,t)}}function Yi(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function di(t){var e=Pt(t);return(e.local?Yi:qi)(e)}function Gi(){}function fn(t){return t==null?Gi:function(){return this.querySelector(t)}}function Wi(t){typeof t!="function"&&(t=fn(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=new Array(s),l,d,c=0;c<s;++c)(l=a[c])&&(d=t.call(l,l.__data__,c,a))&&("__data__"in l&&(d.__data__=l.__data__),o[c]=d);return new Q(i,this._parents)}function ci(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Xi(){return[]}function ui(t){return t==null?Xi:function(){return this.querySelectorAll(t)}}function Ki(t){return function(){return ci(t.apply(this,arguments))}}function Ji(t){typeof t=="function"?t=Ki(t):t=ui(t);for(var e=this._groups,n=e.length,i=[],r=[],a=0;a<n;++a)for(var s=e[a],o=s.length,l,d=0;d<o;++d)(l=s[d])&&(i.push(t.call(l,l.__data__,d,s)),r.push(l));return new Q(i,r)}function fi(t){return function(){return this.matches(t)}}function hi(t){return function(e){return e.matches(t)}}var Qi=Array.prototype.find;function er(t){return function(){return Qi.call(this.children,t)}}function tr(){return this.firstElementChild}function nr(t){return this.select(t==null?tr:er(typeof t=="function"?t:hi(t)))}var ir=Array.prototype.filter;function rr(){return Array.from(this.children)}function ar(t){return function(){return ir.call(this.children,t)}}function sr(t){return this.selectAll(t==null?rr:ar(typeof t=="function"?t:hi(t)))}function or(t){typeof t!="function"&&(t=fi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=[],l,d=0;d<s;++d)(l=a[d])&&t.call(l,l.__data__,d,a)&&o.push(l);return new Q(i,this._parents)}function pi(t){return new Array(t.length)}function lr(){return new Q(this._enter||this._groups.map(pi),this._parents)}function Tt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Tt.prototype={constructor:Tt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function dr(t){return function(){return t}}function cr(t,e,n,i,r,a){for(var s=0,o,l=e.length,d=a.length;s<d;++s)(o=e[s])?(o.__data__=a[s],i[s]=o):n[s]=new Tt(t,a[s]);for(;s<l;++s)(o=e[s])&&(r[s]=o)}function ur(t,e,n,i,r,a,s){var o,l,d=new Map,c=e.length,f=a.length,h=new Array(c),u;for(o=0;o<c;++o)(l=e[o])&&(h[o]=u=s.call(l,l.__data__,o,e)+"",d.has(u)?r[o]=l:d.set(u,l));for(o=0;o<f;++o)u=s.call(t,a[o],o,a)+"",(l=d.get(u))?(i[o]=l,l.__data__=a[o],d.delete(u)):n[o]=new Tt(t,a[o]);for(o=0;o<c;++o)(l=e[o])&&d.get(h[o])===l&&(r[o]=l)}function fr(t){return t.__data__}function hr(t,e){if(!arguments.length)return Array.from(this,fr);var n=e?ur:cr,i=this._parents,r=this._groups;typeof t!="function"&&(t=dr(t));for(var a=r.length,s=new Array(a),o=new Array(a),l=new Array(a),d=0;d<a;++d){var c=i[d],f=r[d],h=f.length,u=pr(t.call(c,c&&c.__data__,d,i)),g=u.length,p=o[d]=new Array(g),v=s[d]=new Array(g),y=l[d]=new Array(h);n(c,f,p,v,y,u,e);for(var R=0,C=0,_,N;R<g;++R)if(_=p[R]){for(R>=C&&(C=R+1);!(N=v[C])&&++C<g;);_._next=N||null}}return s=new Q(s,i),s._enter=o,s._exit=l,s}function pr(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function mr(){return new Q(this._exit||this._groups.map(pi),this._parents)}function gr(t,e,n){var i=this.enter(),r=this,a=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(r=e(r),r&&(r=r.selection())),n==null?a.remove():n(a),i&&r?i.merge(r).order():r}function _r(t){for(var e=t.selection?t.selection():t,n=this._groups,i=e._groups,r=n.length,a=i.length,s=Math.min(r,a),o=new Array(r),l=0;l<s;++l)for(var d=n[l],c=i[l],f=d.length,h=o[l]=new Array(f),u,g=0;g<f;++g)(u=d[g]||c[g])&&(h[g]=u);for(;l<r;++l)o[l]=n[l];return new Q(o,this._parents)}function yr(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var i=t[e],r=i.length-1,a=i[r],s;--r>=0;)(s=i[r])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function vr(t){t||(t=br);function e(f,h){return f&&h?t(f.__data__,h.__data__):!f-!h}for(var n=this._groups,i=n.length,r=new Array(i),a=0;a<i;++a){for(var s=n[a],o=s.length,l=r[a]=new Array(o),d,c=0;c<o;++c)(d=s[c])&&(l[c]=d);l.sort(e)}return new Q(r,this._parents).order()}function br(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function xr(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function wr(){return Array.from(this)}function kr(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length;r<a;++r){var s=i[r];if(s)return s}return null}function Er(){let t=0;for(const e of this)++t;return t}function Tr(){return!this.node()}function Nr(t){for(var e=this._groups,n=0,i=e.length;n<i;++n)for(var r=e[n],a=0,s=r.length,o;a<s;++a)(o=r[a])&&t.call(o,o.__data__,a,r);return this}function Sr(t){return function(){this.removeAttribute(t)}}function Cr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ir(t,e){return function(){this.setAttribute(t,e)}}function Ar(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Rr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Mr(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function $r(t,e){var n=Pt(t);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((e==null?n.local?Cr:Sr:typeof e=="function"?n.local?Mr:Rr:n.local?Ar:Ir)(n,e))}function mi(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Or(t){return function(){this.style.removeProperty(t)}}function Dr(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Lr(t,e,n){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,n)}}function Pr(t,e,n){return arguments.length>1?this.each((e==null?Or:typeof e=="function"?Lr:Dr)(t,e,n??"")):Ve(this.node(),t)}function Ve(t,e){return t.style.getPropertyValue(e)||mi(t).getComputedStyle(t,null).getPropertyValue(e)}function zr(t){return function(){delete this[t]}}function Br(t,e){return function(){this[t]=e}}function Zr(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Vr(t,e){return arguments.length>1?this.each((e==null?zr:typeof e=="function"?Zr:Br)(t,e)):this.node()[t]}function gi(t){return t.trim().split(/^|\s+/)}function hn(t){return t.classList||new _i(t)}function _i(t){this._node=t,this._names=gi(t.getAttribute("class")||"")}_i.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function yi(t,e){for(var n=hn(t),i=-1,r=e.length;++i<r;)n.add(e[i])}function vi(t,e){for(var n=hn(t),i=-1,r=e.length;++i<r;)n.remove(e[i])}function Fr(t){return function(){yi(this,t)}}function jr(t){return function(){vi(this,t)}}function Ur(t,e){return function(){(e.apply(this,arguments)?yi:vi)(this,t)}}function Hr(t,e){var n=gi(t+"");if(arguments.length<2){for(var i=hn(this.node()),r=-1,a=n.length;++r<a;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof e=="function"?Ur:e?Fr:jr)(n,e))}function qr(){this.textContent=""}function Yr(t){return function(){this.textContent=t}}function Gr(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Wr(t){return arguments.length?this.each(t==null?qr:(typeof t=="function"?Gr:Yr)(t)):this.node().textContent}function Xr(){this.innerHTML=""}function Kr(t){return function(){this.innerHTML=t}}function Jr(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Qr(t){return arguments.length?this.each(t==null?Xr:(typeof t=="function"?Jr:Kr)(t)):this.node().innerHTML}function ea(){this.nextSibling&&this.parentNode.appendChild(this)}function ta(){return this.each(ea)}function na(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ia(){return this.each(na)}function ra(t){var e=typeof t=="function"?t:di(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function aa(){return null}function sa(t,e){var n=typeof t=="function"?t:di(t),i=e==null?aa:typeof e=="function"?e:fn(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function oa(){var t=this.parentNode;t&&t.removeChild(this)}function la(){return this.each(oa)}function da(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ca(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ua(t){return this.select(t?ca:da)}function fa(t){return arguments.length?this.property("__data__",t):this.node().__data__}function ha(t){return function(e){t.call(this,e,this.__data__)}}function pa(t){return t.trim().split(/^|\s+/).map(function(e){var n="",i=e.indexOf(".");return i>=0&&(n=e.slice(i+1),e=e.slice(0,i)),{type:e,name:n}})}function ma(t){return function(){var e=this.__on;if(e){for(var n=0,i=-1,r=e.length,a;n<r;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++i]=a;++i?e.length=i:delete this.__on}}}function ga(t,e,n){return function(){var i=this.__on,r,a=ha(e);if(i){for(var s=0,o=i.length;s<o;++s)if((r=i[s]).type===t.type&&r.name===t.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=a,r.options=n),r.value=e;return}}this.addEventListener(t.type,a,n),r={type:t.type,name:t.name,value:e,listener:a,options:n},i?i.push(r):this.__on=[r]}}function _a(t,e,n){var i=pa(t+""),r,a=i.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,d=o.length,c;l<d;++l)for(r=0,c=o[l];r<a;++r)if((s=i[r]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?ga:ma,r=0;r<a;++r)this.each(o(i[r],e,n));return this}function bi(t,e,n){var i=mi(t),r=i.CustomEvent;typeof r=="function"?r=new r(e,n):(r=i.document.createEvent("Event"),n?(r.initEvent(e,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function ya(t,e){return function(){return bi(this,t,e)}}function va(t,e){return function(){return bi(this,t,e.apply(this,arguments))}}function ba(t,e){return this.each((typeof e=="function"?va:ya)(t,e))}function*xa(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var i=t[e],r=0,a=i.length,s;r<a;++r)(s=i[r])&&(yield s)}var pn=[null];function Q(t,e){this._groups=t,this._parents=e}function pt(){return new Q([[document.documentElement]],pn)}function wa(){return this}Q.prototype=pt.prototype={constructor:Q,select:Wi,selectAll:Ji,selectChild:nr,selectChildren:sr,filter:or,data:hr,enter:lr,exit:mr,join:gr,merge:_r,selection:wa,order:yr,sort:vr,call:xr,nodes:wr,node:kr,size:Er,empty:Tr,each:Nr,attr:$r,style:Pr,property:Vr,classed:Hr,text:Wr,html:Qr,raise:ta,lower:ia,append:ra,insert:sa,remove:la,clone:ua,datum:fa,on:_a,dispatch:ba,[Symbol.iterator]:xa};function fe(t){return typeof t=="string"?new Q([[document.querySelector(t)]],[document.documentElement]):new Q([[t]],pn)}function ka(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Re(t,e){if(t=ka(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}if(e.getBoundingClientRect){var r=e.getBoundingClientRect();return[t.clientX-r.left-e.clientLeft,t.clientY-r.top-e.clientTop]}}return[t.pageX,t.pageY]}function xi(t){return typeof t=="string"?new Q([document.querySelectorAll(t)],[document.documentElement]):new Q([ci(t)],pn)}const Xt={capture:!0,passive:!1};function Kt(t){t.preventDefault(),t.stopImmediatePropagation()}function Ea(t){var e=t.document.documentElement,n=fe(t).on("dragstart.drag",Kt,Xt);"onselectstart"in e?n.on("selectstart.drag",Kt,Xt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Ta(t,e){var n=t.document.documentElement,i=fe(t).on("dragstart.drag",null);e&&(i.on("click.drag",Kt,Xt),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function mn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function wi(t,e){var n=Object.create(t.prototype);for(var i in e)n[i]=e[i];return n}function mt(){}var rt=.7,Nt=1/rt,Ze="\\s*([+-]?\\d+)\\s*",at="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",he="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Na=/^#([0-9a-f]{3,8})$/,Sa=new RegExp(`^rgb\\(${Ze},${Ze},${Ze}\\)$`),Ca=new RegExp(`^rgb\\(${he},${he},${he}\\)$`),Ia=new RegExp(`^rgba\\(${Ze},${Ze},${Ze},${at}\\)$`),Aa=new RegExp(`^rgba\\(${he},${he},${he},${at}\\)$`),Ra=new RegExp(`^hsl\\(${at},${he},${he}\\)$`),Ma=new RegExp(`^hsla\\(${at},${he},${he},${at}\\)$`),En={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};mn(mt,st,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Tn,formatHex:Tn,formatHex8:$a,formatHsl:Oa,formatRgb:Nn,toString:Nn});function Tn(){return this.rgb().formatHex()}function $a(){return this.rgb().formatHex8()}function Oa(){return ki(this).formatHsl()}function Nn(){return this.rgb().formatRgb()}function st(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Na.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Sn(e):n===3?new ne(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?_t(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?_t(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Sa.exec(t))?new ne(e[1],e[2],e[3],1):(e=Ca.exec(t))?new ne(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ia.exec(t))?_t(e[1],e[2],e[3],e[4]):(e=Aa.exec(t))?_t(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ra.exec(t))?An(e[1],e[2]/100,e[3]/100,1):(e=Ma.exec(t))?An(e[1],e[2]/100,e[3]/100,e[4]):En.hasOwnProperty(t)?Sn(En[t]):t==="transparent"?new ne(NaN,NaN,NaN,0):null}function Sn(t){return new ne(t>>16&255,t>>8&255,t&255,1)}function _t(t,e,n,i){return i<=0&&(t=e=n=NaN),new ne(t,e,n,i)}function Da(t){return t instanceof mt||(t=st(t)),t?(t=t.rgb(),new ne(t.r,t.g,t.b,t.opacity)):new ne}function Jt(t,e,n,i){return arguments.length===1?Da(t):new ne(t,e,n,i??1)}function ne(t,e,n,i){this.r=+t,this.g=+e,this.b=+n,this.opacity=+i}mn(ne,Jt,wi(mt,{brighter(t){return t=t==null?Nt:Math.pow(Nt,t),new ne(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?rt:Math.pow(rt,t),new ne(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ne(Oe(this.r),Oe(this.g),Oe(this.b),St(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Cn,formatHex:Cn,formatHex8:La,formatRgb:In,toString:In}));function Cn(){return`#${Me(this.r)}${Me(this.g)}${Me(this.b)}`}function La(){return`#${Me(this.r)}${Me(this.g)}${Me(this.b)}${Me((isNaN(this.opacity)?1:this.opacity)*255)}`}function In(){const t=St(this.opacity);return`${t===1?"rgb(":"rgba("}${Oe(this.r)}, ${Oe(this.g)}, ${Oe(this.b)}${t===1?")":`, ${t})`}`}function St(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Oe(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Me(t){return t=Oe(t),(t<16?"0":"")+t.toString(16)}function An(t,e,n,i){return i<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new de(t,e,n,i)}function ki(t){if(t instanceof de)return new de(t.h,t.s,t.l,t.opacity);if(t instanceof mt||(t=st(t)),!t)return new de;if(t instanceof de)return t;t=t.rgb();var e=t.r/255,n=t.g/255,i=t.b/255,r=Math.min(e,n,i),a=Math.max(e,n,i),s=NaN,o=a-r,l=(a+r)/2;return o?(e===a?s=(n-i)/o+(n<i)*6:n===a?s=(i-e)/o+2:s=(e-n)/o+4,o/=l<.5?a+r:2-a-r,s*=60):o=l>0&&l<1?0:s,new de(s,o,l,t.opacity)}function Pa(t,e,n,i){return arguments.length===1?ki(t):new de(t,e,n,i??1)}function de(t,e,n,i){this.h=+t,this.s=+e,this.l=+n,this.opacity=+i}mn(de,Pa,wi(mt,{brighter(t){return t=t==null?Nt:Math.pow(Nt,t),new de(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?rt:Math.pow(rt,t),new de(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*e,r=2*n-i;return new ne(Vt(t>=240?t-240:t+120,r,i),Vt(t,r,i),Vt(t<120?t+240:t-120,r,i),this.opacity)},clamp(){return new de(Rn(this.h),yt(this.s),yt(this.l),St(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=St(this.opacity);return`${t===1?"hsl(":"hsla("}${Rn(this.h)}, ${yt(this.s)*100}%, ${yt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Rn(t){return t=(t||0)%360,t<0?t+360:t}function yt(t){return Math.max(0,Math.min(1,t||0))}function Vt(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Ei=t=>()=>t;function za(t,e){return function(n){return t+n*e}}function Ba(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(i){return Math.pow(t+i*e,n)}}function Za(t){return(t=+t)==1?Ti:function(e,n){return n-e?Ba(e,n,t):Ei(isNaN(e)?n:e)}}function Ti(t,e){var n=e-t;return n?za(t,n):Ei(isNaN(t)?e:t)}const Mn=(function t(e){var n=Za(e);function i(r,a){var s=n((r=Jt(r)).r,(a=Jt(a)).r),o=n(r.g,a.g),l=n(r.b,a.b),d=Ti(r.opacity,a.opacity);return function(c){return r.r=s(c),r.g=o(c),r.b=l(c),r.opacity=d(c),r+""}}return i.gamma=t,i})(1);function Ee(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Qt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ft=new RegExp(Qt.source,"g");function Va(t){return function(){return t}}function Fa(t){return function(e){return t(e)+""}}function ja(t,e){var n=Qt.lastIndex=Ft.lastIndex=0,i,r,a,s=-1,o=[],l=[];for(t=t+"",e=e+"";(i=Qt.exec(t))&&(r=Ft.exec(e));)(a=r.index)>n&&(a=e.slice(n,a),o[s]?o[s]+=a:o[++s]=a),(i=i[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:Ee(i,r)})),n=Ft.lastIndex;return n<e.length&&(a=e.slice(n),o[s]?o[s]+=a:o[++s]=a),o.length<2?l[0]?Fa(l[0].x):Va(e):(e=l.length,function(d){for(var c=0,f;c<e;++c)o[(f=l[c]).i]=f.x(d);return o.join("")})}var $n=180/Math.PI,en={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ni(t,e,n,i,r,a){var s,o,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*i)&&(n-=t*l,i-=e*l),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,l/=o),t*i<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*$n,skewX:Math.atan(l)*$n,scaleX:s,scaleY:o}}var vt;function Ua(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?en:Ni(e.a,e.b,e.c,e.d,e.e,e.f)}function Ha(t){return t==null||(vt||(vt=document.createElementNS("http://www.w3.org/2000/svg","g")),vt.setAttribute("transform",t),!(t=vt.transform.baseVal.consolidate()))?en:(t=t.matrix,Ni(t.a,t.b,t.c,t.d,t.e,t.f))}function Si(t,e,n,i){function r(d){return d.length?d.pop()+" ":""}function a(d,c,f,h,u,g){if(d!==f||c!==h){var p=u.push("translate(",null,e,null,n);g.push({i:p-4,x:Ee(d,f)},{i:p-2,x:Ee(c,h)})}else(f||h)&&u.push("translate("+f+e+h+n)}function s(d,c,f,h){d!==c?(d-c>180?c+=360:c-d>180&&(d+=360),h.push({i:f.push(r(f)+"rotate(",null,i)-2,x:Ee(d,c)})):c&&f.push(r(f)+"rotate("+c+i)}function o(d,c,f,h){d!==c?h.push({i:f.push(r(f)+"skewX(",null,i)-2,x:Ee(d,c)}):c&&f.push(r(f)+"skewX("+c+i)}function l(d,c,f,h,u,g){if(d!==f||c!==h){var p=u.push(r(u)+"scale(",null,",",null,")");g.push({i:p-4,x:Ee(d,f)},{i:p-2,x:Ee(c,h)})}else(f!==1||h!==1)&&u.push(r(u)+"scale("+f+","+h+")")}return function(d,c){var f=[],h=[];return d=t(d),c=t(c),a(d.translateX,d.translateY,c.translateX,c.translateY,f,h),s(d.rotate,c.rotate,f,h),o(d.skewX,c.skewX,f,h),l(d.scaleX,d.scaleY,c.scaleX,c.scaleY,f,h),d=c=null,function(u){for(var g=-1,p=h.length,v;++g<p;)f[(v=h[g]).i]=v.x(u);return f.join("")}}}var qa=Si(Ua,"px, ","px)","deg)"),Ya=Si(Ha,", ",")",")"),Ga=1e-12;function On(t){return((t=Math.exp(t))+1/t)/2}function Wa(t){return((t=Math.exp(t))-1/t)/2}function Xa(t){return((t=Math.exp(2*t))-1)/(t+1)}const Ka=(function t(e,n,i){function r(a,s){var o=a[0],l=a[1],d=a[2],c=s[0],f=s[1],h=s[2],u=c-o,g=f-l,p=u*u+g*g,v,y;if(p<Ga)y=Math.log(h/d)/e,v=function(x){return[o+x*u,l+x*g,d*Math.exp(e*x*y)]};else{var R=Math.sqrt(p),C=(h*h-d*d+i*p)/(2*d*n*R),_=(h*h-d*d-i*p)/(2*h*n*R),N=Math.log(Math.sqrt(C*C+1)-C),k=Math.log(Math.sqrt(_*_+1)-_);y=(k-N)/e,v=function(x){var M=x*y,$=On(N),D=d/(n*R)*($*Xa(e*M+N)-Wa(N));return[o+D*u,l+D*g,d*$/On(e*M+N)]}}return v.duration=y*1e3*e/Math.SQRT2,v}return r.rho=function(a){var s=Math.max(.001,+a),o=s*s,l=o*o;return t(s,o,l)},r})(Math.SQRT2,2,4);var Fe=0,Ke=0,Ge=0,Ci=1e3,Ct,Je,It=0,Le=0,zt=0,ot=typeof performance=="object"&&performance.now?performance:Date,Ii=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function gn(){return Le||(Ii(Ja),Le=ot.now()+zt)}function Ja(){Le=0}function At(){this._call=this._time=this._next=null}At.prototype=Ai.prototype={constructor:At,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?gn():+n)+(e==null?0:+e),!this._next&&Je!==this&&(Je?Je._next=this:Ct=this,Je=this),this._call=t,this._time=n,tn()},stop:function(){this._call&&(this._call=null,this._time=1/0,tn())}};function Ai(t,e,n){var i=new At;return i.restart(t,e,n),i}function Qa(){gn(),++Fe;for(var t=Ct,e;t;)(e=Le-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Fe}function Dn(){Le=(It=ot.now())+zt,Fe=Ke=0;try{Qa()}finally{Fe=0,ts(),Le=0}}function es(){var t=ot.now(),e=t-It;e>Ci&&(zt-=e,It=t)}function ts(){for(var t,e=Ct,n,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ct=n);Je=t,tn(i)}function tn(t){if(!Fe){Ke&&(Ke=clearTimeout(Ke));var e=t-Le;e>24?(t<1/0&&(Ke=setTimeout(Dn,t-ot.now()-zt)),Ge&&(Ge=clearInterval(Ge))):(Ge||(It=ot.now(),Ge=setInterval(es,Ci)),Fe=1,Ii(Dn))}}function Ln(t,e,n){var i=new At;return e=e==null?0:+e,i.restart(r=>{i.stop(),t(r+e)},e,n),i}var ns=un("start","end","cancel","interrupt"),is=[],Ri=0,Pn=1,nn=2,wt=3,zn=4,rn=5,kt=6;function Bt(t,e,n,i,r,a){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;rs(t,n,{name:e,index:i,group:r,on:ns,tween:is,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Ri})}function _n(t,e){var n=ce(t,e);if(n.state>Ri)throw new Error("too late; already scheduled");return n}function me(t,e){var n=ce(t,e);if(n.state>wt)throw new Error("too late; already running");return n}function ce(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function rs(t,e,n){var i=t.__transition,r;i[e]=n,n.timer=Ai(a,0,n.time);function a(d){n.state=Pn,n.timer.restart(s,n.delay,n.time),n.delay<=d&&s(d-n.delay)}function s(d){var c,f,h,u;if(n.state!==Pn)return l();for(c in i)if(u=i[c],u.name===n.name){if(u.state===wt)return Ln(s);u.state===zn?(u.state=kt,u.timer.stop(),u.on.call("interrupt",t,t.__data__,u.index,u.group),delete i[c]):+c<e&&(u.state=kt,u.timer.stop(),u.on.call("cancel",t,t.__data__,u.index,u.group),delete i[c])}if(Ln(function(){n.state===wt&&(n.state=zn,n.timer.restart(o,n.delay,n.time),o(d))}),n.state=nn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===nn){for(n.state=wt,r=new Array(h=n.tween.length),c=0,f=-1;c<h;++c)(u=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++f]=u);r.length=f+1}}function o(d){for(var c=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(l),n.state=rn,1),f=-1,h=r.length;++f<h;)r[f].call(t,c);n.state===rn&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=kt,n.timer.stop(),delete i[e];for(var d in i)return;delete t.__transition}}function Et(t,e){var n=t.__transition,i,r,a=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((i=n[s]).name!==e){a=!1;continue}r=i.state>nn&&i.state<rn,i.state=kt,i.timer.stop(),i.on.call(r?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete n[s]}a&&delete t.__transition}}function as(t){return this.each(function(){Et(this,t)})}function ss(t,e){var n,i;return function(){var r=me(this,t),a=r.tween;if(a!==n){i=n=a;for(var s=0,o=i.length;s<o;++s)if(i[s].name===e){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function os(t,e,n){var i,r;if(typeof n!="function")throw new Error;return function(){var a=me(this,t),s=a.tween;if(s!==i){r=(i=s).slice();for(var o={name:e,value:n},l=0,d=r.length;l<d;++l)if(r[l].name===e){r[l]=o;break}l===d&&r.push(o)}a.tween=r}}function ls(t,e){var n=this._id;if(t+="",arguments.length<2){for(var i=ce(this.node(),n).tween,r=0,a=i.length,s;r<a;++r)if((s=i[r]).name===t)return s.value;return null}return this.each((e==null?ss:os)(n,t,e))}function yn(t,e,n){var i=t._id;return t.each(function(){var r=me(this,i);(r.value||(r.value={}))[e]=n.apply(this,arguments)}),function(r){return ce(r,i).value[e]}}function Mi(t,e){var n;return(typeof e=="number"?Ee:e instanceof st?Mn:(n=st(e))?(e=n,Mn):ja)(t,e)}function ds(t){return function(){this.removeAttribute(t)}}function cs(t){return function(){this.removeAttributeNS(t.space,t.local)}}function us(t,e,n){var i,r=n+"",a;return function(){var s=this.getAttribute(t);return s===r?null:s===i?a:a=e(i=s,n)}}function fs(t,e,n){var i,r=n+"",a;return function(){var s=this.getAttributeNS(t.space,t.local);return s===r?null:s===i?a:a=e(i=s,n)}}function hs(t,e,n){var i,r,a;return function(){var s,o=n(this),l;return o==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=o+"",s===l?null:s===i&&l===r?a:(r=l,a=e(i=s,o)))}}function ps(t,e,n){var i,r,a;return function(){var s,o=n(this),l;return o==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=o+"",s===l?null:s===i&&l===r?a:(r=l,a=e(i=s,o)))}}function ms(t,e){var n=Pt(t),i=n==="transform"?Ya:Mi;return this.attrTween(t,typeof e=="function"?(n.local?ps:hs)(n,i,yn(this,"attr."+t,e)):e==null?(n.local?cs:ds)(n):(n.local?fs:us)(n,i,e))}function gs(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function _s(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ys(t,e){var n,i;function r(){var a=e.apply(this,arguments);return a!==i&&(n=(i=a)&&_s(t,a)),n}return r._value=e,r}function vs(t,e){var n,i;function r(){var a=e.apply(this,arguments);return a!==i&&(n=(i=a)&&gs(t,a)),n}return r._value=e,r}function bs(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var i=Pt(t);return this.tween(n,(i.local?ys:vs)(i,e))}function xs(t,e){return function(){_n(this,t).delay=+e.apply(this,arguments)}}function ws(t,e){return e=+e,function(){_n(this,t).delay=e}}function ks(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?xs:ws)(e,t)):ce(this.node(),e).delay}function Es(t,e){return function(){me(this,t).duration=+e.apply(this,arguments)}}function Ts(t,e){return e=+e,function(){me(this,t).duration=e}}function Ns(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Es:Ts)(e,t)):ce(this.node(),e).duration}function Ss(t,e){if(typeof e!="function")throw new Error;return function(){me(this,t).ease=e}}function Cs(t){var e=this._id;return arguments.length?this.each(Ss(e,t)):ce(this.node(),e).ease}function Is(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;me(this,t).ease=n}}function As(t){if(typeof t!="function")throw new Error;return this.each(Is(this._id,t))}function Rs(t){typeof t!="function"&&(t=fi(t));for(var e=this._groups,n=e.length,i=new Array(n),r=0;r<n;++r)for(var a=e[r],s=a.length,o=i[r]=[],l,d=0;d<s;++d)(l=a[d])&&t.call(l,l.__data__,d,a)&&o.push(l);return new xe(i,this._parents,this._name,this._id)}function Ms(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,i=e.length,r=n.length,a=Math.min(i,r),s=new Array(i),o=0;o<a;++o)for(var l=e[o],d=n[o],c=l.length,f=s[o]=new Array(c),h,u=0;u<c;++u)(h=l[u]||d[u])&&(f[u]=h);for(;o<i;++o)s[o]=e[o];return new xe(s,this._parents,this._name,this._id)}function $s(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Os(t,e,n){var i,r,a=$s(e)?_n:me;return function(){var s=a(this,t),o=s.on;o!==i&&(r=(i=o).copy()).on(e,n),s.on=r}}function Ds(t,e){var n=this._id;return arguments.length<2?ce(this.node(),n).on.on(t):this.each(Os(n,t,e))}function Ls(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Ps(){return this.on("end.remove",Ls(this._id))}function zs(t){var e=this._name,n=this._id;typeof t!="function"&&(t=fn(t));for(var i=this._groups,r=i.length,a=new Array(r),s=0;s<r;++s)for(var o=i[s],l=o.length,d=a[s]=new Array(l),c,f,h=0;h<l;++h)(c=o[h])&&(f=t.call(c,c.__data__,h,o))&&("__data__"in c&&(f.__data__=c.__data__),d[h]=f,Bt(d[h],e,n,h,d,ce(c,n)));return new xe(a,this._parents,e,n)}function Bs(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ui(t));for(var i=this._groups,r=i.length,a=[],s=[],o=0;o<r;++o)for(var l=i[o],d=l.length,c,f=0;f<d;++f)if(c=l[f]){for(var h=t.call(c,c.__data__,f,l),u,g=ce(c,n),p=0,v=h.length;p<v;++p)(u=h[p])&&Bt(u,e,n,p,h,g);a.push(h),s.push(c)}return new xe(a,s,e,n)}var Zs=pt.prototype.constructor;function Vs(){return new Zs(this._groups,this._parents)}function Fs(t,e){var n,i,r;return function(){var a=Ve(this,t),s=(this.style.removeProperty(t),Ve(this,t));return a===s?null:a===n&&s===i?r:r=e(n=a,i=s)}}function $i(t){return function(){this.style.removeProperty(t)}}function js(t,e,n){var i,r=n+"",a;return function(){var s=Ve(this,t);return s===r?null:s===i?a:a=e(i=s,n)}}function Us(t,e,n){var i,r,a;return function(){var s=Ve(this,t),o=n(this),l=o+"";return o==null&&(l=o=(this.style.removeProperty(t),Ve(this,t))),s===l?null:s===i&&l===r?a:(r=l,a=e(i=s,o))}}function Hs(t,e){var n,i,r,a="style."+e,s="end."+a,o;return function(){var l=me(this,t),d=l.on,c=l.value[a]==null?o||(o=$i(e)):void 0;(d!==n||r!==c)&&(i=(n=d).copy()).on(s,r=c),l.on=i}}function qs(t,e,n){var i=(t+="")=="transform"?qa:Mi;return e==null?this.styleTween(t,Fs(t,i)).on("end.style."+t,$i(t)):typeof e=="function"?this.styleTween(t,Us(t,i,yn(this,"style."+t,e))).each(Hs(this._id,t)):this.styleTween(t,js(t,i,e),n).on("end.style."+t,null)}function Ys(t,e,n){return function(i){this.style.setProperty(t,e.call(this,i),n)}}function Gs(t,e,n){var i,r;function a(){var s=e.apply(this,arguments);return s!==r&&(i=(r=s)&&Ys(t,s,n)),i}return a._value=e,a}function Ws(t,e,n){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Gs(t,e,n??""))}function Xs(t){return function(){this.textContent=t}}function Ks(t){return function(){var e=t(this);this.textContent=e??""}}function Js(t){return this.tween("text",typeof t=="function"?Ks(yn(this,"text",t)):Xs(t==null?"":t+""))}function Qs(t){return function(e){this.textContent=t.call(this,e)}}function eo(t){var e,n;function i(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&Qs(r)),e}return i._value=t,i}function to(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,eo(t))}function no(){for(var t=this._name,e=this._id,n=Oi(),i=this._groups,r=i.length,a=0;a<r;++a)for(var s=i[a],o=s.length,l,d=0;d<o;++d)if(l=s[d]){var c=ce(l,e);Bt(l,t,n,d,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new xe(i,this._parents,t,n)}function io(){var t,e,n=this,i=n._id,r=n.size();return new Promise(function(a,s){var o={value:s},l={value:function(){--r===0&&a()}};n.each(function(){var d=me(this,i),c=d.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(l)),d.on=e}),r===0&&a()})}var ro=0;function xe(t,e,n,i){this._groups=t,this._parents=e,this._name=n,this._id=i}function Oi(){return++ro}var ve=pt.prototype;xe.prototype={constructor:xe,select:zs,selectAll:Bs,selectChild:ve.selectChild,selectChildren:ve.selectChildren,filter:Rs,merge:Ms,selection:Vs,transition:no,call:ve.call,nodes:ve.nodes,node:ve.node,size:ve.size,empty:ve.empty,each:ve.each,on:Ds,attr:ms,attrTween:bs,style:qs,styleTween:Ws,text:Js,textTween:to,remove:Ps,tween:ls,delay:ks,duration:Ns,ease:Cs,easeVarying:As,end:io,[Symbol.iterator]:ve[Symbol.iterator]};function ao(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var so={time:null,delay:0,duration:250,ease:ao};function oo(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function lo(t){var e,n;t instanceof xe?(e=t._id,t=t._name):(e=Oi(),(n=so).time=gn(),t=t==null?null:t+"");for(var i=this._groups,r=i.length,a=0;a<r;++a)for(var s=i[a],o=s.length,l,d=0;d<o;++d)(l=s[d])&&Bt(l,t,e,d,s,n||oo(l,e));return new xe(i,this._parents,t,e)}pt.prototype.interrupt=as;pt.prototype.transition=lo;var Bn={},jt={},Ut=34,We=10,Ht=13;function Di(t){return new Function("d","return {"+t.map(function(e,n){return JSON.stringify(e)+": d["+n+'] || ""'}).join(",")+"}")}function co(t,e){var n=Di(t);return function(i,r){return e(n(i),r,t)}}function Zn(t){var e=Object.create(null),n=[];return t.forEach(function(i){for(var r in i)r in e||n.push(e[r]=r)}),n}function te(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function uo(t){return t<0?"-"+te(-t,6):t>9999?"+"+te(t,6):te(t,4)}function fo(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),r=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":uo(t.getUTCFullYear())+"-"+te(t.getUTCMonth()+1,2)+"-"+te(t.getUTCDate(),2)+(r?"T"+te(e,2)+":"+te(n,2)+":"+te(i,2)+"."+te(r,3)+"Z":i?"T"+te(e,2)+":"+te(n,2)+":"+te(i,2)+"Z":n||e?"T"+te(e,2)+":"+te(n,2)+"Z":"")}function ho(t){var e=new RegExp('["'+t+`
\r]`),n=t.charCodeAt(0);function i(f,h){var u,g,p=r(f,function(v,y){if(u)return u(v,y-1);g=v,u=h?co(v,h):Di(v)});return p.columns=g||[],p}function r(f,h){var u=[],g=f.length,p=0,v=0,y,R=g<=0,C=!1;f.charCodeAt(g-1)===We&&--g,f.charCodeAt(g-1)===Ht&&--g;function _(){if(R)return jt;if(C)return C=!1,Bn;var k,x=p,M;if(f.charCodeAt(x)===Ut){for(;p++<g&&f.charCodeAt(p)!==Ut||f.charCodeAt(++p)===Ut;);return(k=p)>=g?R=!0:(M=f.charCodeAt(p++))===We?C=!0:M===Ht&&(C=!0,f.charCodeAt(p)===We&&++p),f.slice(x+1,k-1).replace(/""/g,'"')}for(;p<g;){if((M=f.charCodeAt(k=p++))===We)C=!0;else if(M===Ht)C=!0,f.charCodeAt(p)===We&&++p;else if(M!==n)continue;return f.slice(x,k)}return R=!0,f.slice(x,g)}for(;(y=_())!==jt;){for(var N=[];y!==Bn&&y!==jt;)N.push(y),y=_();h&&(N=h(N,v++))==null||u.push(N)}return u}function a(f,h){return f.map(function(u){return h.map(function(g){return c(u[g])}).join(t)})}function s(f,h){return h==null&&(h=Zn(f)),[h.map(c).join(t)].concat(a(f,h)).join(`
`)}function o(f,h){return h==null&&(h=Zn(f)),a(f,h).join(`
`)}function l(f){return f.map(d).join(`
`)}function d(f){return f.map(c).join(t)}function c(f){return f==null?"":f instanceof Date?fo(f):e.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:s,formatBody:o,formatRows:l,formatRow:d,formatValue:c}}var po=ho(","),mo=po.parseRows;function go(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function _o(t,e){return fetch(t,e).then(go)}const bt=t=>()=>t;function yo(t,{sourceEvent:e,target:n,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function be(t,e,n){this.k=t,this.x=e,this.y=n}be.prototype={constructor:be,scale:function(t){return t===1?this:new be(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new be(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var De=new be(1,0,0);nt.prototype=be.prototype;function nt(t){for(;!t.__zoom;)if(!(t=t.parentNode))return De;return t.__zoom}function qt(t){t.stopImmediatePropagation()}function Xe(t){t.preventDefault(),t.stopImmediatePropagation()}function vo(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function bo(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Vn(){return this.__zoom||De}function xo(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function wo(){return navigator.maxTouchPoints||"ontouchstart"in this}function ko(t,e,n){var i=t.invertX(e[0][0])-n[0][0],r=t.invertX(e[1][0])-n[1][0],a=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>a?(a+s)/2:Math.min(0,a)||Math.max(0,s))}function Eo(){var t=vo,e=bo,n=ko,i=xo,r=wo,a=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],o=250,l=Ka,d=un("start","zoom","end"),c,f,h,u=500,g=150,p=0,v=10;function y(m){m.property("__zoom",Vn).on("wheel.zoom",M,{passive:!1}).on("mousedown.zoom",$).on("dblclick.zoom",D).filter(r).on("touchstart.zoom",O).on("touchmove.zoom",U).on("touchend.zoom touchcancel.zoom",V).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}y.transform=function(m,E,b,I){var L=m.selection?m.selection():m;L.property("__zoom",Vn),m!==L?N(m,E,b,I):L.interrupt().each(function(){k(this,arguments).event(I).start().zoom(null,typeof E=="function"?E.apply(this,arguments):E).end()})},y.scaleBy=function(m,E,b,I){y.scaleTo(m,function(){var L=this.__zoom.k,P=typeof E=="function"?E.apply(this,arguments):E;return L*P},b,I)},y.scaleTo=function(m,E,b,I){y.transform(m,function(){var L=e.apply(this,arguments),P=this.__zoom,F=b==null?_(L):typeof b=="function"?b.apply(this,arguments):b,Y=P.invert(F),G=typeof E=="function"?E.apply(this,arguments):E;return n(C(R(P,G),F,Y),L,s)},b,I)},y.translateBy=function(m,E,b,I){y.transform(m,function(){return n(this.__zoom.translate(typeof E=="function"?E.apply(this,arguments):E,typeof b=="function"?b.apply(this,arguments):b),e.apply(this,arguments),s)},null,I)},y.translateTo=function(m,E,b,I,L){y.transform(m,function(){var P=e.apply(this,arguments),F=this.__zoom,Y=I==null?_(P):typeof I=="function"?I.apply(this,arguments):I;return n(De.translate(Y[0],Y[1]).scale(F.k).translate(typeof E=="function"?-E.apply(this,arguments):-E,typeof b=="function"?-b.apply(this,arguments):-b),P,s)},I,L)};function R(m,E){return E=Math.max(a[0],Math.min(a[1],E)),E===m.k?m:new be(E,m.x,m.y)}function C(m,E,b){var I=E[0]-b[0]*m.k,L=E[1]-b[1]*m.k;return I===m.x&&L===m.y?m:new be(m.k,I,L)}function _(m){return[(+m[0][0]+ +m[1][0])/2,(+m[0][1]+ +m[1][1])/2]}function N(m,E,b,I){m.on("start.zoom",function(){k(this,arguments).event(I).start()}).on("interrupt.zoom end.zoom",function(){k(this,arguments).event(I).end()}).tween("zoom",function(){var L=this,P=arguments,F=k(L,P).event(I),Y=e.apply(L,P),G=b==null?_(Y):typeof b=="function"?b.apply(L,P):b,ae=Math.max(Y[1][0]-Y[0][0],Y[1][1]-Y[0][1]),J=L.__zoom,oe=typeof E=="function"?E.apply(L,P):E,_e=l(J.invert(G).concat(ae/J.k),oe.invert(G).concat(ae/oe.k));return function(le){if(le===1)le=oe;else{var ye=_e(le),Zt=ae/ye[2];le=new be(Zt,G[0]-ye[0]*Zt,G[1]-ye[1]*Zt)}F.zoom(null,le)}})}function k(m,E,b){return!b&&m.__zooming||new x(m,E)}function x(m,E){this.that=m,this.args=E,this.active=0,this.sourceEvent=null,this.extent=e.apply(m,E),this.taps=0}x.prototype={event:function(m){return m&&(this.sourceEvent=m),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(m,E){return this.mouse&&m!=="mouse"&&(this.mouse[1]=E.invert(this.mouse[0])),this.touch0&&m!=="touch"&&(this.touch0[1]=E.invert(this.touch0[0])),this.touch1&&m!=="touch"&&(this.touch1[1]=E.invert(this.touch1[0])),this.that.__zoom=E,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(m){var E=fe(this.that).datum();d.call(m,this.that,new yo(m,{sourceEvent:this.sourceEvent,target:y,transform:this.that.__zoom,dispatch:d}),E)}};function M(m,...E){if(!t.apply(this,arguments))return;var b=k(this,E).event(m),I=this.__zoom,L=Math.max(a[0],Math.min(a[1],I.k*Math.pow(2,i.apply(this,arguments)))),P=Re(m);if(b.wheel)(b.mouse[0][0]!==P[0]||b.mouse[0][1]!==P[1])&&(b.mouse[1]=I.invert(b.mouse[0]=P)),clearTimeout(b.wheel);else{if(I.k===L)return;b.mouse=[P,I.invert(P)],Et(this),b.start()}Xe(m),b.wheel=setTimeout(F,g),b.zoom("mouse",n(C(R(I,L),b.mouse[0],b.mouse[1]),b.extent,s));function F(){b.wheel=null,b.end()}}function $(m,...E){if(h||!t.apply(this,arguments))return;var b=m.currentTarget,I=k(this,E,!0).event(m),L=fe(m.view).on("mousemove.zoom",G,!0).on("mouseup.zoom",ae,!0),P=Re(m,b),F=m.clientX,Y=m.clientY;Ea(m.view),qt(m),I.mouse=[P,this.__zoom.invert(P)],Et(this),I.start();function G(J){if(Xe(J),!I.moved){var oe=J.clientX-F,_e=J.clientY-Y;I.moved=oe*oe+_e*_e>p}I.event(J).zoom("mouse",n(C(I.that.__zoom,I.mouse[0]=Re(J,b),I.mouse[1]),I.extent,s))}function ae(J){L.on("mousemove.zoom mouseup.zoom",null),Ta(J.view,I.moved),Xe(J),I.event(J).end()}}function D(m,...E){if(t.apply(this,arguments)){var b=this.__zoom,I=Re(m.changedTouches?m.changedTouches[0]:m,this),L=b.invert(I),P=b.k*(m.shiftKey?.5:2),F=n(C(R(b,P),I,L),e.apply(this,E),s);Xe(m),o>0?fe(this).transition().duration(o).call(N,F,I,m):fe(this).call(y.transform,F,I,m)}}function O(m,...E){if(t.apply(this,arguments)){var b=m.touches,I=b.length,L=k(this,E,m.changedTouches.length===I).event(m),P,F,Y,G;for(qt(m),F=0;F<I;++F)Y=b[F],G=Re(Y,this),G=[G,this.__zoom.invert(G),Y.identifier],L.touch0?!L.touch1&&L.touch0[2]!==G[2]&&(L.touch1=G,L.taps=0):(L.touch0=G,P=!0,L.taps=1+!!c);c&&(c=clearTimeout(c)),P&&(L.taps<2&&(f=G[0],c=setTimeout(function(){c=null},u)),Et(this),L.start())}}function U(m,...E){if(this.__zooming){var b=k(this,E).event(m),I=m.changedTouches,L=I.length,P,F,Y,G;for(Xe(m),P=0;P<L;++P)F=I[P],Y=Re(F,this),b.touch0&&b.touch0[2]===F.identifier?b.touch0[0]=Y:b.touch1&&b.touch1[2]===F.identifier&&(b.touch1[0]=Y);if(F=b.that.__zoom,b.touch1){var ae=b.touch0[0],J=b.touch0[1],oe=b.touch1[0],_e=b.touch1[1],le=(le=oe[0]-ae[0])*le+(le=oe[1]-ae[1])*le,ye=(ye=_e[0]-J[0])*ye+(ye=_e[1]-J[1])*ye;F=R(F,Math.sqrt(le/ye)),Y=[(ae[0]+oe[0])/2,(ae[1]+oe[1])/2],G=[(J[0]+_e[0])/2,(J[1]+_e[1])/2]}else if(b.touch0)Y=b.touch0[0],G=b.touch0[1];else return;b.zoom("touch",n(C(F,Y,G),b.extent,s))}}function V(m,...E){if(this.__zooming){var b=k(this,E).event(m),I=m.changedTouches,L=I.length,P,F;for(qt(m),h&&clearTimeout(h),h=setTimeout(function(){h=null},u),P=0;P<L;++P)F=I[P],b.touch0&&b.touch0[2]===F.identifier?delete b.touch0:b.touch1&&b.touch1[2]===F.identifier&&delete b.touch1;if(b.touch1&&!b.touch0&&(b.touch0=b.touch1,delete b.touch1),b.touch0)b.touch0[1]=this.__zoom.invert(b.touch0[0]);else if(b.end(),b.taps===2&&(F=Re(F,this),Math.hypot(f[0]-F[0],f[1]-F[1])<v)){var Y=fe(this).on("dblclick.zoom");Y&&Y.apply(this,arguments)}}}return y.wheelDelta=function(m){return arguments.length?(i=typeof m=="function"?m:bt(+m),y):i},y.filter=function(m){return arguments.length?(t=typeof m=="function"?m:bt(!!m),y):t},y.touchable=function(m){return arguments.length?(r=typeof m=="function"?m:bt(!!m),y):r},y.extent=function(m){return arguments.length?(e=typeof m=="function"?m:bt([[+m[0][0],+m[0][1]],[+m[1][0],+m[1][1]]]),y):e},y.scaleExtent=function(m){return arguments.length?(a[0]=+m[0],a[1]=+m[1],y):[a[0],a[1]]},y.translateExtent=function(m){return arguments.length?(s[0][0]=+m[0][0],s[1][0]=+m[1][0],s[0][1]=+m[0][1],s[1][1]=+m[1][1],y):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},y.constrain=function(m){return arguments.length?(n=m,y):n},y.duration=function(m){return arguments.length?(o=+m,y):o},y.interpolate=function(m){return arguments.length?(l=m,y):l},y.on=function(){var m=d.on.apply(d,arguments);return m===d?y:m},y.clickDistance=function(m){return arguments.length?(p=(m=+m)*m,y):Math.sqrt(p)},y.tapDistance=function(m){return arguments.length?(v=+m,y):v},y}var q;(function(t){t.assertEqual=r=>{};function e(r){}t.assertIs=e;function n(r){throw new Error}t.assertNever=n,t.arrayToEnum=r=>{const a={};for(const s of r)a[s]=s;return a},t.getValidEnumValues=r=>{const a=t.objectKeys(r).filter(o=>typeof r[r[o]]!="number"),s={};for(const o of a)s[o]=r[o];return t.objectValues(s)},t.objectValues=r=>t.objectKeys(r).map(function(a){return r[a]}),t.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const a=[];for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&a.push(s);return a},t.find=(r,a)=>{for(const s of r)if(a(s))return s},t.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&Number.isFinite(r)&&Math.floor(r)===r;function i(r,a=" | "){return r.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}t.joinValues=i,t.jsonStringifyReplacer=(r,a)=>typeof a=="bigint"?a.toString():a})(q||(q={}));var Fn;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Fn||(Fn={}));const S=q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Te=t=>{switch(typeof t){case"undefined":return S.undefined;case"string":return S.string;case"number":return Number.isNaN(t)?S.nan:S.number;case"boolean":return S.boolean;case"function":return S.function;case"bigint":return S.bigint;case"symbol":return S.symbol;case"object":return Array.isArray(t)?S.array:t===null?S.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?S.promise:typeof Map<"u"&&t instanceof Map?S.map:typeof Set<"u"&&t instanceof Set?S.set:typeof Date<"u"&&t instanceof Date?S.date:S.object;default:return S.unknown}},w=q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class we extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=i=>{this.issues=[...this.issues,i]},this.addIssues=(i=[])=>{this.issues=[...this.issues,...i]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(a){return a.message},i={_errors:[]},r=a=>{for(const s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(r);else if(s.code==="invalid_return_type")r(s.returnTypeError);else if(s.code==="invalid_arguments")r(s.argumentsError);else if(s.path.length===0)i._errors.push(n(s));else{let o=i,l=0;for(;l<s.path.length;){const d=s.path[l];l===s.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(n(s))):o[d]=o[d]||{_errors:[]},o=o[d],l++}}};return r(this),i}static assert(e){if(!(e instanceof we))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},i=[];for(const r of this.issues)if(r.path.length>0){const a=r.path[0];n[a]=n[a]||[],n[a].push(e(r))}else i.push(e(r));return{formErrors:i,fieldErrors:n}}get formErrors(){return this.flatten()}}we.create=t=>new we(t);const an=(t,e)=>{let n;switch(t.code){case w.invalid_type:t.received===S.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case w.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,q.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:n=`Unrecognized key(s) in object: ${q.joinValues(t.keys,", ")}`;break;case w.invalid_union:n="Invalid input";break;case w.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${q.joinValues(t.options)}`;break;case w.invalid_enum_value:n=`Invalid enum value. Expected ${q.joinValues(t.options)}, received '${t.received}'`;break;case w.invalid_arguments:n="Invalid function arguments";break;case w.invalid_return_type:n="Invalid function return type";break;case w.invalid_date:n="Invalid date";break;case w.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:q.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case w.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case w.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case w.custom:n="Invalid input";break;case w.invalid_intersection_types:n="Intersection results could not be merged";break;case w.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case w.not_finite:n="Number must be finite";break;default:n=e.defaultError,q.assertNever(t)}return{message:n}};let To=an;function No(){return To}const So=t=>{const{data:e,path:n,errorMaps:i,issueData:r}=t,a=[...n,...r.path||[]],s={...r,path:a};if(r.message!==void 0)return{...r,path:a,message:r.message};let o="";const l=i.filter(d=>!!d).slice().reverse();for(const d of l)o=d(s,{data:e,defaultError:o}).message;return{...r,path:a,message:o}};function T(t,e){const n=No(),i=So({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===an?void 0:an].filter(r=>!!r)});t.common.issues.push(i)}class re{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const i=[];for(const r of n){if(r.status==="aborted")return z;r.status==="dirty"&&e.dirty(),i.push(r.value)}return{status:e.value,value:i}}static async mergeObjectAsync(e,n){const i=[];for(const r of n){const a=await r.key,s=await r.value;i.push({key:a,value:s})}return re.mergeObjectSync(e,i)}static mergeObjectSync(e,n){const i={};for(const r of n){const{key:a,value:s}=r;if(a.status==="aborted"||s.status==="aborted")return z;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||r.alwaysSet)&&(i[a.value]=s.value)}return{status:e.value,value:i}}}const z=Object.freeze({status:"aborted"}),Qe=t=>({status:"dirty",value:t}),se=t=>({status:"valid",value:t}),jn=t=>t.status==="aborted",Un=t=>t.status==="dirty",je=t=>t.status==="valid",Rt=t=>typeof Promise<"u"&&t instanceof Promise;var A;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(A||(A={}));class Ce{constructor(e,n,i,r){this._cachedPath=[],this.parent=e,this.data=n,this._path=i,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Hn=(t,e)=>{if(je(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new we(t.common.issues);return this._error=n,this._error}}};function j(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:i,description:r}=t;if(e&&(n||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(s,o)=>{const{message:l}=t;return s.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??i??o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:l??n??o.defaultError}},description:r}}class H{get description(){return this._def.description}_getType(e){return Te(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Te(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new re,ctx:{common:e.parent.common,data:e.data,parsedType:Te(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Rt(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const i=this.safeParse(e,n);if(i.success)return i.data;throw i.error}safeParse(e,n){const i={common:{issues:[],async:n?.async??!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Te(e)},r=this._parseSync({data:e,path:i.path,parent:i});return Hn(i,r)}"~validate"(e){const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Te(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:n});return je(i)?{value:i.value}:{issues:n.common.issues}}catch(i){i?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(i=>je(i)?{value:i.value}:{issues:n.common.issues})}async parseAsync(e,n){const i=await this.safeParseAsync(e,n);if(i.success)return i.data;throw i.error}async safeParseAsync(e,n){const i={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Te(e)},r=this._parse({data:e,path:i.path,parent:i}),a=await(Rt(r)?r:Promise.resolve(r));return Hn(i,a)}refine(e,n){const i=r=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(r):n;return this._refinement((r,a)=>{const s=e(r),o=()=>a.addIssue({code:w.custom,...i(r)});return typeof Promise<"u"&&s instanceof Promise?s.then(l=>l?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,n){return this._refinement((i,r)=>e(i)?!0:(r.addIssue(typeof n=="function"?n(i,r):n),!1))}_refinement(e){return new qe({schema:this,typeName:B.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Se.create(this,this._def)}nullable(){return Ye.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return pe.create(this)}promise(){return Dt.create(this,this._def)}or(e){return $t.create([this,e],this._def)}and(e){return Ot.create(this,e,this._def)}transform(e){return new qe({...j(this._def),schema:this,typeName:B.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new ln({...j(this._def),innerType:this,defaultValue:n,typeName:B.ZodDefault})}brand(){return new Xo({typeName:B.ZodBranded,type:this,...j(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new dn({...j(this._def),innerType:this,catchValue:n,typeName:B.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return vn.create(this,e)}readonly(){return cn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Co=/^c[^\s-]{8,}$/i,Io=/^[0-9a-z]+$/,Ao=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ro=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Mo=/^[a-z0-9_-]{21}$/i,$o=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Oo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Do=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Lo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Yt;const Po=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,zo=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Bo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Zo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Vo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Fo=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Li="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",jo=new RegExp(`^${Li}$`);function Pi(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function Uo(t){return new RegExp(`^${Pi(t)}$`)}function Ho(t){let e=`${Li}T${Pi(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function qo(t,e){return!!((e==="v4"||!e)&&Po.test(t)||(e==="v6"||!e)&&Bo.test(t))}function Yo(t,e){if(!$o.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const i=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),r=JSON.parse(atob(i));return!(typeof r!="object"||r===null||"typ"in r&&r?.typ!=="JWT"||!r.alg||e&&r.alg!==e)}catch{return!1}}function Go(t,e){return!!((e==="v4"||!e)&&zo.test(t)||(e==="v6"||!e)&&Zo.test(t))}class Ne extends H{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==S.string){const a=this._getOrReturnCtx(e);return T(a,{code:w.invalid_type,expected:S.string,received:a.parsedType}),z}const i=new re;let r;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(r=this._getOrReturnCtx(e,r),T(r,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),i.dirty());else if(a.kind==="max")e.data.length>a.value&&(r=this._getOrReturnCtx(e,r),T(r,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),i.dirty());else if(a.kind==="length"){const s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(r=this._getOrReturnCtx(e,r),s?T(r,{code:w.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&T(r,{code:w.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),i.dirty())}else if(a.kind==="email")Do.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"email",code:w.invalid_string,message:a.message}),i.dirty());else if(a.kind==="emoji")Yt||(Yt=new RegExp(Lo,"u")),Yt.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"emoji",code:w.invalid_string,message:a.message}),i.dirty());else if(a.kind==="uuid")Ro.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"uuid",code:w.invalid_string,message:a.message}),i.dirty());else if(a.kind==="nanoid")Mo.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"nanoid",code:w.invalid_string,message:a.message}),i.dirty());else if(a.kind==="cuid")Co.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"cuid",code:w.invalid_string,message:a.message}),i.dirty());else if(a.kind==="cuid2")Io.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"cuid2",code:w.invalid_string,message:a.message}),i.dirty());else if(a.kind==="ulid")Ao.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"ulid",code:w.invalid_string,message:a.message}),i.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),T(r,{validation:"url",code:w.invalid_string,message:a.message}),i.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"regex",code:w.invalid_string,message:a.message}),i.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(r=this._getOrReturnCtx(e,r),T(r,{code:w.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),i.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(r=this._getOrReturnCtx(e,r),T(r,{code:w.invalid_string,validation:{startsWith:a.value},message:a.message}),i.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(r=this._getOrReturnCtx(e,r),T(r,{code:w.invalid_string,validation:{endsWith:a.value},message:a.message}),i.dirty()):a.kind==="datetime"?Ho(a).test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:w.invalid_string,validation:"datetime",message:a.message}),i.dirty()):a.kind==="date"?jo.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:w.invalid_string,validation:"date",message:a.message}),i.dirty()):a.kind==="time"?Uo(a).test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:w.invalid_string,validation:"time",message:a.message}),i.dirty()):a.kind==="duration"?Oo.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"duration",code:w.invalid_string,message:a.message}),i.dirty()):a.kind==="ip"?qo(e.data,a.version)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"ip",code:w.invalid_string,message:a.message}),i.dirty()):a.kind==="jwt"?Yo(e.data,a.alg)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"jwt",code:w.invalid_string,message:a.message}),i.dirty()):a.kind==="cidr"?Go(e.data,a.version)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"cidr",code:w.invalid_string,message:a.message}),i.dirty()):a.kind==="base64"?Vo.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"base64",code:w.invalid_string,message:a.message}),i.dirty()):a.kind==="base64url"?Fo.test(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{validation:"base64url",code:w.invalid_string,message:a.message}),i.dirty()):q.assertNever(a);return{status:i.value,value:e.data}}_regex(e,n,i){return this.refinement(r=>e.test(r),{validation:n,code:w.invalid_string,...A.errToObj(i)})}_addCheck(e){return new Ne({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...A.errToObj(e)})}url(e){return this._addCheck({kind:"url",...A.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...A.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...A.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...A.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...A.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...A.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...A.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...A.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...A.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...A.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...A.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...A.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...A.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...A.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...A.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...A.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,...A.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...A.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...A.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...A.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...A.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...A.errToObj(n)})}nonempty(e){return this.min(1,A.errToObj(e))}trim(){return new Ne({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ne({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ne({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Ne.create=t=>new Ne({checks:[],typeName:B.ZodString,coerce:t?.coerce??!1,...j(t)});function Wo(t,e){const n=(t.toString().split(".")[1]||"").length,i=(e.toString().split(".")[1]||"").length,r=n>i?n:i,a=Number.parseInt(t.toFixed(r).replace(".","")),s=Number.parseInt(e.toFixed(r).replace(".",""));return a%s/10**r}class Ue extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==S.number){const a=this._getOrReturnCtx(e);return T(a,{code:w.invalid_type,expected:S.number,received:a.parsedType}),z}let i;const r=new re;for(const a of this._def.checks)a.kind==="int"?q.isInteger(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{code:w.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(i=this._getOrReturnCtx(e,i),T(i,{code:w.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(i=this._getOrReturnCtx(e,i),T(i,{code:w.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="multipleOf"?Wo(e.data,a.value)!==0&&(i=this._getOrReturnCtx(e,i),T(i,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(i=this._getOrReturnCtx(e,i),T(i,{code:w.not_finite,message:a.message}),r.dirty()):q.assertNever(a);return{status:r.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,A.toString(n))}gt(e,n){return this.setLimit("min",e,!1,A.toString(n))}lte(e,n){return this.setLimit("max",e,!0,A.toString(n))}lt(e,n){return this.setLimit("max",e,!1,A.toString(n))}setLimit(e,n,i,r){return new Ue({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:A.toString(r)}]})}_addCheck(e){return new Ue({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:A.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:A.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:A.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:A.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:A.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:A.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:A.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:A.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:A.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&q.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const i of this._def.checks){if(i.kind==="finite"||i.kind==="int"||i.kind==="multipleOf")return!0;i.kind==="min"?(n===null||i.value>n)&&(n=i.value):i.kind==="max"&&(e===null||i.value<e)&&(e=i.value)}return Number.isFinite(n)&&Number.isFinite(e)}}Ue.create=t=>new Ue({checks:[],typeName:B.ZodNumber,coerce:t?.coerce||!1,...j(t)});class lt extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==S.bigint)return this._getInvalidInput(e);let i;const r=new re;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(i=this._getOrReturnCtx(e,i),T(i,{code:w.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(i=this._getOrReturnCtx(e,i),T(i,{code:w.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(i=this._getOrReturnCtx(e,i),T(i,{code:w.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):q.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:S.bigint,received:n.parsedType}),z}gte(e,n){return this.setLimit("min",e,!0,A.toString(n))}gt(e,n){return this.setLimit("min",e,!1,A.toString(n))}lte(e,n){return this.setLimit("max",e,!0,A.toString(n))}lt(e,n){return this.setLimit("max",e,!1,A.toString(n))}setLimit(e,n,i,r){return new lt({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:i,message:A.toString(r)}]})}_addCheck(e){return new lt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:A.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:A.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:A.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:A.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:A.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}lt.create=t=>new lt({checks:[],typeName:B.ZodBigInt,coerce:t?.coerce??!1,...j(t)});class sn extends H{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==S.boolean){const i=this._getOrReturnCtx(e);return T(i,{code:w.invalid_type,expected:S.boolean,received:i.parsedType}),z}return se(e.data)}}sn.create=t=>new sn({typeName:B.ZodBoolean,coerce:t?.coerce||!1,...j(t)});class Mt extends H{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==S.date){const a=this._getOrReturnCtx(e);return T(a,{code:w.invalid_type,expected:S.date,received:a.parsedType}),z}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return T(a,{code:w.invalid_date}),z}const i=new re;let r;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(r=this._getOrReturnCtx(e,r),T(r,{code:w.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),i.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(r=this._getOrReturnCtx(e,r),T(r,{code:w.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),i.dirty()):q.assertNever(a);return{status:i.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Mt({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:A.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:A.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Mt.create=t=>new Mt({checks:[],coerce:t?.coerce||!1,typeName:B.ZodDate,...j(t)});class qn extends H{_parse(e){if(this._getType(e)!==S.symbol){const i=this._getOrReturnCtx(e);return T(i,{code:w.invalid_type,expected:S.symbol,received:i.parsedType}),z}return se(e.data)}}qn.create=t=>new qn({typeName:B.ZodSymbol,...j(t)});class Yn extends H{_parse(e){if(this._getType(e)!==S.undefined){const i=this._getOrReturnCtx(e);return T(i,{code:w.invalid_type,expected:S.undefined,received:i.parsedType}),z}return se(e.data)}}Yn.create=t=>new Yn({typeName:B.ZodUndefined,...j(t)});class Gn extends H{_parse(e){if(this._getType(e)!==S.null){const i=this._getOrReturnCtx(e);return T(i,{code:w.invalid_type,expected:S.null,received:i.parsedType}),z}return se(e.data)}}Gn.create=t=>new Gn({typeName:B.ZodNull,...j(t)});class Wn extends H{constructor(){super(...arguments),this._any=!0}_parse(e){return se(e.data)}}Wn.create=t=>new Wn({typeName:B.ZodAny,...j(t)});class Xn extends H{constructor(){super(...arguments),this._unknown=!0}_parse(e){return se(e.data)}}Xn.create=t=>new Xn({typeName:B.ZodUnknown,...j(t)});class Ie extends H{_parse(e){const n=this._getOrReturnCtx(e);return T(n,{code:w.invalid_type,expected:S.never,received:n.parsedType}),z}}Ie.create=t=>new Ie({typeName:B.ZodNever,...j(t)});class Kn extends H{_parse(e){if(this._getType(e)!==S.undefined){const i=this._getOrReturnCtx(e);return T(i,{code:w.invalid_type,expected:S.void,received:i.parsedType}),z}return se(e.data)}}Kn.create=t=>new Kn({typeName:B.ZodVoid,...j(t)});class pe extends H{_parse(e){const{ctx:n,status:i}=this._processInputParams(e),r=this._def;if(n.parsedType!==S.array)return T(n,{code:w.invalid_type,expected:S.array,received:n.parsedType}),z;if(r.exactLength!==null){const s=n.data.length>r.exactLength.value,o=n.data.length<r.exactLength.value;(s||o)&&(T(n,{code:s?w.too_big:w.too_small,minimum:o?r.exactLength.value:void 0,maximum:s?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),i.dirty())}if(r.minLength!==null&&n.data.length<r.minLength.value&&(T(n,{code:w.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),i.dirty()),r.maxLength!==null&&n.data.length>r.maxLength.value&&(T(n,{code:w.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),i.dirty()),n.common.async)return Promise.all([...n.data].map((s,o)=>r.type._parseAsync(new Ce(n,s,n.path,o)))).then(s=>re.mergeArray(i,s));const a=[...n.data].map((s,o)=>r.type._parseSync(new Ce(n,s,n.path,o)));return re.mergeArray(i,a)}get element(){return this._def.type}min(e,n){return new pe({...this._def,minLength:{value:e,message:A.toString(n)}})}max(e,n){return new pe({...this._def,maxLength:{value:e,message:A.toString(n)}})}length(e,n){return new pe({...this._def,exactLength:{value:e,message:A.toString(n)}})}nonempty(e){return this.min(1,e)}}pe.create=(t,e)=>new pe({type:t,minLength:null,maxLength:null,exactLength:null,typeName:B.ZodArray,...j(e)});function ze(t){if(t instanceof X){const e={};for(const n in t.shape){const i=t.shape[n];e[n]=Se.create(ze(i))}return new X({...t._def,shape:()=>e})}else return t instanceof pe?new pe({...t._def,type:ze(t.element)}):t instanceof Se?Se.create(ze(t.unwrap())):t instanceof Ye?Ye.create(ze(t.unwrap())):t instanceof Pe?Pe.create(t.items.map(e=>ze(e))):t}class X extends H{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=q.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==S.object){const d=this._getOrReturnCtx(e);return T(d,{code:w.invalid_type,expected:S.object,received:d.parsedType}),z}const{status:i,ctx:r}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ie&&this._def.unknownKeys==="strip"))for(const d in r.data)s.includes(d)||o.push(d);const l=[];for(const d of s){const c=a[d],f=r.data[d];l.push({key:{status:"valid",value:d},value:c._parse(new Ce(r,f,r.path,d)),alwaysSet:d in r.data})}if(this._def.catchall instanceof Ie){const d=this._def.unknownKeys;if(d==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:r.data[c]}});else if(d==="strict")o.length>0&&(T(r,{code:w.unrecognized_keys,keys:o}),i.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const c of o){const f=r.data[c];l.push({key:{status:"valid",value:c},value:d._parse(new Ce(r,f,r.path,c)),alwaysSet:c in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const d=[];for(const c of l){const f=await c.key,h=await c.value;d.push({key:f,value:h,alwaysSet:c.alwaysSet})}return d}).then(d=>re.mergeObjectSync(i,d)):re.mergeObjectSync(i,l)}get shape(){return this._def.shape()}strict(e){return A.errToObj,new X({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,i)=>{const r=this._def.errorMap?.(n,i).message??i.defaultError;return n.code==="unrecognized_keys"?{message:A.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new X({...this._def,unknownKeys:"strip"})}passthrough(){return new X({...this._def,unknownKeys:"passthrough"})}extend(e){return new X({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new X({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:B.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new X({...this._def,catchall:e})}pick(e){const n={};for(const i of q.objectKeys(e))e[i]&&this.shape[i]&&(n[i]=this.shape[i]);return new X({...this._def,shape:()=>n})}omit(e){const n={};for(const i of q.objectKeys(this.shape))e[i]||(n[i]=this.shape[i]);return new X({...this._def,shape:()=>n})}deepPartial(){return ze(this)}partial(e){const n={};for(const i of q.objectKeys(this.shape)){const r=this.shape[i];e&&!e[i]?n[i]=r:n[i]=r.optional()}return new X({...this._def,shape:()=>n})}required(e){const n={};for(const i of q.objectKeys(this.shape))if(e&&!e[i])n[i]=this.shape[i];else{let a=this.shape[i];for(;a instanceof Se;)a=a._def.innerType;n[i]=a}return new X({...this._def,shape:()=>n})}keyof(){return zi(q.objectKeys(this.shape))}}X.create=(t,e)=>new X({shape:()=>t,unknownKeys:"strip",catchall:Ie.create(),typeName:B.ZodObject,...j(e)});X.strictCreate=(t,e)=>new X({shape:()=>t,unknownKeys:"strict",catchall:Ie.create(),typeName:B.ZodObject,...j(e)});X.lazycreate=(t,e)=>new X({shape:t,unknownKeys:"strip",catchall:Ie.create(),typeName:B.ZodObject,...j(e)});class $t extends H{_parse(e){const{ctx:n}=this._processInputParams(e),i=this._def.options;function r(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const s=a.map(o=>new we(o.ctx.common.issues));return T(n,{code:w.invalid_union,unionErrors:s}),z}if(n.common.async)return Promise.all(i.map(async a=>{const s={...n,common:{...n.common,issues:[]},parent:null};return{result:await a._parseAsync({data:n.data,path:n.path,parent:s}),ctx:s}})).then(r);{let a;const s=[];for(const l of i){const d={...n,common:{...n.common,issues:[]},parent:null},c=l._parseSync({data:n.data,path:n.path,parent:d});if(c.status==="valid")return c;c.status==="dirty"&&!a&&(a={result:c,ctx:d}),d.common.issues.length&&s.push(d.common.issues)}if(a)return n.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(l=>new we(l));return T(n,{code:w.invalid_union,unionErrors:o}),z}}get options(){return this._def.options}}$t.create=(t,e)=>new $t({options:t,typeName:B.ZodUnion,...j(e)});function on(t,e){const n=Te(t),i=Te(e);if(t===e)return{valid:!0,data:t};if(n===S.object&&i===S.object){const r=q.objectKeys(e),a=q.objectKeys(t).filter(o=>r.indexOf(o)!==-1),s={...t,...e};for(const o of a){const l=on(t[o],e[o]);if(!l.valid)return{valid:!1};s[o]=l.data}return{valid:!0,data:s}}else if(n===S.array&&i===S.array){if(t.length!==e.length)return{valid:!1};const r=[];for(let a=0;a<t.length;a++){const s=t[a],o=e[a],l=on(s,o);if(!l.valid)return{valid:!1};r.push(l.data)}return{valid:!0,data:r}}else return n===S.date&&i===S.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Ot extends H{_parse(e){const{status:n,ctx:i}=this._processInputParams(e),r=(a,s)=>{if(jn(a)||jn(s))return z;const o=on(a.value,s.value);return o.valid?((Un(a)||Un(s))&&n.dirty(),{status:n.value,value:o.data}):(T(i,{code:w.invalid_intersection_types}),z)};return i.common.async?Promise.all([this._def.left._parseAsync({data:i.data,path:i.path,parent:i}),this._def.right._parseAsync({data:i.data,path:i.path,parent:i})]).then(([a,s])=>r(a,s)):r(this._def.left._parseSync({data:i.data,path:i.path,parent:i}),this._def.right._parseSync({data:i.data,path:i.path,parent:i}))}}Ot.create=(t,e,n)=>new Ot({left:t,right:e,typeName:B.ZodIntersection,...j(n)});class Pe extends H{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==S.array)return T(i,{code:w.invalid_type,expected:S.array,received:i.parsedType}),z;if(i.data.length<this._def.items.length)return T(i,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),z;!this._def.rest&&i.data.length>this._def.items.length&&(T(i,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const a=[...i.data].map((s,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Ce(i,s,i.path,o)):null}).filter(s=>!!s);return i.common.async?Promise.all(a).then(s=>re.mergeArray(n,s)):re.mergeArray(n,a)}get items(){return this._def.items}rest(e){return new Pe({...this._def,rest:e})}}Pe.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Pe({items:t,typeName:B.ZodTuple,rest:null,...j(e)})};class Jn extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==S.map)return T(i,{code:w.invalid_type,expected:S.map,received:i.parsedType}),z;const r=this._def.keyType,a=this._def.valueType,s=[...i.data.entries()].map(([o,l],d)=>({key:r._parse(new Ce(i,o,i.path,[d,"key"])),value:a._parse(new Ce(i,l,i.path,[d,"value"]))}));if(i.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of s){const d=await l.key,c=await l.value;if(d.status==="aborted"||c.status==="aborted")return z;(d.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(d.value,c.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const l of s){const d=l.key,c=l.value;if(d.status==="aborted"||c.status==="aborted")return z;(d.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(d.value,c.value)}return{status:n.value,value:o}}}}Jn.create=(t,e,n)=>new Jn({valueType:e,keyType:t,typeName:B.ZodMap,...j(n)});class dt extends H{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.parsedType!==S.set)return T(i,{code:w.invalid_type,expected:S.set,received:i.parsedType}),z;const r=this._def;r.minSize!==null&&i.data.size<r.minSize.value&&(T(i,{code:w.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),n.dirty()),r.maxSize!==null&&i.data.size>r.maxSize.value&&(T(i,{code:w.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),n.dirty());const a=this._def.valueType;function s(l){const d=new Set;for(const c of l){if(c.status==="aborted")return z;c.status==="dirty"&&n.dirty(),d.add(c.value)}return{status:n.value,value:d}}const o=[...i.data.values()].map((l,d)=>a._parse(new Ce(i,l,i.path,d)));return i.common.async?Promise.all(o).then(l=>s(l)):s(o)}min(e,n){return new dt({...this._def,minSize:{value:e,message:A.toString(n)}})}max(e,n){return new dt({...this._def,maxSize:{value:e,message:A.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}dt.create=(t,e)=>new dt({valueType:t,minSize:null,maxSize:null,typeName:B.ZodSet,...j(e)});class Qn extends H{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}Qn.create=(t,e)=>new Qn({getter:t,typeName:B.ZodLazy,...j(e)});class ei extends H{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return T(n,{received:n.data,code:w.invalid_literal,expected:this._def.value}),z}return{status:"valid",value:e.data}}get value(){return this._def.value}}ei.create=(t,e)=>new ei({value:t,typeName:B.ZodLiteral,...j(e)});function zi(t,e){return new He({values:t,typeName:B.ZodEnum,...j(e)})}class He extends H{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),i=this._def.values;return T(n,{expected:q.joinValues(i),received:n.parsedType,code:w.invalid_type}),z}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),i=this._def.values;return T(n,{received:n.data,code:w.invalid_enum_value,options:i}),z}return se(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return He.create(e,{...this._def,...n})}exclude(e,n=this._def){return He.create(this.options.filter(i=>!e.includes(i)),{...this._def,...n})}}He.create=zi;class ti extends H{_parse(e){const n=q.getValidEnumValues(this._def.values),i=this._getOrReturnCtx(e);if(i.parsedType!==S.string&&i.parsedType!==S.number){const r=q.objectValues(n);return T(i,{expected:q.joinValues(r),received:i.parsedType,code:w.invalid_type}),z}if(this._cache||(this._cache=new Set(q.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const r=q.objectValues(n);return T(i,{received:i.data,code:w.invalid_enum_value,options:r}),z}return se(e.data)}get enum(){return this._def.values}}ti.create=(t,e)=>new ti({values:t,typeName:B.ZodNativeEnum,...j(e)});class Dt extends H{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==S.promise&&n.common.async===!1)return T(n,{code:w.invalid_type,expected:S.promise,received:n.parsedType}),z;const i=n.parsedType===S.promise?n.data:Promise.resolve(n.data);return se(i.then(r=>this._def.type.parseAsync(r,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Dt.create=(t,e)=>new Dt({type:t,typeName:B.ZodPromise,...j(e)});class qe extends H{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===B.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:i}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:s=>{T(i,s),s.fatal?n.abort():n.dirty()},get path(){return i.path}};if(a.addIssue=a.addIssue.bind(a),r.type==="preprocess"){const s=r.transform(i.data,a);if(i.common.async)return Promise.resolve(s).then(async o=>{if(n.value==="aborted")return z;const l=await this._def.schema._parseAsync({data:o,path:i.path,parent:i});return l.status==="aborted"?z:l.status==="dirty"||n.value==="dirty"?Qe(l.value):l});{if(n.value==="aborted")return z;const o=this._def.schema._parseSync({data:s,path:i.path,parent:i});return o.status==="aborted"?z:o.status==="dirty"||n.value==="dirty"?Qe(o.value):o}}if(r.type==="refinement"){const s=o=>{const l=r.refinement(o,a);if(i.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(i.common.async===!1){const o=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});return o.status==="aborted"?z:(o.status==="dirty"&&n.dirty(),s(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(o=>o.status==="aborted"?z:(o.status==="dirty"&&n.dirty(),s(o.value).then(()=>({status:n.value,value:o.value}))))}if(r.type==="transform")if(i.common.async===!1){const s=this._def.schema._parseSync({data:i.data,path:i.path,parent:i});if(!je(s))return z;const o=r.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:i.data,path:i.path,parent:i}).then(s=>je(s)?Promise.resolve(r.transform(s.value,a)).then(o=>({status:n.value,value:o})):z);q.assertNever(r)}}qe.create=(t,e,n)=>new qe({schema:t,typeName:B.ZodEffects,effect:e,...j(n)});qe.createWithPreprocess=(t,e,n)=>new qe({schema:e,effect:{type:"preprocess",transform:t},typeName:B.ZodEffects,...j(n)});class Se extends H{_parse(e){return this._getType(e)===S.undefined?se(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Se.create=(t,e)=>new Se({innerType:t,typeName:B.ZodOptional,...j(e)});class Ye extends H{_parse(e){return this._getType(e)===S.null?se(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ye.create=(t,e)=>new Ye({innerType:t,typeName:B.ZodNullable,...j(e)});class ln extends H{_parse(e){const{ctx:n}=this._processInputParams(e);let i=n.data;return n.parsedType===S.undefined&&(i=this._def.defaultValue()),this._def.innerType._parse({data:i,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}ln.create=(t,e)=>new ln({innerType:t,typeName:B.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...j(e)});class dn extends H{_parse(e){const{ctx:n}=this._processInputParams(e),i={...n,common:{...n.common,issues:[]}},r=this._def.innerType._parse({data:i.data,path:i.path,parent:{...i}});return Rt(r)?r.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new we(i.common.issues)},input:i.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new we(i.common.issues)},input:i.data})}}removeCatch(){return this._def.innerType}}dn.create=(t,e)=>new dn({innerType:t,typeName:B.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...j(e)});class ni extends H{_parse(e){if(this._getType(e)!==S.nan){const i=this._getOrReturnCtx(e);return T(i,{code:w.invalid_type,expected:S.nan,received:i.parsedType}),z}return{status:"valid",value:e.data}}}ni.create=t=>new ni({typeName:B.ZodNaN,...j(t)});class Xo extends H{_parse(e){const{ctx:n}=this._processInputParams(e),i=n.data;return this._def.type._parse({data:i,path:n.path,parent:n})}unwrap(){return this._def.type}}class vn extends H{_parse(e){const{status:n,ctx:i}=this._processInputParams(e);if(i.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:i.data,path:i.path,parent:i});return a.status==="aborted"?z:a.status==="dirty"?(n.dirty(),Qe(a.value)):this._def.out._parseAsync({data:a.value,path:i.path,parent:i})})();{const r=this._def.in._parseSync({data:i.data,path:i.path,parent:i});return r.status==="aborted"?z:r.status==="dirty"?(n.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:i.path,parent:i})}}static create(e,n){return new vn({in:e,out:n,typeName:B.ZodPipeline})}}class cn extends H{_parse(e){const n=this._def.innerType._parse(e),i=r=>(je(r)&&(r.value=Object.freeze(r.value)),r);return Rt(n)?n.then(r=>i(r)):i(n)}unwrap(){return this._def.innerType}}cn.create=(t,e)=>new cn({innerType:t,typeName:B.ZodReadonly,...j(e)});var B;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(B||(B={}));const ue=Ne.create,Ko=Ue.create,Jo=sn.create;Ie.create;pe.create;const Qo=X.create;$t.create;Ot.create;Pe.create;const el=He.create;Dt.create;Se.create;Ye.create;const Ae="https://script.google.com/macros/s/AKfycbz98JrPFb1xW84pirJKMHlsvDJ5c2msxsVDTYvwKpm498twobAOhVuEfNrvWtzUI3LV/exec",Z={gen_col:1,first_name:2,last_name:3,father:4,mother:5,birth_date:6,birthplace:7,death_date:8,image_path:9,marriage:10,gender:11,note:12,id:13},tl=el(["E","K","U"]).default("U"),nl=Qo({id:ue(),name:ue(),first_name:ue(),last_name:ue().optional(),birth_date:ue().optional(),birthplace:ue().optional(),death_date:ue().optional(),image_path:ue().optional(),marriage:ue().optional(),note:ue().optional(),gender:tl,gen:Ko().optional(),is_spouse:Jo()}),ii=0,il=1,rl=2,al=3,sl=4,ol=5,ll=6,dl=7,cl=8,ul=9,fl=10,hl=11,pl=12;function ee(t){return(t||"").toString().trim()}function ml(t){const e=ee(t).toUpperCase();if(e==="E")return"E";const n=parseInt(e,10);return isNaN(n)?null:n}function gl(t){if(!t)return"";let e=/drive\.google\.com\/file\/d\/([-_\w]+)/,n=t.match(e);return n&&n[1]||(e=/drive\.google\.com\/open\?id=([-_\w]+)/,n=t.match(e),n&&n[1])?"https://lh3.googleusercontent.com/d/"+n[1]+"=w1000":t}let Be=0;function bn(){return++Be}function _l(t){const e={},n=[],i={};let r=null,a=0;const s={},o={},l={},d=new Set;Be=0;function c(u,g){const p=[u,g||"unknown"].sort().join("_");if(!i[p]){const v="u_"+p;i[p]=v,e[u]&&n.push([u,v]),g&&e[g]&&n.push([g,v])}return i[p]}function f(u){return u=u.toUpperCase(),u.startsWith("E")||u==="M"?"E":u.startsWith("K")||u==="F"||u==="W"?"K":"U"}return t.forEach((u,g)=>{if(u.length===0||ee(u[ii])==="")return;const p=u[ii],v=ml(p);if(v===null&&p==="")return;const y=ee(u[il]),R=ee(u[rl]),C=ee(u[ol]);let _;const N=ee(u[pl]);if(N&&!isNaN(parseInt(N,10))){const V=parseInt(N,10);d.has(V)?(_=++Be,console.warn(`Row ${g+2}: ID Collision! ID ${V} already seen. Assigning new ID ${_}`),ri(g+2,_)):(_=V,_>Be&&(Be=_))}else _=++Be,console.warn(`Row ${g+2}: No ID found, assigning ID ${_}`),ri(g+2,_);d.add(_);const k=`mem_${_}`;let x=y;R&&(x+=" "+R),x||(x="Unknown");const M=gl(ee(u[cl]).replace(/\\/g,"/")),$={id:k,numeric_id:_,name:x,first_name:y,last_name:R||void 0,birth_date:C||void 0,birthplace:ee(u[ll])||void 0,death_date:ee(u[dl])||void 0,image_path:M||void 0,marriage:ee(u[ul])||void 0,note:ee(u[hl])||void 0,gender:f(ee(u[fl])),gen:void 0,is_spouse:v==="E",row_index:g+2},D=nl.safeParse($);D.success||console.warn(`Row ${g+2}: Validation failed`,D.error.format()),e[k]=$;const O=ee(u[al]),U=ee(u[sl]);if(v==="E"){if(!r){console.warn("Row "+(g+2)+": Spouse 'E' found but no partner exists above.");return}const V=r,m=a;e[k].gen=m,o[m]=k,l[m]||(l[m]={}),l[m][y]=k,c(V,k)}else{const V=v;if(e[k].gen=V,r=k,a=V,s[V]=k,o[V]=null,l[V]={},V>1){const m=s[V-1];let E=null;if(O&&l[V-1]?.[O]?E=l[V-1][O]:U&&l[V-1]?.[U]?E=l[V-1][U]:E=o[V-1],m){const b=c(m,E);n.push([b,k])}}}}),{start:Object.keys(e)[0],members:e,links:n}}async function yl(t){try{const e=await _o(t),n=mo(e);if(!n||n.length<=1)throw new Error("No data rows found.");const i=n.slice(1);return _l(i)}catch(e){throw console.error("Error loading sheet:",e),alert("Error loading data. Check console."),e}}async function ri(t,e){if(!(typeof fetch>"u"))try{const n={row:t,updates:{[Z.id]:e}};fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(n)}).then(()=>{console.log(`Successfully requested ID write for row ${t} (ID: ${e})`)}).catch(i=>{console.warn(`Failed to write ID for row ${t}`,i)})}catch(n){console.warn("Error preparing ID write",n)}}class vl{data;constructor(e){this.data={node_ids:[],id_map:new Map,nodes:[],links:[]},this.data.node_ids=[...new Set(e.flat())],this.data.node_ids.sort(),this.data.nodes=new Array(this.data.node_ids.length);for(let[n,i]of this.data.node_ids.entries()){const r={};r.data=i,r.relations={},r.relations.children=[],r.children=function(){return this.relations.children},this.data.nodes[n]=r,this.data.id_map.set(i,n)}this.data.links=new Array(e.length);for(let[n,i]of e.entries()){const r={};let a=this.find_node(i[0]),s=this.find_node(i[1]);r.source=a,r.target=s,this.data.links[n]=r,a.relations.children.push(s)}}find_node(e){if(!this.data.id_map.has(e))throw"Node "+e+" not found";let n=this.data.id_map.get(e);return this.data.nodes[n]}links(){return this.data.links}nodes(){return this.data.nodes}}class bl extends vl{exist_parents=!1;exist_first_level_adjacencies=!1;exist_second_level_adjacencies=!1;constructor(e){if(super(e),e.length<=0)throw"Cannot handle a dataset without links"}parents(e){return this.add_parents(),e.added_relations.parents}first_level_adjacency(e){return this.add_first_level_adjacencies(),e.added_relations.first_level_adjacency}second_level_adjacency(e){return this.add_second_level_adjacencies(),e.added_relations.second_level_adjacency}add_parents(){if(!this.exist_parents){this.exist_parents=!0;for(let e of this.nodes())e.added_relations||(e.added_relations={}),e.added_relations.parents=[];for(let e of this.links())e.target.added_relations.parents.push(e.source)}}add_first_level_adjacencies(){if(!this.exist_first_level_adjacencies){this.exist_first_level_adjacencies=!0;for(let e of this.nodes())e.added_relations||(e.added_relations={}),e.added_relations.first_level_adjacency=new Set;for(let e of this.links())e.source.added_relations.first_level_adjacency.add(e.target),e.target.added_relations.first_level_adjacency.add(e.source)}}add_second_level_adjacencies(){if(this.exist_second_level_adjacencies)return;this.exist_second_level_adjacencies=!0;const e=(n,i)=>{for(let r of this.first_level_adjacency(n))i.added_relations.second_level_adjacency.add(r)};for(let n of this.nodes())n.added_relations||(n.added_relations={}),n.added_relations.second_level_adjacency=new Set;for(let n of this.links())e(n.source,n.source),e(n.target,n.target),e(n.source,n.target),e(n.target,n.source)}}function xl(t){let e=new Set;for(let n of t.nodes())if(t.parents(n).length<=0){e.add(n);continue}return e}const ge={name:["Name","name"],secondNames:["Zweitnamen","second_names"],birthDate:["Geburtstag","birth_date"],deathDate:["Todestag","death_date"],birthPlace:["Geburtsort","birth_place"],deathPlace:["Todesort","death_place"],marriage:["Hochzeit","marriage"],occupation:["Beruf","occupation"],note:["Notiz","note"],imagePath:["image_path"]};class wl extends bl{constructor(e,n={}){super(e);for(let i of this.nodes())i.added_data={is_visible:!1,is_highlighted:!1},i.data in n&&(i.added_data.input=n[i.data])}get_data_and_xy(e){Ml(e,this)}}function Gt(t,e={}){return new wl(t,e)}function ke(t,e,n="",i=!1){if(!t.added_data.input)return n;const r=t.added_data.input;for(let a of e)if(r.hasOwnProperty(a)){const s=r[a];if(!i||s!=="")return s}return n}function kl(t,e,n="",i=!1){for(let r of e)if(t.hasOwnProperty(r)){const a=t[r];if(!i||a!=="")return a}return n}function ie(t){return ke(t,ge.name,"?",!0)}function El(t){return ke(t,ge.secondNames,"",!0)}function Tl(t){return kl(t,ge.birthDate,"?",!0)}function Bi(t){return t.added_data.input?Tl(t.added_data.input):"?"}function ct(t){return ke(t,ge.deathDate,"",!1)}function Nl(t){return ke(t,ge.birthPlace,"",!0)||(t.added_data.input?"":"?")}function Sl(t){return ke(t,ge.deathPlace,"",!1)}function Cl(t){return ke(t,ge.marriage,"",!1)}function Il(t){return ke(t,ge.occupation,"",!1)}function Al(t){return ke(t,ge.note,"",!1)}function Rl(t){const e=Bi(t);if(e==="?"||e==="")return;let n=String(e).match(/\d+/gi);if(!n)return;const i=n.filter(r=>Number(r)>31);if(!(i.length<=0))return Number(i[0])}function et(t){return ke(t,ge.imagePath,"",!1)}function Ml(t,e){if(!t||!e)return;const n=new Map;for(let i of t.nodes())n.set(i.data,i);for(let i of e.nodes()){let r=n.get(i.data);r&&(i.x=r.ux!==void 0?r.ux:r.x,i.y=r.uy!==void 0?r.uy:r.y,i.added_data=r.added_data)}}function K(t){return t.added_data.input!==void 0}function $l(t){if(t.added_data.input)return t.added_data.input.gender}class Ol{dag;node_size;constructor(e,n){this.dag=e,this.node_size=n}run(e){let n=10*e.length;for(let i=0;i<n;i++)for(let[r,a]of e.entries()){let s=.1/n,o=0;r<e.length-1&&(o+=this.get_pressure(e[r+1],a,this.node_size[0])),r>0&&(o+=this.get_pressure(e[r-1],a,this.node_size[0]));for(let l of this.dag.parents(a))o+=s*this.get_gravity(l,a);for(let l of a.children())o+=s*this.get_gravity(l,a);a.x+=o}this.enforce_placement(e)}enforce_placement(e){let n=Number.NEGATIVE_INFINITY;for(let i of e)n+=this.node_size[0],i.x<n?i.x=n:n=i.x}get_gravity(e,n){return e.x-n.x}get_pressure(e,n,i){let r=n.x-e.x,a=Math.abs(r),s=i-a;if(s<0)return 0;let o=r<0?-1:1;return s*o}}const ut={NODE_SIZE:28,TRANSITION_DURATION_MS:500,MAX_LABEL_LENGTH:40,LABEL_LINE_SEPARATION:14,RELAXATION_PASSES:8};class Dl{dag;generations;groupings;node_size;constructor(e,n){this.dag=e,this.generations=new Map,this.groupings={partners:[],siblings:[]},this.node_size=n}run(){this.add_object_to_nodes("added_relations.layout"),this.assign_generation(),this.assign_grouping(),this.assign_ages(),this.align_all()}assign_generation(){let e=(n,i,r)=>{let a=n.added_relations.layout,s=this.add_to_object(a,"generation_id",i);if(s){this.add_to_map(this.generations,i,new Array);let o=this.generations.get(i);if(r){let l=n.children()[0];if(l!==void 0){let d=this.dag.parents(l),c=d[+(d[0]==n)];o.splice(o.indexOf(c)+1,0,n)}else o.push(n)}else o.push(n)}return s};for(let n of xl(this.dag)){e(n,0,!1);let i=[n];for(;i.length>0;){let r=[];for(let a of i){let s=a.added_relations.layout.generation_id;for(let o of this.dag.parents(a)){let l=this.dag.parents(o);e(o,s-1,l.length===0)&&r.push(o)}for(let o of a.children())e(o,s+1,!1)&&r.push(o)}i=r}}}assign_grouping(){let e=i=>{let r={};return r.added_data={},r.nodes=[],r.id=this.groupings[i].length,this.groupings[i].push(r),r},n=(i,r)=>{let a=r.added_relations.layout;a[i]=a[i+"_ids"].reduce((s,o)=>{let l=this.groupings[i][o].nodes;return s.concat(l)},[])};for(let i of this.dag.nodes()){let r=i.added_relations.layout;this.add_to_object(r,"partners_ids",[]),this.add_to_object(r,"siblings_ids",[])}for(let i of this.dag.nodes()){if(K(i))continue;let r=e("partners");for(let s of this.dag.parents(i))s.added_relations.layout.partners_ids.push(r.id),r.nodes.push(s);let a=e("siblings");for(let s of i.children())s.added_relations.layout.siblings_ids.push(a.id),a.nodes.push(s)}for(let i of this.dag.nodes())n("partners",i),n("siblings",i);this.dag.get_partners=function(i){return i.added_relations.layout.partners},this.dag.get_number_of_siblings=function(i){return i.added_relations.layout.siblings.length}}assign_ages(){for(let e of this.dag.nodes())e.added_data.age=Rl(e);for(let e of this.dag.nodes()){if(K(e))continue;let n=this.get_oldest_age(this.dag.parents(e));if(n!==void 0){e.added_data.age=n;continue}let i=this.get_average_age(e.children());i!==void 0&&(e.added_data.age=i)}this.dag.get_age=function(e){return e.added_data.age}}align_all(){let e=Array.from(this.generations).sort((r,a)=>r[0]>a[0]?1:-1),n=0;for(let[r,a]of e){this.align_generation(r,a);let s=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let d of a)s[0]=Math.min(s[0],d.x),s[1]=Math.max(s[1],d.x);let o=(s[0]+s[1])/2,l=n-o;for(let d of a)d.x+=l;n=o+l}let i=new Ol(this.dag,this.node_size);for(let r=0;r<ut.RELAXATION_PASSES;r++)for(let[a,s]of e)i.run(s)}align_generation(e,n){const i=a=>{if(K(a)&&a.added_data.input?.is_spouse){const s=this.dag.get_partners(a);if(s)return s.find(o=>!o.added_data.input?.is_spouse)||s[0]}return a},r=a=>{const s=this.dag.parents(a);if(s.length===0)return;const o=s[0];return o?o.x:void 0};for(let a of[1,2,3]){const s=new Map;for(let d of n){const c=i(d);s.has(c)||s.set(c,[]),s.get(c).push(d)}const o=Array.from(s.keys());o.sort((d,c)=>{const f=r(d),h=r(c);if(f!==void 0&&h!==void 0&&f!==h)return f-h;if(f!==void 0&&h===void 0)return 1;if(f===void 0&&h!==void 0)return-1;const u=this.dag.get_age(d),g=this.dag.get_age(c);if(u!==void 0&&g!==void 0&&u!==g)return u-g;if(u!==void 0&&g===void 0)return-1;if(u===void 0&&g!==void 0)return 1;const p=d.added_data.input?.name||"",v=c.added_data.input?.name||"",y=p.localeCompare(v);return y!==0?y:d.data.localeCompare(c.data)});let l={x:0,y:e*this.node_size[1]};for(let d of o){const c=s.get(d);c.sort((f,h)=>f===d?-1:h===d?1:f.data.localeCompare(h.data));for(let f of c)f.x=l.x,f.y=l.y,l.x+=this.node_size[0]}if(a==1)for(let d of o){let c=this.dag.parents(d);this.align_to_parents(d,c);const f=s.get(d);let h=d.x,u=0;for(let g of f)g.x=h+u*this.node_size[0],u++}}n.sort((a,s)=>a.x-s.x)}add_to_map(e,n,i){let r=!1;return e.has(n)||(e.set(n,i),r=!0),r}add_to_object(e,n,i){let r=!1;return e.hasOwnProperty(n)||(e[n]=i,r=!0),r}add_object_to_nodes(e){let n=!1,i=e.split(".");for(let r of this.dag.nodes()){let a=r;for(let s of i)a.hasOwnProperty(s)||(a[s]={},n=!0),a=a[s]}return n}align_partners(e){if(e.length<2)return;e.sort((a,s)=>{let o=[a,s],l=o.map(this.dag.get_number_of_siblings);return l[0]!=l[1]?l[0]<l[1]?1:-1:(l=o.map(this.dag.get_age),l[0]>l[1]?1:-1)});let n=e[0],i=e.filter(a=>a!=n),r=1;for(let a of i)a.x=n.x+this.node_size[0]*r,r++}align_to_parents(e,n){if(n.length<1)return;const i=n.find(r=>K(r)&&!r.added_data.input?.is_spouse);i?e.x=i.x:e.x=this.get_average_x(n)}get_average_x(e){if(!(e.length<=0))return e.reduce((n,i)=>n+i.x,0)/e.length}get_average_age(e){if(!(e.length<=0))return e.reduce((n,i)=>n+(i.added_data.age||0),0)/e.length}get_oldest_age(e){if(!(e.length<=0))return e.reduce((n,i)=>Math.min(n,i.added_data.age||Number.POSITIVE_INFINITY),Number.POSITIVE_INFINITY)}is_member(e){return K(e)}}function $e(){return ut.NODE_SIZE}function ai(t){if(!K(t))return"family";let e="member";if(t.added_data.is_highlighted?e+=" highlighted":e+=" non-highlighted",t.added_data.is_ugly&&(e+=" ugly"),ct(t)){e+=" deceased";const n=t.children?t.children():[],i=n.length>0,r=i&&n.some(a=>a.added_data.is_visible);(!i||r)&&(e+=" deceased-uncollapsed")}return e}function Ll(t){function e(i){return"clip_to_circle_"+i.data}t.append("defs").append("clipPath").attr("id",i=>e(i)).append("circle").attr("r",$e()-1);let n=2*$e();t.filter(i=>et(i)!=="").append("image").attr("x",-n/2).attr("y",-n/2).attr("width",n).attr("height",n).attr("href",i=>et(i)).attr("referrerpolicy","no-referrer").attr("clip-path",i=>"url(#"+e(i)+")").attr("cursor","pointer"),t.filter(i=>et(i)===""&&ct(i)!=="").append("text").attr("class","deceased-symbol").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size",$e()*1).attr("dy","0em").attr("fill","#FFFFFF").style("filter","grayscale(70%)").style("pointer-events","none").text(""),t.filter(i=>et(i)===""&&ct(i)===""&&K(i)).append("text").attr("class","gender-symbol").attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size",$e()*1).attr("dy","0em").attr("fill","#FFFFFF").style("filter","grayscale(70%)").style("pointer-events","none").text(i=>{const r=$l(i);return r==="E"?"":r==="K"?"":""})}function Pl(t,e,n=!0){function i(p){let v=p.match(/[^\s]+/gi);return v||[]}function r(p){for(let v of["Heilige","Freiherr","Graf","der","von","zu","bei","Dr.","med.","Dr","med","St.","St"])if(p==v)return!0;for(let v of[".","/","-","(",")"])if(p.includes(v))return!0;return!1}function a(p){let v=i(ie(p)),y=i(El(p)),R=y.length<2,C=v[0];for(let _=0;_<y.length;_++)y[_]!=""&&(R||r(y[_])?C+=" "+y[_]:C+=" "+y[_][0]+".");for(let _=1;_<v.length;_++)C+=" "+v[_];return ct(p),C}function s(p){let v=Bi(p),y=ct(p);return v+(y!=""?" - "+y:"")}function o(p){return Il(p)}function l(p){return Al(p)}function d(p){let v=Nl(p),y=Sl(p),R=Cl(p),C="";v==y&&(C=v,v="",y="");let _="";return C!=""&&(_+=(_!=""?" ":"")+"* "+C),v!=""&&(_+=(_!=""?" ":"")+"* "+v),y!=""&&(_+=(_!=""?" ":"")+" "+y),R!=""&&(_+=(_!=""?" ":"")+" "+R),_}function c(p,v){if(!K(p))return[];let y=a(p),R=s(p),C=o(p),_=d(p),N=l(p),k=[y];return R!=""&&k.push(R),C!=""&&v&&k.push(C),_!=""&&v&&k.push(_),N!=""&&v&&k.push(N),k}t.selectAll("text.node-label").remove();let f=c(e,n);if(f.length<1)return;let h=t.append("text").attr("class","node-label").attr("dominant-baseline","central"),u=ut.LABEL_LINE_SEPARATION,g=-u*(f.length-1)/2;for(let p=0;p<f.length;p++){let v=f[p],y=ut.MAX_LABEL_LENGTH;v.length>y&&(v=v.substring(0,y-3)+"...");let R=h.append("tspan").text(v).attr("dy",p==0?g:u).attr("x",$e()+8);p>=2&&R.attr("fill-opacity",.5).attr("font-size","75%")}}class zl{g;transition_milliseconds=ut.TRANSITION_DURATION_MS;onNodeClick;onNodeDblClick;onEditClick;clickTimer=null;constructor(e,n,i,r){this.g=e,this.onNodeClick=n,this.onNodeDblClick=i,this.onEditClick=r}draw_nodes(e,n){let i=Array.from(e);i.sort((c,f)=>{let u=[c,f].map(K);return u[0]>u[1]?1:u[0]<u[1]?-1:c.data>f.data?1:-1});let r=this.g.selectAll("g.node").data(i,c=>c.data),a=r.enter().append("g").attr("class","node").attr("transform",c=>"translate("+n.added_data.y0+","+n.added_data.x0+")").attr("visible","true");a.each(function(c){Pl(fe(this),c,!0)});const s=this;let o=a.append("g").attr("cursor","pointer").on("click",(c,f)=>{c.defaultPrevented||(s.clickTimer&&(clearTimeout(s.clickTimer),s.clickTimer=null),s.clickTimer=setTimeout(()=>{s.clickTimer=null,s.onNodeClick(f,c)},300))}).on("dblclick",(c,f)=>{c.defaultPrevented||(c.stopPropagation(),s.clickTimer&&(clearTimeout(s.clickTimer),s.clickTimer=null),s.onNodeDblClick(f))});o.append("circle").attr("class",ai).attr("r",c=>$e()/(K(c)?1:4)),Ll(o),a.append("g").attr("cursor","pointer").on("click",(c,f)=>s.onEditClick(f)).append("text").attr("cursor","pointer").attr("class","plus-label").attr("font-size","50%").append("tspan").attr("text-anchor","middle").attr("y",c=>-28/(K(c)?1.1:3)).attr("x",c=>$e()/(K(c)?1.1:3)).text("");let l=a.merge(r);l.transition().duration(this.transition_milliseconds).attr("transform",c=>"translate("+c.y+","+c.x+")"),l.select("circle").attr("class",ai);let d=r.exit().transition().duration(this.transition_milliseconds/5).attr("visible","false").remove();d.select("text").style("fill-opacity",1e-6),d.select("circle").style("fill-opacity",1e-6).style("stroke-opacity",1e-6)}draw_links(e,n){function i(o,l){return`M ${o.y} ${o.x} C ${(o.y+l.y)/2} ${o.x}, 
				${(o.y+l.y)/2} ${l.x}, 
				${l.y} ${l.x}`}let r=this.g.selectAll("path.link").data(e,o=>o.source.data+"_"+o.target.data);r.enter().insert("path","g").attr("class","link").attr("d",function(){let o={x:n.added_data.x0,y:n.added_data.y0};return i(o,o)}).merge(r).transition().duration(this.transition_milliseconds).attr("d",o=>i(o.source,o.target)),r.exit().transition().duration(this.transition_milliseconds/5).style("stroke-opacity",1e-6).remove()}}class Bl{data;svg;g;zoom;info;transition_milliseconds;dag_all;dag;layout;editing_div;renderer;onViewChange;create_editing_form;create_info_form;constructor(e,n,i){this.data=e,this.svg=n,this.onViewChange=i,this.g=this.svg.append("g"),this.zoom=Eo().on("zoom",r=>{this.g.attr("transform",r.transform),this.onViewChange&&this.onViewChange()}),this.svg.call(this.zoom),this.zoom.wheelDelta(r=>-r.deltaY*(r.deltaMode===1?.05:5e-4)),this.info=this.add_info_text(n),this.transition_milliseconds=500,this.renderer=new zl(this.g,(r,a)=>this.handleNodeClick(r,a),r=>this.handleNodeDblClick(r),r=>this.handleEditClick(r)),this.reset_dags()}reset_dags(){if(!this.data.links)throw"No links in input";if(!this.data.members)throw"No members in input";if(!this.data.start)throw"No starting node ID in input";this.dag_all=Gt(this.data.links,this.data.members),this.dag=void 0;let e=this.dag_all.find_node(this.data.start),n=parseFloat(this.svg.attr("height")),i=parseFloat(this.svg.attr("width"));isNaN(n)&&(n=window.innerHeight||800),isNaN(i)&&(i=window.innerWidth||1e3),e.added_data.x0=n/2,e.added_data.y0=i/2,e.added_data.is_visible=!0;const r=e.children?e.children():[];if(r)for(let a of r){a.added_data.is_visible=!0;const s=this.dag_all.parents?this.dag_all.parents(a):[];if(s)for(let l of s)l.added_data.is_visible=!0;const o=a.children?a.children():[];if(o)for(let l of o)l.added_data.is_visible=!0}}updateData(e,n){let i=n;if(!i&&(i=new Set,this.dag_all))for(let l of this.dag_all.nodes())l.added_data?.is_visible&&i.add(l.data);if(this.data=e,!this.data.links)throw"No links in input";if(!this.data.members)throw"No members in input";if(!this.data.start)throw"No starting node ID in input";this.dag_all=Gt(this.data.links,this.data.members),this.dag=void 0;let r=this.dag_all.find_node(this.data.start);if(!r){console.error("Start node not found in new data:",this.data.start);return}let a=parseFloat(this.svg.attr("height")),s=parseFloat(this.svg.attr("width"));isNaN(a)&&(a=window.innerHeight||800),isNaN(s)&&(s=window.innerWidth||1e3),r.added_data.x0=a/2,r.added_data.y0=s/2;let o=0;for(let l of this.dag_all.nodes())i.has(l.data)&&(l.added_data.is_visible=!0,o++);if(r.added_data.is_visible=!0,i.size<=1||o<=1){const l=r.children?r.children():[];if(l)for(let d of l){d.added_data.is_visible=!0;const c=this.dag_all.parents?this.dag_all.parents(d):[];if(c)for(let h of c)h.added_data.is_visible=!0;const f=d.children?d.children():[];if(f)for(let h of f)h.added_data.is_visible=!0}}this.draw(!1)}handleNodeClick(e,n){const i=document.getElementById("family-sidebar");if(i&&i.classList.contains("active")){this.handleEditClick(e);return}if(n.shiftKey){this.handleEditClick(e);return}this.click(e.data)}handleEditClick(e){if(typeof this.create_editing_form=="function"){let n=e,i=this.dag_all.find_node(e.data);this.create_editing_form(n,i)}}handleNodeDblClick(e){let n=this.dag_all.find_node(e.data);for(let a of this.dag_all.nodes())a.added_data.is_visible=!1;n.added_data.is_visible=!0;let i=Array.from(this.dag_all.parents(n));for(;i.length>0;){let a=i.pop();a.added_data.is_visible=!0,i=i.concat(this.dag_all.parents(a))}let r=Array.from(n.children());for(let a of r){let s=this.dag_all.parents(a);for(let o of s)o.added_data.is_visible=!0}for(;r.length>0;){let a=r.pop();a.added_data.is_visible=!0,r=r.concat(Array.from(a.children()))}this.draw(!0,e.data)}click(e){let n=this.dag_all.find_node(e);this.is_expandable_downwards(n)?this.showDescendants(n):this.hideDescendants(n),this.draw(!1,e)}showDescendants(e){const n=e.children?e.children():[];for(let i of n){i.added_data.is_visible=!0;const r=this.dag_all.parents(i);for(let s of r)s.added_data.is_visible=!0;const a=i.children?i.children():[];for(let s of a)s.added_data.is_visible=!0}}hideDescendants(e){const n=e.children?e.children():[];if(n)for(let i of n){i.added_data.is_visible=!1;const r=this.dag_all.parents?this.dag_all.parents(i):[];if(r)for(let s of r)s.data!==e.data&&(s.added_data.is_visible=!1);const a=i.children?i.children():[];if(a)for(let s of a)s.added_data.is_visible=!1,s.added_data.is_ugly&&(s.added_data.is_ugly=!1),this.hideDescendants(s)}}draw(e=!0,n=this.data.start){try{const a=this.dag_all.find_node(n);if(a){a.added_data.is_visible||(a.added_data.is_visible=!0);const s=this.dag_all.parents(a);for(let o of s)this.dag_all.parents(o).some(d=>d.added_data.is_visible)&&(o.added_data.is_visible=!0)}}catch{}let i=[];for(let a of this.dag_all.links())a.source.added_data.is_visible&&a.target.added_data.is_visible&&i.push([a.source.data,a.target.data]);if(i.length===0){console.warn("No visible links found. Resetting to default view.");for(let o of this.dag_all.nodes())o.added_data.is_visible=!1;const a=this.dag_all.find_node(n);a.added_data.is_visible=!0;const s=a.children?a.children():[];for(let o of s){o.added_data.is_visible=!0;const l=this.dag_all.parents(o);for(let c of l)c.added_data.is_visible=!0;const d=o.children?o.children():[];for(let c of d)c.added_data.is_visible=!0}i=[];for(let o of this.dag_all.links())o.source.added_data.is_visible&&o.target.added_data.is_visible&&i.push([o.source.data,o.target.data])}this.dag_all.get_data_and_xy(this.dag),this.dag=Gt(i),this.dag.get_data_and_xy(this.dag_all);for(let a of this.dag.nodes()){let s=this.dag_all.find_node(a.data);a.added_data.is_highlighted=this.is_expandable_downwards(s)}this.layout=new Dl(this.dag,[80,140]),this.layout.run();let r;try{r=this.dag.find_node(this.data.start=n)}catch{console.warn(`Node ${n} not found in filtered DAG. Falling back to first available node.`);const s=this.dag.nodes();if(s.length>0)r=s[0],this.data.start=r.data;else{console.warn("Filtered DAG is empty.");return}}if(!e){const a=r.added_data.y0,s=r.added_data.x0;if(a!==void 0&&s!==void 0){const o=a-r.y,l=s-r.x;if(o!==0||l!==0)for(let d of this.dag.nodes())d.y+=o,d.x+=l}}try{localStorage.setItem("soyagaci_last_node",r.data)}catch{}if(this.renderer.draw_nodes(this.dag.nodes(),r),this.renderer.draw_links(this.dag.links(),r),e){const a=r.added_data.y0-r.y,s=r.added_data.x0-r.x;!isNaN(a)&&!isNaN(s)&&this.svg.transition().duration(this.transition_milliseconds).call(this.zoom.transform,nt(this.g.node()).translate(a,s))}for(let a of this.dag.nodes())a.added_data.x0=a.x,a.added_data.y0=a.y;this.onViewChange&&this.onViewChange()}get_relationship_in_dag_all(e){return K(e)?this.dag_all.second_level_adjacency(e):this.dag_all.first_level_adjacency(e)}is_expandable_downwards(e){const n=e.children?e.children():[];if(!n||n.length===0)return!1;for(let i of n){if(!i.added_data.is_visible)return!0;const r=this.dag_all.parents(i);for(let s of r)if(s.data!==e.data&&!s.added_data.is_visible)return!0;const a=i.children?i.children():[];for(let s of a)if(!s.added_data.is_visible)return!0}return!1}add_info_text(e){return e.append("text").on("click",n=>{this.create_info_form&&this.create_info_form()}).attr("cursor","pointer").attr("class","info-text").attr("x",parseFloat(e.attr("width"))-16).attr("y","24pt").text("")}findPath(e,n){if(!e||!n)return;if(e===n){alert("Same person selected.");return}const i=this.dag_all.find_node(e),r=this.dag_all.find_node(n);if(!i||!r){alert("Node not found.");return}const a=[],s=new Set;for(a.push({node:i,path:[i]}),s.add(i.data);a.length>0;){const{node:o,path:l}=a.shift();if(o.data===n){this.highlightPath(l);return}const d=this.dag_all.first_level_adjacency(o);for(let c of d)s.has(c.data)||(s.add(c.data),a.push({node:c,path:[...l,c]}))}alert("No connection found between these people.")}highlightPath(e){for(let n of this.dag_all.nodes())n.added_data.is_visible=!1;for(let n of e)if(n.added_data.is_visible=!0,!K(n)){const i=this.dag_all.parents(n);for(let r of i)r.added_data.is_visible=!0}this.draw(!1)}connectToVisible(e){const n=this.dag_all.find_node(e);if(!n)return;if(n.added_data.is_visible){this.draw(!0,e);return}const i=[],r=new Set;i.push({node:n,path:[n]}),r.add(n.data);let a=null;for(;i.length>0;){const{node:s,path:o}=i.shift();if(s.added_data.is_visible){a=o;break}const l=this.dag_all.first_level_adjacency(s);for(let d of l)r.has(d.data)||(r.add(d.data),i.push({node:d,path:[...o,d]}))}if(a){for(let s of a)if(s.added_data.is_visible=!0,!K(s)){const o=this.dag_all.parents(s);for(let l of o)l.added_data.is_visible=!0}this.draw(!0,e)}else n.added_data.is_visible=!0,this.showDescendants(n),this.draw(!0,e)}}function Zl(t){return new Promise((e,n)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(i.result.split(",")[1]),i.onerror=r=>n(r)})}async function xn(t,e){const n=document.getElementById("save-status"),i=document.getElementById("sidebar-image");n&&(n.innerText="Ykleniyor...",n.style.color="orange");try{if(!e)throw new Error("Ltfen fotoraf yklemek iin bir kii sein.");const r=e.added_data.input;let a;if(r&&r.row_index)a=r.row_index;else if(e.data.startsWith("mem_"))a=parseInt(e.data.split("_")[1])+2;else throw new Error("Kii verisi veya satr numaras bulunamad.");const s=await Zl(t),o={fileName:t.name,mimeType:t.type,fileData:s,row:a,colIndex:Z.image_path||9};await fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(o)});const l=URL.createObjectURL(t);i&&(i.src=l,i.style.display="inline-block"),e.added_data.input&&(e.added_data.input.image_path=l),xi("g.node").filter(d=>d.data===e.data).select("image").attr("href",l),n&&(n.innerText="Yklendi! (Kalc olmas 5-10 dk srebilir)",n.style.color="green",setTimeout(()=>{n.innerText=""},5e3))}catch(r){console.error("Fotoraf yklenirken hata olutu:",r),n?(n.innerText=`Hata: ${r.message}`,n.style.color="red"):alert(`Hata: ${r.message}`)}finally{const r=document.getElementById("image-upload-input");r&&(r.value="")}}function Vl(t){let e=null;const n=document.getElementById("image-upload-input"),i=document.getElementById("crop-modal"),r=document.getElementById("image-to-crop"),a=document.getElementById("btn-cancel-crop"),s=document.getElementById("btn-confirm-crop");if(!i||!r)return;const o=()=>{i.style.display="none",e&&(e.destroy(),e=null),n&&(n.value="")};n&&n.addEventListener("change",l=>{if(l.target.files.length>0){const d=l.target.files[0],c=new FileReader;c.onload=f=>{r.src=f.target.result,i.style.display="flex",e&&e.destroy(),e=new Cropper(r,{aspectRatio:1,viewMode:1,autoCropArea:.8})},c.readAsDataURL(d)}}),a&&a.addEventListener("click",o),s&&s.addEventListener("click",()=>{e&&e.getCroppedCanvas({width:400,height:400}).toBlob(l=>{if(!l)return;const d=new File([l],"cropped_image.jpg",{type:"image/jpeg"});t(d),o()},"image/jpeg",.9)})}let ft=null;function Fl(t){ft=t}let ht=null;function gt(t){ht=t}class jl{state;listeners;debounceTimer;constructor(){this.listeners=new Set,this.state={familyData:null,fullFamilyData:null,visibleNodes:new Set,highlightedNodes:new Set,selectedNodeId:null,transform:null,isPatrilineal:!1,isSidebarOpen:!1,isDarkMode:!1},this.state.isPatrilineal=localStorage.getItem("soyagaci_patrilineal_mode")==="true"}getState(){return this.state}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e(this.state)),this.persistState()}persistState(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.state.familyData&&(localStorage.setItem("soyagaci_patrilineal_mode",String(this.state.isPatrilineal)),this.state.selectedNodeId&&localStorage.setItem("soyagaci_last_node",this.state.selectedNodeId))},500)}setData(e){this.state.familyData=e,this.state.fullFamilyData=JSON.parse(JSON.stringify(e)),this.notify()}setPatrilineal(e){this.state.isPatrilineal=e,this.notify()}setSelectedNode(e){this.state.selectedNodeId=e,this.notify()}setSidebarOpen(e){this.state.isSidebarOpen=e,this.notify()}setVisibleNodes(e){this.state.visibleNodes=e,this.notify()}setTransform(e){this.state.transform=e}}const W=new jl;async function Zi(t,e){const n=document.getElementById("save-status");n&&(n.innerText="Kaydediliyor...",n.style.color="orange");try{const i=t.added_data.input;let r;if(i&&i.row_index)r=i.row_index;else if(t.data.startsWith("mem_"))r=parseInt(t.data.split("_")[1])+2;else throw new Error("Satr numaras bulunamad.");await fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({row:r,updates:e})}),t.added_data.input||(t.added_data.input={});for(const[s,o]of Object.entries(e)){const l=Object.keys(Z).find(d=>Z[d]==parseInt(s));l&&(t.added_data.input[l]=o)}if(e[Z.first_name]!==void 0||e[Z.last_name]!==void 0){const s=t.added_data.input.first_name||"",o=t.added_data.input.last_name||"";t.added_data.input.name=(s+" "+o).trim();const l=document.getElementById("sidebar-title");l&&(l.innerText=t.added_data.input.name)}e[Z.image_path]===""&&xi("g.node").filter(s=>s.data===t.data).select("image").attr("href","https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png"),n&&(n.innerText="Kaydedildi! (Kalc olmas 5-10 dk srebilir)",n.style.color="green",setTimeout(()=>n.innerText="",5e3))}catch(i){console.error(i),n&&(n.innerText="Hata: "+i.message,n.style.color="red")}}async function Ul(t){const e=document.getElementById("add-status");if(!e)return;const n=document.querySelectorAll("#sidebar-details input.sidebar-input"),i={};let r=!1;if(n.forEach(v=>{const y=v.getAttribute("data-key"),R=v.value;if(R&&y){y==="first_name"&&(r=!0);const C=Z[y];C&&(i[C]=R)}}),!r){alert("Ltfen en azndan bir isim (Ad) girin.");return}const a=W.getState().familyData;if(!a||!a.members){alert("Veri yklenemedi.");return}const s=new Map;Object.values(a.members).forEach(v=>{v.row_index&&s.set(v.row_index,v)});const o=t.added_data.input;if(!o||!o.row_index){alert("Seilen kii iin satr verisi bulunamad.");return}let l=o.row_index;const d=o.is_spouse;if(d){let v=l-1;for(;v>0;){const y=s.get(v);if(!y)break;if(!y.is_spouse){l=v;break}v--}}const c=s.get(l);if(!c){alert("Hata: Ebeveyn bulunamad.");return}const f=c.gen;if(f===void 0){alert("Hata: Ebeveyn jenerasyonu bilinmiyor.");return}let h=l,u=l+1;for(;;){const v=s.get(u);if(!v)break;if(v.is_spouse){h=u,u++;continue}if(v.gen!==void 0&&v.gen>f){h=u,u++;continue}break}const g=f+1;i[Z.gen_col]=g,i[Z.id]=bn();const p=c.gender||"E";d?p==="E"?(i[Z.father]=c.first_name,i[Z.mother]=o.first_name):(i[Z.father]=o.first_name,i[Z.mother]=c.first_name):p==="E"?i[Z.father]=c.first_name:i[Z.mother]=c.first_name,e.innerText="Ekleniyor...",e.style.color="orange";try{if(await fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addChild",row:h,updates:i})}),e.innerText="ocuk eklendi!",e.style.color="green",ht){e.innerText="ocuk eklendi! Fotoraf ykleniyor...",e.style.color="orange";try{const _={data:"temp_child",added_data:{input:{row_index:h+1}}};await xn(ht,_),e.innerText="Baarl! Fotoraf yklendi. Sayfay yenileyin.",e.style.color="green",alert("ocuk ve fotoraf eklendi. Ltfen sayfay yenileyin.")}catch(C){console.error("Photo upload error:",C),e.innerText="ocuk eklendi ama fotoraf yklenemedi. Sayfay yenileyip tekrar deneyin.",e.style.color="orange",alert("ocuk eklendi ama fotoraf yklenemedi. Ltfen sayfay yenileyip fotoraf tekrar ekleyin.")}gt(null);const R=document.getElementById("sidebar-image");R&&(R.dataset.addChildMode="false")}else e.innerText="Baarl! Sayfay yenileyin.",e.style.color="green",alert("ocuk eklendi. Ltfen sayfay yenileyin.");const y=document.getElementById("sidebar-image");y&&(y.dataset.addChildMode="false"),setTimeout(()=>{const R=document.getElementById("family-sidebar");R&&R.classList.remove("active")},1e3)}catch(v){console.error(v),e.innerText="Hata: "+v.message,e.style.color="red"}}async function Hl(t){const e=document.getElementById("add-status");if(!e)return;const n=document.querySelectorAll("#sidebar-details input.sidebar-input, #sidebar-details select.sidebar-input"),i={};let r=!1;if(n.forEach(h=>{const u=h.getAttribute("data-key"),g=h.value;if(g&&u){u==="first_name"&&(r=!0);const p=Z[u];p&&(i[p]=g)}}),!r){alert("Ltfen en azndan bir isim (Ad) girin.");return}const a=W.getState().familyData;if(!a||!a.members){alert("Veri yklenemedi.");return}const s=new Map;Object.values(a.members).forEach(h=>{h.row_index&&s.set(h.row_index,h)});const o=t.added_data.input;if(!o||!o.row_index){alert("Seilen kii iin satr verisi bulunamad.");return}const l=o.row_index;let d=l,c=l+1;for(;;){const h=s.get(c);if(!h)break;if(h.is_spouse){d=c,c++;continue}break}const f=d+1;i[Z.gen_col]="E",i[Z.father]="",i[Z.mother]="",i[Z.note]=(i[Z.note]?i[Z.note]+", ":"")+"is_spouse:true",i[Z.id]=bn(),e.innerText="Ekleniyor...",e.style.color="orange";try{await fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addSpouse",row:f,updates:i})}),e.innerText="E eklendi!",e.style.color="green";const u=document.getElementById("sidebar-image");if(u&&u.dataset.addSpouseMode==="true"&&ht){e.innerText="E eklendi! Fotoraf ykleniyor...",e.style.color="orange";try{const v={data:"temp_spouse",added_data:{input:{row_index:f+1}}};await xn(ht,v),e.innerText="Baarl! Fotoraf yklendi. Sayfay yenileyin.",e.style.color="green",alert("E ve fotoraf eklendi. Ltfen sayfay yenileyin.")}catch(p){console.error("Photo upload error:",p),e.innerText="E eklendi ama fotoraf yklenemedi. Sayfay yenileyip tekrar deneyin.",e.style.color="orange",alert("E eklendi ama fotoraf yklenemedi. Ltfen sayfay yenileyip fotoraf tekrar ekleyin.")}gt(null),u&&(u.dataset.addSpouseMode="false")}else e.innerText="Baarl! Sayfay yenileyin.",e.style.color="green",alert("E eklendi. Ltfen sayfay yenileyin.");u&&(u.dataset.addSpouseMode="false"),setTimeout(()=>{const p=document.getElementById("family-sidebar");p&&p.classList.remove("active")},1e3)}catch(h){console.error(h),e.innerText="Hata: "+h.message,e.style.color="red"}}async function ql(t){const e=ie(t)||"Bu kii";if(confirm(`${e} isimli kiiyi silmek istediinizden emin misiniz? Bu ilem geri alnamaz!`))try{const i=t.added_data.input;let r;if(i&&i.row_index)r=i.row_index;else if(t.data.startsWith("mem_"))r=parseInt(t.data.split("_")[1])+2;else throw new Error("Satr numaras bulunamad.");const a=document.getElementById("save-status");a&&(a.innerText="Siliniyor...",a.style.color="orange"),await fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"deleteRow",row:r})}),a&&(a.innerText="Silindi! Sayfay yenileyin.",a.style.color="green"),alert("Kii silindi. Ltfen sayfay yenileyin."),setTimeout(()=>{const o=document.getElementById("family-sidebar");o&&o.classList.remove("active")},1e3)}catch(i){console.error(i);const r=document.getElementById("save-status");r&&(r.innerText="Hata: "+i.message,r.style.color="red")}}async function si(t,e,n,i,r){const a=document.getElementById("move-status"),s=W.getState().familyData;if(i==="spouse"){if(a&&(a.innerText="Gncelleniyor...",a.style.color="orange"),!r){alert("Ana ebeveyn bilgisi bulunamad.");return}const o={};r.gender==="E"?o[Z.mother]=n||"":o[Z.father]=n||"";try{await Zi(t,o),a&&(a.innerText="E bilgisi gncellendi! Sayfay yenileyin.",a.style.color="green"),alert("E bilgisi gncellendi. Ltfen sayfay yenileyin."),setTimeout(()=>{const l=document.getElementById("family-sidebar");l&&l.classList.remove("active")},1e3)}catch(l){console.error(l),a&&(a.innerText="Hata: "+l.message,a.style.color="red")}}else{a&&(a.innerText="Tanyor...",a.style.color="orange");const o=s?.members[e];if(!o){alert("Seilen ebeveyn bulunamad.");return}const l=t.added_data.input;if(!l||!l.row_index){alert("Satr bilgisi bulunamad.");return}if(!o.row_index||o.gen===void 0){alert("Yeni ebeveyn bilgisi eksik.");return}const d=l.row_index,c=new Map;Object.values(s.members).forEach(p=>{p.row_index&&c.set(p.row_index,p)});let f=o.row_index,h=o.row_index+1;const u=o.gen+1;for(console.log(`Moving to parent ${o.first_name} at row ${o.row_index}, gen ${o.gen}`);;){const p=c.get(h);if(!p){console.log(`End of sheet at row ${h}`);break}if(console.log(`Checking row ${h}: ${p.first_name}, gen=${p.gen}, is_spouse=${p.is_spouse}`),p.is_spouse){console.log("  -> Spouse, continuing"),f=h,h++;continue}if(p.gen!==void 0&&p.gen===u){console.log("  -> Immediate child, continuing"),f=h,h++;continue}console.log(`  -> Different gen, stopping. insertAfterRow=${f}`);break}console.log(`Final insertion point: after row ${f}`);const g={};g[Z.gen_col]=u,g[Z.first_name]=l.first_name||"",g[Z.last_name]=l.last_name||"",g[Z.birth_date]=l.birth_date||"",g[Z.birthplace]=l.birthplace||"",g[Z.death_date]=l.death_date||"",g[Z.image_path]=l.image_path||"",g[Z.marriage]=l.marriage||"",g[Z.gender]=l.gender||"",g[Z.note]=l.note||"",g[Z.id]=l.numeric_id||bn(),o.gender==="K"?(g[Z.mother]=o.first_name,g[Z.father]=n||""):(g[Z.father]=o.first_name,g[Z.mother]=n||"");try{await fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"deleteRow",row:d})}),await fetch(Ae,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"addChild",row:f,updates:g})}),a&&(a.innerText="Baaryla tand! Sayfay yenileyin.",a.style.color="green"),alert("Kii tand. Ltfen sayfay yenileyin."),setTimeout(()=>{const y=document.getElementById("family-sidebar");y&&y.classList.remove("active")},1e3)}catch(p){console.error(p),a&&(a.innerText="Hata: "+p.message,a.style.color="red")}}}function Vi(t,e){const n=[{key:"first_name",label:"Ad",type:"text"},{key:"last_name",label:"Soyad",type:"text"},{key:"gender",label:"Cinsiyet",type:"select",options:[{value:"E",label:"Erkek"},{value:"K",label:"Kadn"},{value:"U",label:"Belirsiz"}]},{key:"birth_date",label:"Doum Tarihi",type:"text"},{key:"birthplace",label:"Doum Yeri",type:"text"},{key:"death_date",label:"lm Tarihi",type:"text"},{key:"marriage",label:"Evlilik Tarihi",type:"text"},{key:"note",label:"Not",type:"text"}];let i='<div class="edit-form">';n.forEach(r=>{const a=e[r.key]||"";i+='<div class="info-row">',r.type==="select"?(i+=`<select class="sidebar-input" data-key="${r.key}">
                        <option value="" disabled ${a===""?"selected":""}>${r.label}</option>`,r.options.forEach(s=>{const o=a===s.value?"selected":"";i+=`<option value="${s.value}" ${o}>${s.label}</option>`}),i+="</select>"):i+=`<input type="text" class="sidebar-input" data-key="${r.key}" value="${a}" placeholder="${r.label}">`,i+=`
            </div>
         `}),i+="</div>",t.innerHTML=i}function Yl(t){const e=document.getElementById("sidebar-title"),n=document.getElementById("sidebar-details"),i=document.getElementById("sidebar-image");if(!n||!i||!e)return;const r="https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";i.src=r,i.style.display="inline-block",i.style.cursor="pointer",i.title="Fotoraf eklemek iin tklayn",gt(null);const a=document.getElementById("save-status");a&&(a.innerText="");const s=document.getElementById("delete-photo-btn");s&&(s.style.display="none"),i.dataset.addChildMode="true",i.dataset.deletePhoto="false",i.onclick=()=>{const u=document.getElementById("image-upload-input");u&&u.click()},e.innerText="Yeni ocuk Ekle";const l={last_name:t.added_data.input.last_name||""};Vi(n,l);const d=document.createElement("div");d.style.marginTop="15px",d.style.display="flex",d.style.justifyContent="space-between";const c=document.createElement("button");c.className="action-btn btn-secondary",c.innerText="ptal",c.onclick=()=>{if(typeof ft<"u"){const u=document.getElementById("family-sidebar");u&&u.classList.remove("active")}};const f=document.createElement("button");f.className="action-btn btn-success",f.innerText=" ocuu Ekle",f.onclick=()=>Ul(t),d.appendChild(c),d.appendChild(f),n.appendChild(d);const h=document.createElement("div");h.id="add-status",h.style.marginTop="10px",h.style.textAlign="center",h.style.fontSize="0.9em",n.appendChild(h)}function Gl(t){const e=document.getElementById("sidebar-title"),n=document.getElementById("sidebar-details"),i=document.getElementById("sidebar-image");if(!n||!i||!e)return;const r="https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";i.src=r,i.style.display="inline-block",i.style.cursor="pointer",i.title="Fotoraf eklemek iin tklayn",gt(null);const a=document.getElementById("save-status");a&&(a.innerText="");const s=document.getElementById("delete-photo-btn");s&&(s.style.display="none"),i.dataset.addSpouseMode="true",i.dataset.deletePhoto="false",i.onclick=()=>{const u=document.getElementById("image-upload-input");u&&u.click()},e.innerText="Yeni E Ekle";const l={last_name:t.added_data.input.last_name||""};Vi(n,l);const d=document.createElement("div");d.style.marginTop="15px",d.style.display="flex",d.style.justifyContent="space-between";const c=document.createElement("button");c.className="action-btn btn-secondary",c.innerText="ptal",c.onclick=()=>{if(typeof ft<"u"){const u=document.getElementById("family-sidebar");u&&u.classList.remove("active")}};const f=document.createElement("button");f.className="action-btn btn-success",f.innerText=" Ei Ekle",f.onclick=()=>Hl(t),d.appendChild(c),d.appendChild(f),n.appendChild(d);const h=document.createElement("div");h.id="add-status",h.style.marginTop="10px",h.style.textAlign="center",h.style.fontSize="0.9em",n.appendChild(h)}function Wl(t){const e=document.getElementById("sidebar-title"),n=document.getElementById("sidebar-details"),i=document.getElementById("sidebar-image");if(!n||!i||!e)return;e.innerText="Ebeveyn Deitir",n.innerHTML="";const r=W.getState().familyData,a=t.added_data.input;let s=null;if(r&&r.members){const x=a?.father,M=a?.mother;for(const[,$]of Object.entries(r.members)){const D=$;if(!D.is_spouse&&(D.first_name===x&&D.gender==="E"||D.first_name===M&&D.gender==="K")){s=D;break}}}const o=document.createElement("div");o.className="edit-form";const l=document.createElement("div");l.style.marginBottom="20px",l.innerHTML=`
        <label style="display:block; margin-bottom:10px; font-weight:bold;">Ne yapmak istiyorsunuz?</label>
        <div style="margin-bottom:8px;">
            <input type="radio" id="change-spouse" name="move-flow" value="spouse" checked>
            <label for="change-spouse" style="margin-left:5px;">Sadece e ismini deitir</label>
        </div>
        <div>
            <input type="radio" id="change-primary" name="move-flow" value="primary">
            <label for="change-primary" style="margin-left:5px;">Ana ebeveynini deitir (ta)</label>
        </div>
    `,o.appendChild(l);const d=document.createElement("div");if(d.id="spouse-change-container",s){const x=document.createElement("div");x.style.marginBottom="10px",x.innerHTML=`<strong>Ana Ebeveyn:</strong> ${s.first_name} ${s.last_name||""}`,d.appendChild(x)}const c=document.createElement("div");c.className="info-row",c.innerHTML='<label style="display:block; margin-bottom:5px; font-weight:bold;">Yeni E:</label>';const f=document.createElement("select");if(f.className="sidebar-input",f.id="spouse-only-select",f.innerHTML='<option value="">(Yok / Bilinmiyor)</option>',r&&r.members&&s&&s.row_index){const x=new Map;Object.values(r.members).forEach($=>{$.row_index&&x.set($.row_index,$)});let M=s.row_index+1;for(;;){const $=x.get(M);if(!$)break;if($.is_spouse){const D=document.createElement("option");D.value=$.first_name,D.innerText=`${$.first_name} ${$.last_name||""}`,f.appendChild(D),M++}else break}}c.appendChild(f),d.appendChild(c),o.appendChild(d);const h=document.createElement("div");h.id="primary-change-container",h.style.display="none";const u=[];r&&r.members&&Object.values(r.members).forEach(x=>{x.id!==t.data&&!x.is_spouse&&u.push(x)}),u.sort((x,M)=>(x.first_name+" "+(x.last_name||"")).localeCompare(M.first_name+" "+(M.last_name||"")));const g=document.createElement("div");g.className="info-row",g.innerHTML='<label style="display:block; margin-bottom:5px; font-weight:bold;">Yeni Ana Ebeveyn:</label>';const p=document.createElement("select");p.className="sidebar-input",p.id="primary-parent-select",p.innerHTML='<option value="" disabled selected>Seiniz...</option>',u.forEach(x=>{const M=document.createElement("option");M.value=x.id,M.innerText=`${x.first_name} ${x.last_name||""} (${x.birth_date||"?"})`,p.appendChild(M)}),g.appendChild(p),h.appendChild(g);const v=document.createElement("div");v.className="info-row",v.style.marginTop="15px",v.innerHTML='<label style="display:block; margin-bottom:5px; font-weight:bold;">E:</label>';const y=document.createElement("select");y.className="sidebar-input",y.id="new-spouse-select",y.disabled=!0,y.innerHTML='<option value="" selected>nce Ana Ebeveyn Sein</option>',v.appendChild(y),h.appendChild(v),p.onchange=()=>{const x=p.value;if(y.innerHTML='<option value="">(Yok / Bilinmiyor)</option>',y.disabled=!1,r&&r.members&&x){const M=r.members[x];if(M&&M.row_index){const $=new Map;Object.values(r.members).forEach(O=>{O.row_index&&$.set(O.row_index,O)});let D=M.row_index+1;for(;;){const O=$.get(D);if(!O)break;if(O.is_spouse){const U=document.createElement("option");U.value=O.first_name,U.innerText=`${O.first_name} ${O.last_name||""}`,y.appendChild(U),D++}else break}}}},o.appendChild(h),n.appendChild(o),o.querySelectorAll('input[name="move-flow"]').forEach(x=>{x.addEventListener("change",M=>{M.target.value==="spouse"?(d.style.display="block",h.style.display="none"):(d.style.display="none",h.style.display="block")})});const C=document.createElement("div");C.style.marginTop="15px",C.style.display="flex",C.style.justifyContent="space-between";const _=document.createElement("button");_.className="action-btn btn-secondary",_.innerText="ptal",_.onclick=()=>{const x=document.getElementById("family-sidebar");x&&x.classList.remove("active")};const N=document.createElement("button");N.className="action-btn btn-success",N.innerText=" Gncelle",N.onclick=()=>{if(o.querySelector('input[name="move-flow"]:checked')?.value==="spouse"){const M=f.value;si(t,null,M,"spouse",s)}else{const M=p.value,$=y.value;if(!M){alert("Ltfen yeni ana ebeveyn sein.");return}si(t,M,$,"primary",null)}},C.appendChild(_),C.appendChild(N),n.appendChild(C);const k=document.createElement("div");k.id="move-status",k.style.marginTop="10px",k.style.textAlign="center",n.appendChild(k)}function Xl(t){Vl(e=>{const n=document.getElementById("sidebar-image");if(!n)return;const i=n.dataset.addChildMode==="true",r=n.dataset.addSpouseMode==="true";if(i||r){gt(e);const a=URL.createObjectURL(e);n.src=a;const s=document.getElementById("add-status");s&&(s.innerText=`Fotoraf hazr (${i?"ocuk":"e"} eklendikten sonra yklenecek)`,s.style.color="blue")}else ft&&xn(e,ft)}),t.create_editing_form=function(e,n){Fl(e);const i=new Map;for(let x of this.get_relationship_in_dag_all(n))x.added_data.is_visible=!0;this.draw(!0,n.data);let r=ie(e)||"simsiz";const a=e.added_data.input.is_spouse,s=document.getElementById("family-sidebar"),o=document.getElementById("sidebar-title"),l=document.getElementById("sidebar-details"),d=document.getElementById("sidebar-image");if(!s||!o||!l||!d)return;o.innerText=r;const c=et(e),f="https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";d.src=c&&c!==""?c:f,d.style.display="inline-block",d.style.cursor="pointer",d.title="Fotoraf deitirmek iin tklayn",d.dataset.addChildMode="false",d.dataset.addSpouseMode="false",d.dataset.deletePhoto="false";const h=document.getElementById("delete-photo-btn");h&&(c&&c!==""?(h.style.display="block",h.onclick=x=>{x.stopPropagation(),d.dataset.deletePhoto="true",d.src=f,h.style.display="none";const M=document.getElementById("save-status");M&&(M.innerText="Fotoraf silinecek (kaydet butonuna basn)",M.style.color="orange")}):h.style.display="none"),d.onclick=()=>{const x=document.getElementById("image-upload-input");x&&x.click()};const u={first_name:"Ad",last_name:"Soyad",gender:"Cinsiyet",birth_date:"Doum Tarihi",death_date:"lm Tarihi",birthplace:"Doum Yeri",occupation:"Meslek",note:"Not",marriage:"Evlilik Tarihi"};let g="";const p=[{key:"first_name",type:"text"},{key:"last_name",type:"text"},{key:"gender",type:"select",options:[{value:"E",label:"Erkek"},{value:"K",label:"Kadn"},{value:"U",label:"Belirsiz"}]},{key:"birth_date",type:"text"},{key:"birthplace",type:"text"},{key:"death_date",type:"text"},{key:"marriage",type:"text"},{key:"note",type:"text"}];if(K(e)){const x=e.added_data.input;g+='<div class="edit-form">',p.forEach(O=>{const U=u[O.key]||O.key,V=x[O.key]||"";g+='<div class="info-row">',O.type==="select"?(g+=`<select class="sidebar-input" data-key="${O.key}">
                                <option value="" disabled ${V===""?"selected":""}>${U}</option>`,O.options.forEach(m=>{const E=V===m.value?"selected":"";g+=`<option value="${m.value}" ${E}>${m.label}</option>`}),g+="</select>"):g+=`<input type="text" class="sidebar-input" data-key="${O.key}" value="${V}" placeholder="${U}">`,g+="</div>"}),g+=`
            <div class="sidebar-section" style="margin-top: 20px; padding-top: 10px; border-top: 1px solid #eee;">
                <h4 style="margin-bottom: 10px; font-size: 0.9rem;">En Ksa Yol Bul</h4>
                <div style="display:flex; flex-direction:column; gap:8px;">
                    <input type="text" id="path-target-input" class="sidebar-input" list="member-list" placeholder="Hedef kii ismi..." style="width:100%;">
                    <datalist id="member-list">
                        ${this.dag_all.nodes().filter(O=>K(O)).map(O=>{const U=ie(O),V=O.added_data.input.birth_date;let m="";V&&(m+=` (d. ${V})`);try{const b=this.dag_all.parents(O);if(b.length>0){const I=this.dag_all.parents(b[0]),L=I.find(F=>F.added_data.input?.gender==="E"),P=L?ie(L):I.length>0?ie(I[0]):"";P&&(m+=` - Baba: ${P}`)}}catch{}let E=`${U}${m}`;if(i.has(E)){let b=2;for(;i.has(`${E} (${b})`);)b++;E=`${E} (${b})`}return i.set(E,O.data),`<option value="${E}">`}).join("")}
                    </datalist>
                    <button id="btn-find-path" class="action-btn btn-primary" style="width: 100%; padding: 12px;">Bul</button>
                </div>
            </div>`;const M=Array.from(n.children()).length===0;let $="";a?$='<button id="btn-add-child" class="action-btn btn-primary"> ocuk Ekle</button>':$='<button id="btn-add-spouse" class="action-btn btn-secondary"> E Ekle</button>';let D="";M&&(D='<button id="btn-delete-child" class="action-btn btn-danger"> Sil</button>'),g+=`
            <div class="button-row" style="margin-top:15px; display:flex; flex-direction:column; gap:10px;">
                <div style="display:flex; gap:8px; width:100%;">
                    ${$}
                    ${D}
                </div>
                <div style="display:flex; gap:8px; width:100%; align-items:center;">
                    <button id="btn-save-changes" class="action-btn btn-success" style="flex:1;"> Kaydet</button>
                </div>
                <div id="save-status" style="text-align:center; font-size:0.85rem; min-height:1.2em;"></div>
            </div>
        </div>`}else g="<em>Aile Balants (Dzenlenemez)</em>";l.innerHTML=g;const v=document.getElementById("btn-save-changes"),y=document.getElementById("btn-add-child"),R=document.getElementById("btn-add-spouse"),C=document.getElementById("btn-delete-child"),_=document.getElementById("btn-find-path");v&&(v.onclick=()=>{const x={};if(l.querySelectorAll("input.sidebar-input, select.sidebar-input").forEach($=>{const D=$.getAttribute("data-key"),O=$.value,U=e.added_data.input[D]||"";if(O!==U){const V=Z[D];V&&(x[V]=O)}}),d.dataset.deletePhoto==="true"&&(x[Z.image_path]=""),Object.keys(x).length>0){Zi(e,x),d.dataset.deletePhoto="false";const $=document.getElementById("delete-photo-btn");$&&($.style.display="none")}else{const $=document.getElementById("save-status");$&&($.innerText="Deiiklik yok.")}}),y&&(y.onclick=()=>{Yl(e)}),R&&(R.onclick=()=>{Gl(e)}),C&&(C.onclick=()=>{ql(e)});const N=document.createElement("button");if(N.className="action-btn btn-warning",N.innerText=" Ebeveyn Deitir",N.style.marginTop="10px",N.onclick=()=>Wl(e),K(e)&&!e.added_data.input.is_spouse){const x=l.querySelector(".button-row");x&&x.appendChild(N)}const k=document.getElementById("btn-open-sheet");if(k){const x=e.added_data.input;if(x&&x.row_index){const M=parseInt(x.row_index),$=`https://docs.google.com/spreadsheets/d/12kZlANYbq0w3k8TpDxssVSlWVfbs-qZQ9bAjERci0SM/edit#gid=790197592&range=${M}:${M}`;k.onclick=()=>window.open($,"_blank"),k.innerText=` Bu Satr Dzenle (Satr ${M})`}else k.onclick=()=>window.open("https://docs.google.com/spreadsheets/d/12kZlANYbq0w3k8TpDxssVSlWVfbs-qZQ9bAjERci0SM/edit?gid=790197592","_blank"),k.innerText="Google Tablosunu A"}_&&(_.onclick=()=>{const M=document.getElementById("path-target-input").value;if(!M)return;const $=i.get(M);$?t.findPath(n.data,$):alert("Kii bulunamad: "+M)}),s.classList.add("active")},t.create_info_form=function(){window.open("https://docs.google.com/spreadsheets/d/12kZlANYbq0w3k8TpDxssVSlWVfbs-qZQ9bAjERci0SM/edit?gid=790197592","_blank")}}function Kl(){Array.from(document.querySelectorAll("style")).forEach(t=>{t.textContent?.includes("-webkit-filter: hue-rotate(180deg) invert(100%) !important;")&&t.parentNode?.removeChild(t)})}function Jl(t){const e={start:"",members:{},links:[]},n={},i={};for(const u of t.links){const[g,p]=u;g.startsWith("u_")?i[p]=g:p.startsWith("u_")&&(n[p]||(n[p]=[]),n[p].push(g))}const r=new Set,a=new Set;let s=t.start,o=1/0;for(const u in t.members){const g=t.members[u],p=g.gen;!g.is_spouse&&typeof p=="number"&&p<o&&(o=p,s=u)}function l(u){const g=i[u];if(!g)return null;const p=n[g]||[];let v=null,y=null;for(const R of p){const C=t.members[R];C&&(C.gender==="E"?v=R:y=R)}return v||y}function d(u){if(a.has(u))return r.has(u);a.add(u);const g=t.members[u];if(!g)return!1;if(u===s)return r.add(u),!0;if(g.is_spouse)return!1;const p=l(u);if(!p)return!1;const v=t.members[p];return g.gender==="E"&&v.gender==="E"&&d(p)?(r.add(u),!0):!1}for(const u in t.members)d(u);const c=r.has(t.start)?t.start:s,f=new Set;for(const u in t.members){const g=t.members[u];if(r.has(u))f.add(u);else if(!g.is_spouse){const p=l(u);p&&r.has(p)&&f.add(u)}}for(const u in t.members)if(t.members[u].is_spouse){const p=i[u];if(p){const v=n[p]||[];for(const y of v)if(f.has(y)){f.add(u);break}}else for(const v of t.links){const[y,R]=v;if(y===u&&R.startsWith("u_")){const C=n[R]||[];for(const _ of C)if(_!==u&&f.has(_)){f.add(u);break}}}}for(const u of f)e.members[u]=t.members[u];for(const u of t.links){const[g,p]=u;if(p.startsWith("u_")||g.startsWith("u_")){const v=g.startsWith("u_")||e.members[g],y=p.startsWith("u_")||e.members[p];v&&y&&e.links.push(u)}else e.members[g]&&e.members[p]&&e.links.push(u)}return e.members[c]||(console.warn("Display root",c,"was missing from filtered members! Adding it forcibly."),e.members[c]=t.members[c]),e.links.some(u=>u[0]===c||u[1]===c)||console.warn("Display root",c,"is NOT in any filtered link! This will cause 'Node not found' error."),e.start=c,e}const it=new Map,Lt=new Map;function Ql(t){if(t.persistentId)return t.persistentId;const e=(t.first_name||"unk").toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,3),n=(t.last_name||"unk").toLowerCase().replace(/[^a-z0-9]/g,"").slice(0,3);let i="00";if(t.birth_date){const r=t.birth_date.match(/\d{4}/);r&&(i=r[0].slice(-2))}return t.persistentId=`${e}_${n}_${i}`,t.persistentId}function ed(t){it.clear(),Lt.clear();const e=new Map,n=Object.keys(t.members).sort();for(const i of n){const r=t.members[i];if(!r.is_spouse||r.first_name){let a=Ql(r);const s=a;let o=e.get(s)||0;o>0&&(a=`${s}_${o}`),e.set(s,o+1),r.persistentId=a,it.set(a,i),Lt.set(i,a)}}}function td(t,e,n,i){const r={n:t&&Lt.get(t)||null,t:e?{k:e.k,x:Math.round(e.x),y:Math.round(e.y)}:null,p:n?1:0,v:i?Array.from(i).map(a=>Lt.get(a)).filter(Boolean):[]};try{const a=JSON.stringify(r);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}catch(a){return console.error("Error encoding state:",a),null}}function oi(){try{const t=window.location.hash.slice(1);if(!t)return null;const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4,i=e+"=".repeat(n),r=atob(i),a=JSON.parse(r);if(!a||typeof a!="object")return console.warn("Invalid URL state: not an object"),null;const s={currentNode:null,transform:null,patrilineal:!1,visibleNodes:new Set};if(a.n&&it.has(a.n)&&(s.currentNode=it.get(a.n)||null),a.t&&typeof a.t.k=="number"&&typeof a.t.x=="number"&&typeof a.t.y=="number"&&(s.transform=a.t),s.patrilineal=a.p===1,Array.isArray(a.v))for(const o of a.v){const l=it.get(o);l&&s.visibleNodes.add(l)}return s}catch(t){return console.warn("Error decoding state from URL, falling back to localStorage:",t),window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search),null}}function Fi(t){if(!t)return;const e=t.transform,n=t.visibleNodes,i=t.selectedNodeId||(t.familyData?t.familyData.start:null),r=t.isPatrilineal,a=td(i,e,r,n);a&&history.replaceState(null,"","#"+a)}async function nd(t){const e=document.getElementById("share-btn");if(!e)return;const n=e.innerHTML;try{Fi(t);const i=window.location.href;e.innerHTML='<span style="font-size: 1.2em;"></span><span>Ksaltlyor...</span>',e.disabled=!0;const r=`https://tinyurl.com/api-create.php?url=${encodeURIComponent(i)}`,a=await fetch(r);if(!a.ok)throw new Error("TinyURL failed");const s=await a.text();await navigator.clipboard.writeText(s),e.innerHTML='<span style="font-size: 1.2em;"></span><span>Kopyaland!</span>',setTimeout(()=>{e.innerHTML=n,e.disabled=!1},2e3)}catch(i){console.warn("TinyURL failed, copying full URL:",i);try{await navigator.clipboard.writeText(window.location.href),e.innerHTML='<span style="font-size: 1.2em;"></span><span>Kopyaland!</span>',setTimeout(()=>{e.innerHTML=n,e.disabled=!1},2e3)}catch{e.innerHTML='<span style="font-size: 1.2em;"></span><span>Hata!</span>',setTimeout(()=>{e.innerHTML=n,e.disabled=!1},2e3)}}}const id="https://docs.google.com/spreadsheets/d/e/2PACX-1vTzo66Bb8-z3QdqtNGZ9uhQJZJxePifl6nJwvtlot-3JtKp4YKYQdqJNFDY89lqHoMRdlKZmjWzh2OA/pub?output=csv";Kl();function tt(t){return t.toLowerCase().replace(//g,"g").replace(//g,"u").replace(//g,"s").replace(//g,"i").replace(//g,"o").replace(//g,"c").replace(//g,"a").replace(//g,"i").replace(//g,"u").replace(/[^a-z0-9]/g,"")}function rd(t){const e=["gulru","gokcen","ayse","gulnihal","feyza"];let n=[];for(let _ of t.dag_all.nodes())_.added_data.is_ugly&&(_.added_data.is_ugly=!1);const i=t.dag_all.nodes().filter(_=>K(_)&&tt(ie(_)).includes("davut"));for(let _ of i){const N=_.children?_.children():[];for(let k of N){const x=k.children?k.children():[];for(let M of x)if(tt(ie(M)).includes("resit")){const $=M,D=$.children?$.children():[];for(let O of D){const U=O.children?O.children():[];for(let V of U)if(tt(ie(V)).includes("davut")){const m=V,E=m.children?m.children():[];for(let b of E){const I=b.children?b.children():[];for(let L of I){const P=L.children?L.children():[];for(let F of P){const Y=F.children?F.children():[];for(let G of Y){const ae=tt(ie(G));e.some(J=>ae.includes(J))&&(n.push(G.data),G.added_data.is_ugly=!0)}}}}}}}}}if(n.length===0){console.warn("Cirkin mode: No matching lineage (Davut -> Resit -> Davut -> ... -> Targets) found.");return}for(let _ of t.dag_all.nodes())_.added_data.is_visible=!1;for(let _ of n){const N=t.dag_all.find_node(_);if(!N)continue;N.added_data.is_visible=!0;let k=Array.from(t.dag_all.parents(N));for(;k.length>0;){let x=k.pop();x.added_data.is_visible=!0,k=k.concat(t.dag_all.parents(x))}}t.draw(!1);let r=1/0,a=-1/0,s=1/0,o=-1/0,l=0;if(t.dag)for(let _ of n)try{const N=t.dag.find_node(_);if(N){const k=N.y,x=N.x;k<r&&(r=k),k>a&&(a=k),x<s&&(s=x),x>o&&(o=x),l++}}catch{}if(l===0)return;const d=parseFloat(t.svg.attr("width")),c=parseFloat(t.svg.attr("height")),f=(r+a)/2,h=(s+o)/2,u=150,g=a-r+u*2,p=o-s+u*2;let v=1;g>0&&p>0&&(v=Math.min(d/g,c/p)),v=Math.min(v,1.2),v=Math.max(v,.3);const y=d/2-f*v,R=c/2-h*v,C=De.translate(y,R).scale(v);t.svg.transition().duration(1e3).call(t.zoom.transform,C)}function li(t){const e=document.getElementById("global-search-input"),n=document.getElementById("global-member-list");if(!e||!n)return;n.innerHTML="";const i=new Map;t.dag_all.nodes().filter(a=>K(a)).forEach(a=>{const s=ie(a),o=a.added_data.input.birth_date;let l="";o&&(l+=` (d. ${o})`);try{const f=t.dag_all.parents(a);if(f.length>0){const h=t.dag_all.parents(f[0]),u=h.find(p=>p.added_data.input?.gender==="E"),g=u?ie(u):h.length>0?ie(h[0]):"";g&&(l+=` - Baba: ${g}`)}}catch{}let d=`${s}${l}`;if(i.has(d)){let f=2;for(;i.has(`${d} (${f})`);)f++;d=`${d} (${f})`}i.set(d,a.data);const c=document.createElement("option");c.value=d,n.appendChild(c)}),e.onchange=()=>{const a=e.value;if(tt(a)==="cirkin"){rd(t),e.value="",e.blur();return}for(let l of t.dag_all.nodes())l.added_data.is_ugly&&(l.added_data.is_ugly=!1);const o=i.get(a);o&&(t.connectToVisible(o),e.value="",e.blur())}}async function ad(){let t=null;const n=new URLSearchParams(window.location.search).has("reset");n&&(console.log("Reset mode: clearing localStorage and fetching fresh data"),localStorage.clear());try{t=await yl(id),localStorage.setItem("soyagaci_cached_data",JSON.stringify(t)),console.log("Data loaded from Google Sheets")}catch(_){if(n)console.error("Reset mode: network failed and cannot use cache",_);else{console.warn("Network failed, trying cache...",_);const N=localStorage.getItem("soyagaci_cached_data");N&&(t=JSON.parse(N),console.log("Loading state from localStorage"))}}if(!t){alert("Could not load data.");return}W.setData(t),ed(t);let i=oi(),r=W.getState().isPatrilineal,a=null,s=null,o=null;if(i)console.log("Loading state from URL"),r=i.patrilineal,W.setPatrilineal(r),a=i.currentNode,s=i.visibleNodes,o=i.transform;else{console.log("Loading state from localStorage"),a=localStorage.getItem("soyagaci_last_node");const _=localStorage.getItem("soyagaci_visible_nodes");if(_)try{s=new Set(JSON.parse(_))}catch(k){console.warn("Failed to restore visible nodes",k)}const N=localStorage.getItem("soyagaci_view_transform");if(N)try{o=JSON.parse(N)}catch(k){console.warn("Failed to restore transform",k)}}s&&W.setVisibleNodes(s),o&&W.setTransform(o),a&&t.members[a]&&(t.start=a);const l=document.getElementById("patrilineal-global-toggle"),d=document.getElementById("toggle-icon"),c=document.getElementById("toggle-text"),f=fe("#tree-container").append("svg").attr("id","tree-svg"),h=()=>{const _=window.innerWidth,N=window.innerHeight;f.attr("width",_).attr("height",N)};window.addEventListener("resize",h),h();let u,g=null;function p(){const _=W.getState().fullFamilyData;let N=_;W.getState().isPatrilineal?(N=Jl(_),l&&d&&c&&(l.style.background="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",d.textContent="",c.textContent="Tm Soy Aac")):l&&d&&c&&(l.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",d.textContent="",c.textContent="Sadece Erkek Soyu"),v(N)}function v(_){if(u){if(s&&s.size>0?(u.updateData(_,s),s=null):u.updateData(_),li(u),o){try{const D=De.translate(o.x,o.y).scale(o.k);u.svg.call(u.zoom.transform,D)}catch(D){console.warn("Failed to restore transform",D)}o=null}return}const N=fe("#tree-svg");N.selectAll("*").remove(),u=new Bl(_,N),li(u);const k=()=>{if(u&&u.dag_all){const O=new Set;for(let U of u.dag_all.nodes())U.added_data.is_visible&&O.add(U.data);W.setVisibleNodes(O)}if(u&&u.g){const O=nt(u.g.node());W.setTransform({k:O.k,x:O.x,y:O.y})}const D=W.getState();Fi(D)};Xl(u);const x=W.getState();if(s&&s.size>3&&u.dag_all){let D=0;const O=new Set;for(let U of u.dag_all.nodes())O.add(U.data),s.has(U.data)&&D++;if(D>0){console.log(`Restoring visibility: ${D}/${s.size} nodes exist in current DAG`);for(let V of u.dag_all.nodes())s.has(V.data)?V.added_data.is_visible=!0:V.added_data.is_visible=!1;const U=u.dag_all.find_node(_.start);U&&(U.added_data.is_visible=!0);for(let V of u.dag_all.nodes()){if(!V.added_data.is_visible)continue;const m=V.children?V.children():[];for(let b of m)(b.children?b.children():[]).some(P=>P.added_data.is_visible)&&(b.added_data.is_visible=!0);const E=u.dag_all.parents?u.dag_all.parents(V):[];for(let b of E)(u.dag_all.parents?u.dag_all.parents(b):[]).some(P=>P.added_data.is_visible)&&(b.added_data.is_visible=!0)}}else{console.warn(`Skipping visibility restoration: only ${D}/${s.size} nodes exist. Using default view.`);try{localStorage.removeItem("soyagaci_visible_nodes"),localStorage.removeItem("soyagaci_view_transform")}catch{}}}let $=!x.transform;if(x.transform){let D=0,O=0;if(u.dag_all)for(let U of u.dag_all.nodes())U.added_data.is_visible&&(D++,x.visibleNodes.has(U.data)&&O++);if(D<=1&&(console.warn("Saved transform exists but only 1 node is visible. Discarding transform."),$=!0),x.visibleNodes.size>5&&D<x.visibleNodes.size*.5&&(console.warn(`Visibility restoration mismatch (Count). Expected ${x.visibleNodes.size}, got ${D}. Discarding transform.`),$=!0),x.visibleNodes.size>0){const U=O/x.visibleNodes.size;U<.5&&(console.warn(`Visibility restoration mismatch (Intersection). Match rate ${U.toFixed(2)}. Discarding transform.`),$=!0)}else console.warn("Saved transform exists but no visible nodes were restored from URL. Discarding transform."),$=!0}if(u.draw($),x.transform&&!$){const D=x.transform,O=De.translate(D.x,D.y).scale(D.k);u.svg.call(u.zoom.transform,O)}u.onViewChange=k}setTimeout(()=>{p()},50),l&&l.addEventListener("click",()=>{const _=!W.getState().isPatrilineal;if(u&&u.g){const N=nt(u.g.node());o={k:N.k,x:N.x,y:N.y};const k=new Set(W.getState().visibleNodes);if(_)g=new Set(k),s=k;else if(g){for(let x of k)g.add(x);s=g}else s=k}W.setPatrilineal(_),p()});const y=document.getElementById("share-btn");y&&y.addEventListener("click",()=>nd(W.getState()));const R=document.getElementById("reset-view-btn");R&&R.addEventListener("click",()=>{window.location.href=`${window.location.pathname}?reset=1`});const C=document.querySelector(".close-btn");C&&C.addEventListener("click",()=>{const _=document.getElementById("family-sidebar");_&&_.classList.remove("active")}),window.addEventListener("popstate",()=>{const _=oi();if(_&&(_.patrilineal!==W.getState().isPatrilineal&&W.setPatrilineal(_.patrilineal),u&&u.dag_all)){if(_.visibleNodes){const k=_.visibleNodes;W.setVisibleNodes(k);for(let x of u.dag_all.nodes())x.added_data.is_visible=k.has(x.data);if(_.currentNode){const x=u.dag_all.find_node(_.currentNode);x&&(x.added_data.is_visible=!0)}}if(_.transform&&(W.setTransform(_.transform),u.svg&&u.zoom)){const k=_.transform,x=De.translate(k.x,k.y).scale(k.k);u.svg.call(u.zoom.transform,x)}const N=!_.transform;_.currentNode&&u.data.members[_.currentNode]?u.draw(N,_.currentNode):u.draw(!1)}}),window.addEventListener("beforeunload",()=>{if(u&&u.g){const _=nt(u.g.node());if(localStorage.setItem("soyagaci_view_transform",JSON.stringify({k:_.k,x:_.x,y:_.y})),u.dag_all){const N=[];for(let k of u.dag_all.nodes())k.added_data?.is_visible&&N.push(k.data);localStorage.setItem("soyagaci_visible_nodes",JSON.stringify(N))}}}),document.addEventListener("keydown",_=>{_.key==="Shift"&&document.body.classList.add("show-plus")}),document.addEventListener("keyup",_=>{_.key==="Shift"&&document.body.classList.remove("show-plus")})}ad();
